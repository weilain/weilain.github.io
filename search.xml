<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>hexo-butterflyç¾åŒ– (æŒç»­æ›´æ–°)</title>
      <link href="/p/1b825486/"/>
      <url>/p/1b825486/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h2 id="æ¨±èŠ±é£˜è½èƒŒæ™¯"><a href="#æ¨±èŠ±é£˜è½èƒŒæ™¯" class="headerlink" title="æ¨±èŠ±é£˜è½èƒŒæ™¯"></a>æ¨±èŠ±é£˜è½èƒŒæ™¯</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd theme&#x2F;Butterfly&#x2F;source&#x2F;js</span><br><span class="line">wget https:&#x2F;&#x2F;yremp.live&#x2F;wp-content&#x2F;uploads&#x2F;resource&#x2F;js&#x2F;sakura.js</span><br></pre></td></tr></table></figure><p>æŠŠä¸‹è½½å¥½çš„Jsæ–‡ä»¶æ”¾åœ¨<code>theme/Butterfly/source/js</code>æ–‡ä»¶å¤¹ä¸‹<br><code>/Butterfly/layout/includes</code>æ–‡ä»¶å¤¹ä¸‹æ‰¾åˆ°<code>head.pug</code>æ–‡ä»¶ï¼Œåœ¨æœ€åå¼•å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if theme.sakura.enable</span><br><span class="line">  script(src&#x3D;&quot;&#x2F;js&#x2F;sakura.js&quot;)</span><br></pre></td></tr></table></figure><p>åœ¨ä¸»é¢˜çš„ä¸»é…ç½®æ–‡ä»¶åŠ å…¥<code>Butterfly/_config.yml</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># é¡µé¢æ¨±èŠ±é£˜è½åŠ¨æ•ˆ</span><br><span class="line">sakura:</span><br><span class="line">  enable: true</span><br></pre></td></tr></table></figure><h2 id="æµè§ˆå™¨æ ‡é¢˜æ¶æ"><a href="#æµè§ˆå™¨æ ‡é¢˜æ¶æ" class="headerlink" title="æµè§ˆå™¨æ ‡é¢˜æ¶æ"></a>æµè§ˆå™¨æ ‡é¢˜æ¶æ</h2><p>åœ¨<code>theme/Butterfly/source/js</code>æ–‡ä»¶å¤¹ä¸‹æ·»åŠ <code>crash_cheat.js</code>æ–‡ä»¶<br>å¡«å…¥ä»¥ä¸‹å†…å®¹<code>è®°å¾—è¦ä¿®æ”¹ä½ å–œæ¬¢çš„æ ‡é¢˜</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">var OriginTitle &#x3D; document.title;</span><br><span class="line"> var titleTime;</span><br><span class="line"> document.addEventListener(&#39;visibilitychange&#39;, function () &#123;</span><br><span class="line">     if (document.hidden) &#123;</span><br><span class="line">         $(&#39;[rel&#x3D;&quot;icon&quot;]&#39;).attr(&#39;href&#39;, &quot;&#x2F;joke.ico&quot;);</span><br><span class="line">         document.title &#x3D; &#39;çœ‹ä¸è§æˆ‘ğŸ™ˆ~çœ‹ä¸è§æˆ‘ğŸ™ˆ~&#39;;</span><br><span class="line">         clearTimeout(titleTime);</span><br><span class="line">     &#125;</span><br><span class="line">     else &#123;</span><br><span class="line">         $(&#39;[rel&#x3D;&quot;icon&quot;]&#39;).attr(&#39;href&#39;, &quot;&#x2F;favicon.ico&quot;);</span><br><span class="line">         document.title &#x3D; &#39; ( à¹‘â€¢Ì€ã…‚â€¢Ì) âœ§è¢«å‘ç°äº†ï½&#39;;</span><br><span class="line">         titleTime &#x3D; setTimeout(function () &#123;</span><br><span class="line">             document.title &#x3D; OriginTitle;</span><br><span class="line">         &#125;, 2000);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure><p>åœ¨<code>Butterfly/layout/includes/layout.pug</code>ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç æ¥å¼•å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">script(type&#x3D;&#39;text&#x2F;javascript&#39;, src&#x3D;&#39;&#x2F;js&#x2F;crash_cheat.js&#39;)</span><br></pre></td></tr></table></figure><h2 id="æ·»åŠ æ ‡ç­¾äº‘"><a href="#æ·»åŠ æ ‡ç­¾äº‘" class="headerlink" title="æ·»åŠ æ ‡ç­¾äº‘"></a>æ·»åŠ æ ‡ç­¾äº‘</h2><p>ä½¿ç”¨å‘½ä»¤è¿›è¡Œå®‰è£…æ’ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install hexo-tag-cloud --save</span><br></pre></td></tr></table></figure><p>æ‰“å¼€<code>Butterfly/layout/includes/widget/card_tags.pug</code>æ–‡ä»¶ï¼Œç”¨ä¸‹é¢å†…å®¹å°†å…¶æ›¿æ¢æ‰ï¼Œæœ€å¥½æŠŠä¹‹å‰çš„æ–‡ä»¶å¤‡ä»½ä¸€ä¸‹,é˜²æ­¢åæ‚”</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">if site.tags.length</span><br><span class="line">  .card-widget.card-tags</span><br><span class="line">    .card-content</span><br><span class="line">      .item-headline</span><br><span class="line">        i.fa.fa-tags(aria-hidden&#x3D;&quot;true&quot;)</span><br><span class="line">        span&#x3D; _p(&#39;aside.card_tags&#39;)</span><br><span class="line">        script(type&#x3D;&quot;text&#x2F;javascript&quot; charset&#x3D;&quot;utf-8&quot; src&#x3D;&quot;&#x2F;js&#x2F;tagcloud.js&quot;)</span><br><span class="line">        script(type&#x3D;&quot;text&#x2F;javascript&quot; charset&#x3D;&quot;utf-8&quot; src&#x3D;&quot;&#x2F;js&#x2F;tagcanvas.js&quot;)</span><br><span class="line">        #myCanvasContainer.widget.tagcloud(align&#x3D;&#39;center&#39;)</span><br><span class="line">          canvas#resCanvas(width&#x3D;&#39;200&#39;, height&#x3D;&#39;200&#39;, style&#x3D;&#39;width&#x3D;100%&#39;)</span><br><span class="line">            !&#x3D; tagcloud()</span><br><span class="line">          !&#x3D; tagcloud(&#123;min_font: 16, max_font: 24, amount: 50, color: true, start_color: &#39;#999&#39;, end_color: &#39;#99a9bf&#39;&#125;)</span><br></pre></td></tr></table></figure><h2 id="æ·»åŠ ä¸ªæ€§åŒ–æ¿å¨˜"><a href="#æ·»åŠ ä¸ªæ€§åŒ–æ¿å¨˜" class="headerlink" title="æ·»åŠ ä¸ªæ€§åŒ–æ¿å¨˜"></a>æ·»åŠ ä¸ªæ€§åŒ–æ¿å¨˜</h2><blockquote><p>ç”±<a href="https://github.com/stevenjoezhang/live2d-widget" target="_blank" rel="noopener">stevenjoezhang</a> é­”æ”¹é¡¹ç›®<br>æœ€ç®€å•å¼•ç”¨æ–¹å¼åœ¨<code>Butterfly/_config.yml</code>ä¸­<code>inject</code>æ·»åŠ </p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">inject:</span><br><span class="line">   head:</span><br><span class="line">     - &lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;font-awesome&#x2F;css&#x2F;font-awesome.min.css&quot;&gt;</span><br><span class="line">   bottom:</span><br><span class="line">     - &lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;stevenjoezhang&#x2F;live2d-widget@latest&#x2F;autoload.js&quot;&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><h2 id="åœ¨-valine-è¾“å…¥ç•Œé¢å¢åŠ èƒŒæ™¯å›¾"><a href="#åœ¨-valine-è¾“å…¥ç•Œé¢å¢åŠ èƒŒæ™¯å›¾" class="headerlink" title="åœ¨ valine è¾“å…¥ç•Œé¢å¢åŠ èƒŒæ™¯å›¾"></a>åœ¨ valine è¾“å…¥ç•Œé¢å¢åŠ èƒŒæ™¯å›¾</h2><p>å»ºè®®å¤§å®¶åœ¨æ‰¾å›¾çš„æ—¶å€™æœ€å¥½æ‰¾ç™½è‰²èƒŒæ™¯æˆ–è€…é€æ˜èƒŒæ™¯çš„ï¼Œä¸ç„¶çœ‹èµ·æ¥å¾ˆéš¾çœ‹ã€‚</p><img src= "/img/loading.gif" data-src="http://qiniu.webpages.show/images/1595912900562.jpg"><p>ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼Œå°† CSS åŠ åˆ°ä½ çš„åšå®¢æ ·å¼æ–‡ä»¶ä¸­. æˆ‘æ˜¯åœ¨<code>Butterfly/source/css/</code>ç›®å½•ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vim veditor.css</span><br><span class="line"></span><br><span class="line">#veditor &#123;</span><br><span class="line">background-image: url(https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;drew233&#x2F;cdn&#x2F;20200409110727.webp);</span><br><span class="line">background-size: contain;</span><br><span class="line">background-repeat: no-repeat;</span><br><span class="line">background-position: right;</span><br><span class="line">background-color: rgba(255, 255, 255, 0);</span><br><span class="line">resize: vertical</span><br><span class="line">&#125;</span><br><span class="line">#veditor:focus&#123;</span><br><span class="line">background-position-y: 200px;</span><br><span class="line">transition: all 0.2s ease-in-out 0s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘åœ¨å…¬å…±<code>Butterfly/source/js/main.js</code> æ·»åŠ ä»¥ä¸‹ä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;å¯ä»¥ä¸ valine çš„é…ç½® js æ–‡ä»¶æ”¾ä¸€èµ·ï¼Œæˆ–æ”¾ç½®åˆ°å…¬å…± js æ–‡ä»¶ä¸­</span><br><span class="line">$(&quot;#veditor&quot;).focus(function()&#123;$(this).css(&quot;background-image&quot;,&quot;none&quot;);&#125;);</span><br><span class="line">$(&quot;#veditor&quot;).blur(function()&#123;</span><br><span class="line">      $(this).css(&quot;background-image&quot;,&quot;url(https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;drew233&#x2F;cdn&#x2F;20200409110727.webp)&quot;);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¼•ç”¨æ–¹å¼åœ¨<code>Butterfly/_config.yml</code>ä¸­<code>inject</code>æ·»åŠ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">inject:</span><br><span class="line">   head:</span><br><span class="line">     - &lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;&#x2F;css&#x2F;veditor.css&quot;&gt;</span><br><span class="line">&#96;&#96;&#96; </span><br><span class="line">## å¢åŠ åšä¸»ã€å°ä¼™ä¼´æ ‡è¯†ä»¥åŠæµè§ˆå™¨å›¾æ ‡</span><br><span class="line">åŸç”Ÿçš„ Valine å°±ä¸æ”¯æŒäº†ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨é­”æ”¹çš„ Valine æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥å°†åŸç”Ÿçš„ Valine æ›¿æ¢ä¸ºä»¥ä¸‹çš„ Valine.min.js æ–‡ä»¶</span><br></pre></td></tr></table></figure><p>//é­”æ”¹ç‰ˆ Valine.min.js<br><a href="https://cdn.jsdelivr.net/gh/HCLonely/Valine@latest/dist/Valine.min.js" target="_blank" rel="noopener">https://cdn.jsdelivr.net/gh/HCLonely/Valine@latest/dist/Valine.min.js</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">å¼•ç”¨æ–¹å¼åœ¨&#96;Butterfly&#x2F;_config.yml&#96;ä¸­&#96;CDN&#96;</span><br></pre></td></tr></table></figure><p>#valine: <a href="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js" target="_blank" rel="noopener">https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js</a><br>valine: <a href="https://cdn.jsdelivr.net/gh/HCLonely/Valine@latest/dist/Valine.min.js" target="_blank" rel="noopener">https://cdn.jsdelivr.net/gh/HCLonely/Valine@latest/dist/Valine.min.js</a></p><pre><code></code></pre>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> butterfly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo-douban æ’ä»¶ä½¿ç”¨ä¸é—®é¢˜</title>
      <link href="/p/2651b0bd/"/>
      <url>/p/2651b0bd/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="hexo-douban"><a href="#hexo-douban" class="headerlink" title="hexo-douban"></a>hexo-douban</h1><p>ä¸€ä¸ªåœ¨ <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> é¡µé¢ä¸­åµŒå…¥è±†ç“£ä¸ªäººä¸»é¡µçš„å°æ’ä»¶.</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-douban --save</span><br></pre></td></tr></table></figure><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>å°†ä¸‹é¢çš„é…ç½®å†™å…¥ç«™ç‚¹çš„é…ç½®æ–‡ä»¶ <code>_config.yml</code> é‡Œ(ä¸æ˜¯ä¸»é¢˜çš„é…ç½®æ–‡ä»¶).</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">douban:</span></span><br><span class="line">  <span class="attr">user:</span> <span class="string">mythsman</span></span><br><span class="line">  <span class="attr">builtin:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">book:</span></span><br><span class="line">    <span class="attr">title:</span> <span class="string">'This is my book title'</span></span><br><span class="line">    <span class="attr">quote:</span> <span class="string">'This is my book quote'</span></span><br><span class="line">  <span class="attr">movie:</span></span><br><span class="line">    <span class="attr">title:</span> <span class="string">'This is my movie title'</span></span><br><span class="line">    <span class="attr">quote:</span> <span class="string">'This is my movie quote'</span></span><br><span class="line">  <span class="attr">game:</span></span><br><span class="line">    <span class="attr">title:</span> <span class="string">'This is my game title'</span></span><br><span class="line">    <span class="attr">quote:</span> <span class="string">'This is my game quote'</span></span><br><span class="line">  <span class="attr">timeout:</span> <span class="number">10000</span></span><br></pre></td></tr></table></figure><ul><li><strong>user</strong>: ä½ çš„è±†ç“£ID.æ‰“å¼€è±†ç“£ï¼Œç™»å…¥è´¦æˆ·ï¼Œç„¶ååœ¨å³ä¸Šè§’ç‚¹å‡» â€œä¸ªäººä¸»é¡µâ€ ï¼Œè¿™æ—¶å€™åœ°å€æ çš„URLå¤§æ¦‚æ˜¯è¿™æ ·ï¼šâ€<a href="https://www.douban.com/people/xxxxxx/&quot;" target="_blank" rel="noopener">https://www.douban.com/people/xxxxxx/&quot;</a> ï¼Œå…¶ä¸­çš„â€xxxxxxâ€å°±æ˜¯ä½ çš„ä¸ªäººIDäº†ã€‚</li><li><strong>builtin</strong>: æ˜¯å¦å°†ç”Ÿæˆé¡µé¢çš„åŠŸèƒ½åµŒå…¥<code>hexo s</code>å’Œ<code>hexo g</code>ä¸­ï¼Œé»˜è®¤æ˜¯<code>false</code>,å¦ä¸€å¯é€‰é¡¹ä¸º<code>true</code>(1.x.xç‰ˆæœ¬æ–°å¢é…ç½®é¡¹)ã€‚</li><li><strong>title</strong>: è¯¥é¡µé¢çš„æ ‡é¢˜.</li><li><strong>quote</strong>: å†™åœ¨é¡µé¢å¼€å¤´çš„ä¸€æ®µè¯,æ”¯æŒhtmlè¯­æ³•.</li><li><strong>timeout</strong>: çˆ¬å–æ•°æ®çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤æ˜¯ 10000ms ,å¦‚æœåœ¨ä½¿ç”¨æ—¶å‘ç°æŠ¥äº†è¶…æ—¶çš„é”™(ETIMEOUT)å¯ä»¥æŠŠè¿™ä¸ªæ•°æ®è®¾ç½®çš„å¤§ä¸€ç‚¹ã€‚</li></ul><p>å¦‚æœåªæƒ³æ˜¾ç¤ºæŸä¸€ä¸ªé¡µé¢(æ¯”å¦‚movie)ï¼Œé‚£å°±æŠŠå…¶ä»–çš„é…ç½®é¡¹æ³¨é‡Šæ‰å³å¯ã€‚</p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><h3 id="1-x-xç‰ˆæœ¬"><a href="#1-x-xç‰ˆæœ¬" class="headerlink" title="1.x.xç‰ˆæœ¬"></a>1.x.xç‰ˆæœ¬</h3><p>åœ¨0.x.xç‰ˆæœ¬ä¸­ï¼Œæ–‡ç« çš„æ›´æ–°å’Œè±†ç“£é¡µé¢çš„çˆ¬å–æ“ä½œæ˜¯ç»‘å®šåœ¨ä¸€èµ·çš„ï¼Œæ— æ³•æ”¯æŒå•ç‹¬æ›´æ–°æ–‡ç« æˆ–è€…å•ç‹¬çˆ¬å–æ–‡ç« ã€‚</p><p>åœ¨1.x.xç‰ˆæœ¬ä¸­ï¼Œä½¿ç”¨<code>hexo douban</code>å‘½ä»¤å³å¯ç”ŸæˆæŒ‡å®šé¡µé¢ï¼Œå¦‚æœä¸åŠ å‚æ•°ï¼Œé‚£ä¹ˆé»˜è®¤å‚æ•°ä¸º<code>-bgm</code>ã€‚</p><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯</strong>ï¼Œé€šå¸¸å¤§å®¶éƒ½å–œæ¬¢ç”¨<code>hexo d</code>æ¥ä½œä¸º<code>hexo deploy</code>å‘½ä»¤çš„ç®€åŒ–ï¼Œä½†æ˜¯å½“å®‰è£…äº†<code>hexo douban</code>ä¹‹åï¼Œå°±ä¸èƒ½ç”¨<code>hexo d</code>äº†ï¼Œå› ä¸º<code>hexo douban</code>è·Ÿ<code>hexo deploy</code>çš„å‰ç¼€éƒ½æ˜¯<code>hexo d</code>ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ hexo douban -h</span><br><span class="line">Usage: hexo douban</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line">Generate pages from douban</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -b, --books   Generate douban books only</span><br><span class="line">  -g, --games   Generate douban games only</span><br><span class="line">  -m, --movies  Generate douban movies only</span><br></pre></td></tr></table></figure><p>å¦‚æœé…ç½®äº†<code>builtin</code>å‚æ•°ä¸º<code>true</code>ï¼Œé‚£ä¹ˆé™¤äº†å¯ä»¥ä½¿ç”¨<code>hexo douban</code>å‘½ä»¤ä¹‹å¤–ï¼Œ<code>hexo g</code>æˆ–<code>hexo s</code>ä¹Ÿå†…åµŒäº†ç”Ÿæˆé¡µé¢çš„åŠŸèƒ½ã€‚</p><h3 id="0-x-xç‰ˆæœ¬"><a href="#0-x-xç‰ˆæœ¬" class="headerlink" title="0.x.xç‰ˆæœ¬"></a>0.x.xç‰ˆæœ¬</h3><p>ç›´æ¥ä½¿ç”¨å‘½ä»¤<code>hexo g</code>å³åœ¨ç”Ÿæˆé™æ€é¡µé¢å‰çˆ¬å–è±†ç“£æ•°æ®ï¼Œå¦‚æœä½¿ç”¨<code>hexo s</code>åˆ™ä¼šç›‘å¬æ–‡ä»¶å˜åŠ¨ï¼Œæ¯æœ‰ä¸€æ¬¡å˜åŠ¨å°±ä¼šé‡æ–°çˆ¬å–æ•°æ®ã€‚</p><h2 id="å‡çº§"><a href="#å‡çº§" class="headerlink" title="å‡çº§"></a>å‡çº§</h2><p>æˆ‘ä¼šä¸å®šæœŸæ›´æ–°ä¸€äº›åŠŸèƒ½æˆ–è€…ä¿®æ”¹ä¸€äº›Bugï¼Œæ‰€ä»¥å¦‚æœæƒ³ä½¿ç”¨æœ€æ–°çš„ç‰¹æ€§ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„æ–¹æ³•æ¥æ›´æ–°:</p><ol><li>ä¿®æ”¹package.jsonå†…hexo-doubançš„ç‰ˆæœ¬å·è‡³æœ€æ–°</li><li>é‡æ–°å®‰è£…æœ€æ–°ç‰ˆæœ¬<code>npm install hexo-douban --save</code></li></ol><p>æˆ–è€…ä½¿ç”¨<code>npm install hexo-douban --update --save</code>ç›´æ¥æ›´æ–°ã€‚</p><h2 id="æ˜¾ç¤º"><a href="#æ˜¾ç¤º" class="headerlink" title="æ˜¾ç¤º"></a>æ˜¾ç¤º</h2><p>å¦‚æœä¸Šé¢çš„é…ç½®å’Œæ“ä½œéƒ½æ²¡é—®é¢˜ï¼Œå°±å¯ä»¥åœ¨ç”Ÿæˆç«™ç‚¹ä¹‹åæ‰“å¼€ <code>//yourblog/books</code> å’Œ <code>//yourblog/movies</code>, <code>//yourblog/games</code>, æ¥æŸ¥çœ‹ç»“æœ.</p><h2 id="èœå•"><a href="#èœå•" class="headerlink" title="èœå•"></a>èœå•</h2><p>å¦‚æœä¸Šé¢çš„æ˜¾ç¤ºæ²¡æœ‰é—®é¢˜å°±å¯ä»¥åœ¨ä¸»é¢˜çš„é…ç½®æ–‡ä»¶ <code>_config.yml</code> é‡Œæ·»åŠ å¦‚ä¸‹é…ç½®æ¥ä¸ºè¿™äº›é¡µé¢æ·»åŠ èœå•é“¾æ¥.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="attr">Home:</span> <span class="string">/</span></span><br><span class="line">  <span class="attr">Archives:</span> <span class="string">/archives</span></span><br><span class="line">  <span class="attr">Books:</span> <span class="string">/books</span>     <span class="comment">#This is your books page</span></span><br><span class="line">  <span class="attr">Movies:</span> <span class="string">/movies</span>   <span class="comment">#This is your movies page</span></span><br><span class="line">  <span class="attr">Games:</span> <span class="string">/games</span>   <span class="comment">#This is your games page</span></span><br></pre></td></tr></table></figure><h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><ol><li>å…³äºå°†builtinè®¾ç½®ä¸ºtrueæˆ–è€…falseçš„é—®é¢˜<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è®¾ç½®ä¸ºtrue</span><br><span class="line">ç›´æ¥ä½¿ç”¨å‘½ä»¤&#96;hexo g&#96;å³åœ¨ç”Ÿæˆé™æ€é¡µé¢å‰çˆ¬å–è±†ç“£æ•°æ®ï¼Œä¸éœ€è¦å…ˆæ‰§è¡Œ hexo douban</span><br></pre></td></tr></table></figure></li><li>å…³äºæŠ¥<code>userid</code> è®¾ç½®å®Œæˆï¼Œ<code>hexo g</code> æŠ“å–ä¸åˆ°ä¿¡æ¯çš„é—®é¢˜<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0 books have been loaded in 3066 ms, because you are offline or your network is bad</span><br><span class="line">0 movies have been loaded in 3041 ms, because you are offline or your network is bad</span><br></pre></td></tr></table></figure><code>timeout</code> é…ç½®ä¸º <code>timeout: 10000</code></li></ol><p>è§£å†³æ–¹å¼</p><p>å°è¯•ä½¿ç”¨åˆ«çš„nodejsç‰ˆæœ¬ï¼Œä¹‹å‰ç”¨çš„14.xx.xxç‰ˆæœ¬çš„ä¸è¡Œï¼Œå¸è½½nodejsï¼Œå®‰è£…12.18.0ç‰ˆæœ¬è§£å†³ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> douban </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°ä¸€æ¬¡Centos7.5å‡çº§OpenSSH8.0p1</title>
      <link href="/p/12223247/"/>
      <url>/p/12223247/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>æœåŠ¡å™¨ç‰ˆæœ¬ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># cat &#x2F;etc&#x2F;redhat-release</span><br><span class="line">CentOS Linux release 7.5.1804 (Core)</span><br></pre></td></tr></table></figure><p>å‡çº§å‰sshç‰ˆæœ¬ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ssh -V</span><br><span class="line">OpenSSH_7.4p1, OpenSSL 1.0.2k-fips  26 Jan 2017</span><br></pre></td></tr></table></figure><p>å‡çº§åsshç‰ˆæœ¬ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ssh -V</span><br><span class="line">OpenSSH_8.0p1, OpenSSL 1.0.2k-fips  26 Jan 2017</span><br></pre></td></tr></table></figure><p>ä¸ºé˜²æ­¢å‡çº§å¤±è´¥æ— æ³•è¿œç¨‹è¿æ¥ï¼Œå®‰è£…telnetï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># yum install -y telnet-server</span><br><span class="line"># yum install -y xinetd</span><br><span class="line"># systemctl start telnet.socket</span><br><span class="line"># systemctl start  xinetd</span><br></pre></td></tr></table></figure><p>å…è®¸rootç™»å½•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># echo &#39;pts&#x2F;0&#39; &gt;&gt;&#x2F;etc&#x2F;securetty</span><br><span class="line"># echo &#39;pts&#x2F;1&#39; &gt;&gt;&#x2F;etc&#x2F;securetty</span><br><span class="line"># systemctl restart telnet.socket</span><br></pre></td></tr></table></figure><p>å¼€å¯telnetå’Œxinetdå¼€æœºè‡ªåŠ¨å¯åŠ¨ï¼Œé¿å…rebootåè¿ä¸ä¸ŠTelnetï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># systemctl enable xinetd.service</span><br><span class="line"># systemctl enable telnet.socket</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä¸€ä¸‹telnetè¿æ¥ï¼Œç„¶åå°±å¯ä»¥å…ˆæ”¾ç€äº†ï¼Œè¿™åªæ˜¯ä»¥é˜²ä¸‡ä¸€ï¼Œæ¥ä¸‹æ¥è¿˜æ˜¯æ­£å¸¸ä½¿ç”¨sshè¿æ¥æ“ä½œ</p><p>ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„åŒ…ï¼ˆopenssh-8.0p1.tar.gzï¼‰å¹¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Š</p><p>å¤‡ä»½æ–‡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># cp -r &#x2F;etc&#x2F;ssh &#x2F;etc&#x2F;ssh.old</span><br></pre></td></tr></table></figure><p>å¸è½½æ—§çš„sshï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># rpm -qa|grep openssh</span><br><span class="line">openssh-server-7.4p1-11.el7.x86_64</span><br><span class="line">openssh-7.4p1-11.el7.x86_64</span><br><span class="line">openssh-clients-7.4p1-11.el7.x86_64</span><br><span class="line"># rpm -e --nodeps openssh-server-7.4p1-11.el7.x86_64</span><br><span class="line"># rpm -e --nodeps openssh-7.4p1-11.el7.x86_64</span><br><span class="line"># rpm -e --nodeps openssh-clients-7.4p1-11.el7.x86_64</span><br><span class="line"># rpm -qa|grep openssh</span><br></pre></td></tr></table></figure><p>å®‰è£…ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># install -v -m700 -d &#x2F;var&#x2F;lib&#x2F;sshd</span><br><span class="line"># chown -v root:sys &#x2F;var&#x2F;lib&#x2F;sshd</span><br><span class="line"># groupadd -g 50 sshd</span><br><span class="line"># useradd -c &#39;sshd PrivSep&#39; -d &#x2F;var&#x2F;lib&#x2F;sshd -g sshd -s &#x2F;bin&#x2F;false -u 50 sshd</span><br><span class="line"># tar -zxvf openssh-8.0p1.tar.gz</span><br><span class="line"># cd openssh-8.0p1</span><br><span class="line"># .&#x2F;configure --prefix&#x3D;&#x2F;usr --sysconfdir&#x3D;&#x2F;etc&#x2F;ssh --with-md5-passwords --with-privsep-path&#x3D;&#x2F;var&#x2F;lib&#x2F;sshd</span><br><span class="line"># make</span><br><span class="line"># chmod 600 &#x2F;etc&#x2F;ssh&#x2F;ssh_host_rsa_key</span><br><span class="line"># chmod 600 &#x2F;etc&#x2F;ssh&#x2F;ssh_host_ecdsa_key</span><br><span class="line"># chmod 600 &#x2F;etc&#x2F;ssh&#x2F;ssh_host_ed25519_key</span><br><span class="line"># make install</span><br><span class="line"># install -v -m755 contrib&#x2F;ssh-copy-id &#x2F;usr&#x2F;bin</span><br><span class="line"># install -v -m644 contrib&#x2F;ssh-copy-id.1 &#x2F;usr&#x2F;share&#x2F;man&#x2F;man1</span><br><span class="line"># install -v -m755 -d &#x2F;usr&#x2F;share&#x2F;doc&#x2F;openssh-8.0p1</span><br><span class="line"># install -v -m644 INSTALL LICENCE OVERVIEW README* &#x2F;usr&#x2F;share&#x2F;doc&#x2F;openssh-8.0p1</span><br></pre></td></tr></table></figure><p>è®¾ç½®å…è®¸rootç™»å½•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># echo &quot;PermitRootLogin yes&quot; &gt;&gt; &#x2F;etc&#x2F;ssh&#x2F;sshd_config</span><br></pre></td></tr></table></figure><p>è®¾ç½®å¼€æœºè‡ªå¯åŠ¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># cp -p contrib&#x2F;redhat&#x2F;sshd.init &#x2F;etc&#x2F;init.d&#x2F;sshd</span><br><span class="line"># chmod +x &#x2F;etc&#x2F;init.d&#x2F;sshd</span><br><span class="line"># chkconfig --add sshd</span><br><span class="line"># chkconfig sshd on</span><br><span class="line"># chkconfig --list sshd</span><br><span class="line"># systemctl restart sshd</span><br></pre></td></tr></table></figure><p>å‡çº§å®Œæˆï¼ŒæŸ¥çœ‹ç‰ˆæœ¬ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ssh -V</span><br><span class="line">OpenSSH_8.0p1, OpenSSL 1.0.2k-fips  26 Jan 2017</span><br></pre></td></tr></table></figure><p>PS1ï¼šå‡çº§å®Œæˆååˆ«å¿˜äº†æ¢å¤ä»¥å‰çš„telnetè®¾ç½®æˆ–å…³é—­telnet.</p><p>PS2ï¼šå¦‚æœä¸­é—´æœ‰é—®é¢˜å‡çº§å¤±è´¥ï¼Œä¸”ä¹‹å‰æ˜¯rpmåŒ…å®‰è£…çš„ï¼Œå¯ä»¥ç›´æ¥ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå›æ»šï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># yum -y install openssh-clients</span><br><span class="line"># yum -y install openssh-server</span><br><span class="line"># yum -y install openssh</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OpenSSH </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OpenSSh </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gitlabé…ç½®åŸŸåå¹¶httpsè®¿é—®</title>
      <link href="/p/5e94d2a7/"/>
      <url>/p/5e94d2a7/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h3 id="Gitlabé»˜è®¤Nginx80ç«¯å£"><a href="#Gitlabé»˜è®¤Nginx80ç«¯å£" class="headerlink" title="Gitlabé»˜è®¤Nginx80ç«¯å£"></a>Gitlabé»˜è®¤Nginx80ç«¯å£</h3><p>å¦‚æœæœºå™¨æœªå æœ‰80ç«¯å£ï¼Œå¯ä»¥ç›´æ¥æ›¿æ¢æˆåŸŸåï¼Œè§£æåå°±å¯ä»¥ç›´æ¥è®¿é—®ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">grep &quot;^external_url&quot; &#x2F;etc&#x2F;gitlab&#x2F;gitlab.rb #æŸ¥çœ‹å½“å‰ç»‘å®šçš„åŸŸåæˆ–è€…IP</span><br><span class="line">vim &#x2F;etc&#x2F;gitlab&#x2F;gitlab.rb   #æ‰“å¼€é…ç½®æ–‡ä»¶</span><br><span class="line"># external_url &#39;http:&#x2F;&#x2F;192.168.174.131&#39;  #æ›¿æ¢   #ä¿®æ”¹æˆåŸŸåè®¿é—®</span><br><span class="line">external_url &#39;http:&#x2F;&#x2F;gitlab.inewmaker.com&#39;  </span><br><span class="line">gitlab-ctl reconfigure   #é‡æ–°è·‘ä¸€ä¸‹é…ç½®</span><br></pre></td></tr></table></figure><p>å¦‚æœæœºå™¨80ç«¯å£ä»¥å æœ‰ï¼Œéœ€è¦ä¿®æ”¹gitlabç«¯å£ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grep &quot;&#39;listen_port&quot; &#x2F;etc&#x2F;gitlab&#x2F;gitlab.rb   #æŸ¥çœ‹é»˜è®¤ç«¯å£</span><br><span class="line">vim &#x2F;etc&#x2F;gitlab&#x2F;gitlab.rb   #æ‰“å¼€é…ç½®æ–‡ä»¶</span><br><span class="line">nginx[&#39;listen_port&#39;] &#x3D; 800     #æ‰¾åˆ°å–æ¶ˆæ³¨é‡Šï¼Œä¿®æ”¹ç«¯å£</span><br><span class="line">gitlab-ctl reconfigure   #é‡æ–°è·‘ä¸€ä¸‹é…ç½®</span><br></pre></td></tr></table></figure><p>ç”±äºæ›´æ”¹ç«¯å£ï¼ŒåŸŸåè§£æä¸åˆ°ã€‚æä¾›æ–¹å¼ä½¿ç”¨äº‘æœåŠ¡ä¸­çš„è´Ÿè½½å‡è¡¡ã€‚</p><h3 id="Gitlabé…ç½®HTTPS"><a href="#Gitlabé…ç½®HTTPS" class="headerlink" title="Gitlabé…ç½®HTTPS"></a>Gitlabé…ç½®HTTPS</h3><p>   æ³¨ï¼š<br>   gitlabæœ€æ–°æ˜¯å¼€å¯httpsä¼šè‡ªåŠ¨é…ç½®ï¼Œä½†åªæœ‰ä¸‰ä¸ªæœˆæœ‰æ•ˆæœŸ<br>   ä½¿ç”¨è‡ªå·±è®¾çš„åŠ å¯†è¯ä¹¦åº”è®¾ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨è‡ªå·±è®¾çš„åŠ å¯†è¯ä¹¦åº”è®¾ç½®</span><br><span class="line">vim &#x2F;etc&#x2F;gitlab&#x2F;gitlab.rb</span><br><span class="line"></span><br><span class="line">letsencrypt[&#39;enable&#39;] &#x3D; false</span><br><span class="line">letsencrypt[&#39;auto_renew&#39;] &#x3D; false</span><br></pre></td></tr></table></figure><pre><code>åœ¨/etc/gitlab/gitlab.rbç¦ç”¨è‡ªåŠ¨æ›´æ–°ã€‚å¦åˆ™ï¼Œgitlab-ctl reconfigure å¯èƒ½ä¼šå°è¯•æ›´æ–°è¯ä¹¦ï¼Œä»è€Œè¦†ç›–å®ƒä»¬ã€‚å¦‚æœgitlabè‡ªç­¾çš„è¯ä¹¦è¿‡æœŸï¼Œæ›¿æ¢çš„ä¸€å®šè¦ç¦ç”¨è‡ªåŠ¨æ›´æ–°</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkdir &#x2F;etc&#x2F;gitlab&#x2F;ssl   #æŠŠç”³è¯·çš„è¯ä¹¦æ”¾åœ¨è¿™é‡Œ</span><br><span class="line">vim  &#x2F;etc&#x2F;gitlab&#x2F;gitlab.rb   #æ‰“å¼€é…ç½®æ–‡ä»¶</span><br><span class="line">external_url &#39;external_url &#39;https:&#x2F;&#x2F;gitlab.inewmaker.com&#39;  # æ³¨ï¼šä¸€å®šè¦HTTPS</span><br><span class="line">nginx[&#39;redirect_http_to_https&#39;]&#x3D; true   #å–æ¶ˆæ³¨é‡Šæ”¹ä¸º true</span><br><span class="line">nginx[&#39;ssl_certificate&#39;] &#x3D; &quot;&#x2F;etc&#x2F;gitlab&#x2F;ssl&#x2F;gitlab.pem&quot;    #æ”¾ç½®å¯¹åº”çš„è¯ä¹¦å¯†é’¥</span><br><span class="line">nginx[&#39;ssl_certificate_key&#39;] &#x3D; &quot;&#x2F;etc&#x2F;gitlab&#x2F;ssl&#x2F;gitlab.key&quot; #æ”¾ç½®å¯¹åº”çš„è¯ä¹¦å¯†é’¥</span><br><span class="line">gitlab-ctl reconfigure  #ä½¿é…ç½®ç”Ÿæ•ˆ</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ctl restart  # ä½¿é…ç½®ç”Ÿæ•ˆ #</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Gitlab </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gitlab </tag>
            
            <tag> https </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginx è¿”å›ç  426 upgrade required å¤„ç†</title>
      <link href="/p/328665dd/"/>
      <url>/p/328665dd/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">426 upgrade required</span><br><span class="line"></span><br><span class="line">è¯·æ±‚è¿”å› 426</span><br><span class="line"></span><br><span class="line">nginx åå‘ä»£ç†é»˜è®¤èµ°çš„http 1.0ç‰ˆæœ¬</span><br><span class="line"></span><br><span class="line">ä½†æ˜¯ è¢«åå‘ä»£ç†çš„æœåŠ¡å™¨æ˜¯1.1ç‰ˆæœ¬çš„!</span><br><span class="line"></span><br><span class="line">so åœ¨åå‘ä»£ç†çš„æ—¶å€™åŠ ä¸Šä¸€å¥</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxy_http_version 1.1;</span><br></pre></td></tr></table></figure><p>å®ä¾‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">   location ~* \.do &#123;</span><br><span class="line">                #if ($http_x_forwarded_proto !&#x3D; &quot;https&quot;) &#123;</span><br><span class="line">                #      rewrite ^(.*)$ https:&#x2F;&#x2F;$server_name$1 permanent;</span><br><span class="line">                #&#125;</span><br><span class="line">               proxy_http_version 1.1;</span><br><span class="line">               proxy_pass http:&#x2F;&#x2F;test-h5-api.7dian7fen.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> è¿”å›ç  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¸¸è§çš„é‡å®šå‘æ–¹å¼</title>
      <link href="/p/bb2a8a2e/"/>
      <url>/p/bb2a8a2e/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>ç¬¬ä¸€ç§ï¼šä½¿ç”¨==rewrite==æŒ‡ä»¤ï¼Œé€šè¿‡æ­£åˆ™åŒ¹é…æ‰€æœ‰çš„URIåå†å»æ‰å¼€å¤´ç¬¬ä¸€ä¸ª/(åæ–œçº¿)ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rewrite ^&#x2F;(.*)$ https:&#x2F;&#x2F;www.linux.com&#x2F;$1;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§ï¼šåŒæ ·ä½¿ç”¨rewriteæŒ‡ä»¤ï¼Œä¸åŒçš„æ˜¯é€šè¿‡==$request_uri==å˜é‡åŒ¹é…æ‰€æœ‰çš„URIã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rewrite ^ https:&#x2F;&#x2F;www.linux.com$request_uri? permanent;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å†™çš„å¥½å¤„æ˜¯çœå»äº†å»æ‰å¼€å¤´ç¬¬ä¸€ä¸ªåæ–œçº¿çš„è¿‡ç¨‹ï¼Œæ­£åˆ™åŒ¹é…ä¸Šæ€§èƒ½æ›´ä¼˜ã€‚<br>ç¬¬ä¸‰ç§ï¼šä½¿ç”¨==return==æŒ‡ä»¤ï¼Œé€šè¿‡301çŠ¶æ€ç å’Œ==$request_uri==å‚æ•°ï¼Œç›´æ¥å‘Šè¯‰Nginxè¿™æ˜¯ä¸ª301é‡å®šå‘å’ŒæŠ“å–æŒ‡å®šURIã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">return 301 https:&#x2F;&#x2F;www.linux.com$request_uri;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹æ³•æ˜¯æ€§èƒ½ä¸Šæœ€ä¼˜çš„ï¼Œå› ä¸ºrewriteæŒ‡ä»¤æœ‰å¾ˆå¤šå†™æ³•å’Œè§„åˆ™ï¼Œæ‰§è¡Œå®Œæ‰€æœ‰æ­£åˆ™åŒ¹é…åï¼ŒNginx æ‰ä¼šçŸ¥é“è¿™æ˜¯ä¸€ä¸ª301æ°¸ä¹…é‡å®šå‘ã€‚</p><p>é€šè¿‡ä»¥ä¸Šä¸‰ç§å†™æ³•ä»‹ç»ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºreturnæŒ‡ä»¤åœ¨301è·³è½¬ä¸Šæ¯”rewriteæŒ‡ä»¤æ€§èƒ½ä¸Šæ›´åŠ æœ‰ä¼˜åŠ¿ã€‚è™½ç„¶åœ¨è®¿é—®é‡ä¸å¤§çš„æƒ…å†µä¸‹å‡ ç§å†™æ³•çš„æ€§èƒ½è¡¨ç°ä¸ŠåŒºåˆ«å¹¶ä¸å¤§ï¼Œä¸è¿‡åœ¨æµ·é‡è®¿é—®ä¸­ä¸€ä¸ªå°å°çš„ä¼˜åŒ–ä¹Ÿèƒ½åœ¨æå‡ä¸šåŠ¡ç³»ç»Ÿæ€§èƒ½ä¸Šèµ·åˆ°ä¸å°çš„ä½œç”¨å“Ÿï¼</p>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> é‡å®šå‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginx rewrite ç”¨æ³•ï¼Œç”¨rewriteå»é™¤URLä¸­çš„ç‰¹å®šå‚æ•°</title>
      <link href="/p/fffbf386/"/>
      <url>/p/fffbf386/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h2 id="nginx-rewrite-ç”¨æ³•ï¼Œç”¨rewriteå»é™¤URLä¸­çš„ç‰¹å®šå‚æ•°"><a href="#nginx-rewrite-ç”¨æ³•ï¼Œç”¨rewriteå»é™¤URLä¸­çš„ç‰¹å®šå‚æ•°" class="headerlink" title="nginx rewrite ç”¨æ³•ï¼Œç”¨rewriteå»é™¤URLä¸­çš„ç‰¹å®šå‚æ•°"></a>nginx rewrite ç”¨æ³•ï¼Œç”¨rewriteå»é™¤URLä¸­çš„ç‰¹å®šå‚æ•°</h2><p>æ—¥å¸¸æœåŠ¡ä¸­ç»å¸¸ä¼šç”¨Nginxåšä¸€å±‚ä»£ç†è½¬å‘ï¼ŒæŠŠNginxå½“åšå‰ç½®æœº</p><p>æ¯”å¦‚ï¼Œä»¥ä¸‹é…ç½®:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    # å¯¹å¤–æš´éœ² 80 ç«¯å£</span><br><span class="line">    listen    80;</span><br><span class="line">    server_name 192.168.10.231;</span><br><span class="line"></span><br><span class="line">    # åç«¯APIåœ°å€æš´éœ²ä¸ºï¼šhttp:&#x2F;&#x2F;192.168.10.231&#x2F;apis</span><br><span class="line">    location &#x2F;apis &#123;</span><br><span class="line">        proxy_pass   http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;;</span><br><span class="line">        proxy_pass_request_headers      on;</span><br><span class="line">          # é‡å†™URL å»é™¤apis</span><br><span class="line">        rewrite &quot;^&#x2F;apis&#x2F;(.*)$&quot; &#x2F;$1 break;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¿™é‡Œçš„rewrite å°±æ˜¯ä¸ºäº†å»é™¤URLä¸­çš„/apis,å®é™…çš„åç«¯apiä¸­æ˜¯æ²¡æœ‰è¿™ä¸ªå‚æ•°çš„ï¼Œä½†æ˜¯ä¸ºäº†åšåˆ°åœ¨Nginxè½¬å‘è¯·æ±‚ï¼Œå‰ç«¯éœ€è¦åŠ ä¸Šè¿™ä¸ªå‚æ•°ï¼Œä»¥ä¾¿äºåŒºåˆ«</strong></p><p>æ¯”å¦‚å‰ç«¯çš„è¯·æ±‚åœ°å€æ˜¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.10.231&#x2F;apis&#x2F;user</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå®é™…ä¸Šç»è¿‡Nginxè½¬å‘åè¯·æ±‚çš„åœ°å€æ˜¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;user</span><br></pre></td></tr></table></figure><p><strong>rewrite â€œ^/api/(.)$â€ /$1 breakï¼Œè·¯å¾„é‡å†™ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(1)&quot;^&#x2F;api&#x2F;(.)$&quot;ï¼šåŒ¹é…è·¯å¾„çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨äº†åˆ†ç»„è¯­æ³•å°±æ˜¯*(.)**ï¼ŒæŠŠ&#x2F;api&#x2F;ä»¥åçš„æ‰€æœ‰éƒ¨åˆ†å½“åš1ç»„ï¼›</span><br><span class="line">ï¼ˆ2ï¼‰&#x2F;$1ï¼šé‡å†™çš„ç›®æ ‡è·¯å¾„ï¼Œè¿™é‡Œç”¨$1å¼•ç”¨å‰é¢æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åˆ°çš„åˆ†ç»„ï¼ˆç»„ç¼–å·ä»1å¼€å§‹ï¼Œä¹Ÿå°±æ˜¯apiï¼‰ï¼Œå³&#x2F;api&#x2F;åé¢çš„æ‰€æœ‰ã€‚è¿™æ ·æ–°çš„è·¯å¾„å°±æ˜¯é™¤å»&#x2F;api&#x2F;ä»¥å¤–çš„æ‰€æœ‰ï¼Œå°±è¾¾åˆ°äº†å»é™¤&#x2F;apiå‰ç¼€çš„ç›®çš„</span><br></pre></td></tr></table></figure><p>ï¼›</p><p><strong>breakï¼šæŒ‡ä»¤ï¼Œå¸¸ç”¨çš„æœ‰2ä¸ªï¼Œåˆ†åˆ«æ˜¯ï¼šlastã€breakï¼›</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆ1ï¼‰lastï¼šé‡å†™è·¯å¾„ç»“æŸåï¼Œå°†å¾—åˆ°çš„è·¯å¾„é‡æ–°è¿›è¡Œä¸€æ¬¡è·¯å¾„åŒ¹é…ï¼›</span><br><span class="line">ï¼ˆ2ï¼‰breakï¼šé‡å†™è·¯å¾„ç»“æŸåï¼Œä¸å†é‡æ–°åŒ¹é…è·¯å¾„ã€‚</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> rewrite </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxçš„locationåŒ¹é…</title>
      <link href="/p/8b346831/"/>
      <url>/p/8b346831/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h2 id="è¯­æ³•è§„åˆ™"><a href="#è¯­æ³•è§„åˆ™" class="headerlink" title="è¯­æ³•è§„åˆ™"></a>è¯­æ³•è§„åˆ™</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">location [ &#x3D; | ~ | ~* | ^~ ] uri &#123; ... &#125;</span><br><span class="line">location @name &#123; ... &#125;</span><br></pre></td></tr></table></figure><p>è¯­æ³•è§„åˆ™å¾ˆç®€å•ï¼Œä¸€ä¸ª==location==å…³é”®å­—ï¼Œåé¢è·Ÿç€å¯é€‰çš„ä¿®é¥°ç¬¦ï¼Œåé¢æ˜¯è¦åŒ¹é…çš„å­—ç¬¦ï¼ŒèŠ±æ‹¬å·ä¸­æ˜¯è¦æ‰§è¡Œçš„æ“ä½œã€‚</p><h2 id="ä¿®é¥°ç¬¦"><a href="#ä¿®é¥°ç¬¦" class="headerlink" title="ä¿®é¥°ç¬¦"></a>ä¿®é¥°ç¬¦</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x3D; è¡¨ç¤ºç²¾ç¡®åŒ¹é…ã€‚åªæœ‰è¯·æ±‚çš„urlè·¯å¾„ä¸åé¢çš„å­—ç¬¦ä¸²å®Œå…¨ç›¸ç­‰æ—¶ï¼Œæ‰ä¼šå‘½ä¸­ã€‚</span><br><span class="line">~ è¡¨ç¤ºè¯¥è§„åˆ™æ˜¯ä½¿ç”¨æ­£åˆ™å®šä¹‰çš„ï¼ŒåŒºåˆ†å¤§å°å†™ã€‚</span><br><span class="line">~* è¡¨ç¤ºè¯¥è§„åˆ™æ˜¯ä½¿ç”¨æ­£åˆ™å®šä¹‰çš„ï¼Œä¸åŒºåˆ†å¤§å°å†™ã€‚</span><br><span class="line">^~ è¡¨ç¤ºå¦‚æœè¯¥ç¬¦å·åé¢çš„å­—ç¬¦æ˜¯æœ€ä½³åŒ¹é…ï¼Œé‡‡ç”¨è¯¥è§„åˆ™ï¼Œä¸å†è¿›è¡Œåç»­çš„æŸ¥æ‰¾ã€‚</span><br></pre></td></tr></table></figure><h2 id="åŒ¹é…è¿‡ç¨‹"><a href="#åŒ¹é…è¿‡ç¨‹" class="headerlink" title="åŒ¹é…è¿‡ç¨‹"></a>åŒ¹é…è¿‡ç¨‹</h2><p>å¯¹è¯·æ±‚çš„urlåºåˆ—åŒ–ã€‚ä¾‹å¦‚ï¼Œå¯¹%xxç­‰å­—ç¬¦è¿›è¡Œè§£ç ï¼Œå»é™¤urlä¸­å¤šä¸ªç›¸è¿çš„/ï¼Œè§£æurlä¸­çš„.ï¼Œ..ç­‰ã€‚è¿™ä¸€æ­¥æ˜¯åŒ¹é…çš„å‰ç½®å·¥ä½œã€‚</p><p>locationæœ‰ä¸¤ç§è¡¨ç¤ºå½¢å¼ï¼Œä¸€ç§æ˜¯ä½¿ç”¨å‰ç¼€å­—ç¬¦ï¼Œä¸€ç§æ˜¯ä½¿ç”¨æ­£åˆ™ã€‚å¦‚æœæ˜¯æ­£åˆ™çš„è¯ï¼Œå‰é¢æœ‰<del>æˆ–</del>*ä¿®é¥°ç¬¦ã€‚</p><p>å…·ä½“çš„åŒ¹é…è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p>é¦–å…ˆå…ˆæ£€æŸ¥ä½¿ç”¨å‰ç¼€å­—ç¬¦å®šä¹‰çš„locationï¼Œé€‰æ‹©æœ€é•¿åŒ¹é…çš„é¡¹å¹¶è®°å½•ä¸‹æ¥ã€‚</p><p>å¦‚æœæ‰¾åˆ°äº†ç²¾ç¡®åŒ¹é…çš„locationï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨äº†=ä¿®é¥°ç¬¦çš„locationï¼Œç»“æŸæŸ¥æ‰¾ï¼Œä½¿ç”¨å®ƒçš„é…ç½®ã€‚</p><p>ç„¶åæŒ‰é¡ºåºæŸ¥æ‰¾ä½¿ç”¨æ­£åˆ™å®šä¹‰çš„locationï¼Œå¦‚æœåŒ¹é…åˆ™åœæ­¢æŸ¥æ‰¾ï¼Œä½¿ç”¨å®ƒå®šä¹‰çš„é…ç½®ã€‚</p><p>å¦‚æœæ²¡æœ‰åŒ¹é…çš„æ­£åˆ™locationï¼Œåˆ™ä½¿ç”¨å‰é¢è®°å½•çš„æœ€é•¿åŒ¹é…å‰ç¼€å­—ç¬¦locationã€‚</p><p>åŸºäºä»¥ä¸Šçš„åŒ¹é…è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹ä¸¤ç‚¹å¯ç¤ºï¼š</p><pre><code>ä½¿ç”¨æ­£åˆ™å®šä¹‰çš„locationåœ¨é…ç½®æ–‡ä»¶ä¸­å‡ºç°çš„é¡ºåºå¾ˆé‡è¦ã€‚å› ä¸ºæ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…çš„æ­£åˆ™åï¼ŒæŸ¥æ‰¾å°±åœæ­¢äº†ï¼Œåé¢å®šä¹‰çš„æ­£åˆ™å°±æ˜¯å†åŒ¹é…ä¹Ÿæ²¡æœ‰æœºä¼šäº†ã€‚ä½¿ç”¨ç²¾ç¡®åŒ¹é…å¯ä»¥æé«˜æŸ¥æ‰¾çš„é€Ÿåº¦ã€‚ä¾‹å¦‚ç»å¸¸è¯·æ±‚/çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨=æ¥å®šä¹‰locationã€‚</code></pre><p>ç¤ºä¾‹<br>æ¥ä¸‹æ¥æˆ‘ä»¬ä»¥ä¸€ä¸ªä¾‹å­æ¥å…·ä½“è¯´æ˜ä¸€ä¸‹åŒ¹é…è¿‡ç¨‹ã€‚</p><p>å‡å¦‚æˆ‘ä»¬æœ‰ä¸‹é¢çš„ä¸€æ®µé…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">location &#x3D; &#x2F; &#123;</span><br><span class="line">    [ configuration A ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location &#x2F; &#123;</span><br><span class="line">    [ configuration B ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location &#x2F;user&#x2F; &#123;</span><br><span class="line">    [ configuration C ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location ^~ &#x2F;images&#x2F; &#123;</span><br><span class="line">    [ configuration D ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location ~* \.(gif|jpg|jpeg)$ &#123;</span><br><span class="line">    [ configuration E ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯·æ±‚ ==/== ç²¾å‡†åŒ¹é…Aï¼Œä¸å†å¾€ä¸‹æŸ¥æ‰¾ã€‚</p><p>è¯·æ±‚ ==/index.html== åŒ¹é…Bã€‚é¦–å…ˆæŸ¥æ‰¾åŒ¹é…çš„å‰ç¼€å­—ç¬¦ï¼Œæ‰¾åˆ°æœ€é•¿åŒ¹é…æ˜¯é…ç½®Bï¼Œæ¥ç€åˆæŒ‰ç…§é¡ºåºæŸ¥æ‰¾åŒ¹é…çš„æ­£åˆ™ã€‚ç»“æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå› æ­¤ä½¿ç”¨å…ˆå‰æ ‡è®°çš„æœ€é•¿åŒ¹é…ï¼Œå³é…ç½®Bã€‚</p><p>è¯·æ±‚ ==/user/index.html==åŒ¹é…Cã€‚é¦–å…ˆæ‰¾åˆ°æœ€é•¿åŒ¹é…Cï¼Œç”±äºåé¢æ²¡æœ‰åŒ¹é…çš„æ­£åˆ™ï¼Œæ‰€ä»¥ä½¿ç”¨æœ€é•¿åŒ¹é…Cã€‚<br>è¯·æ±‚ ==/user/1.jpg== åŒ¹é…Eã€‚é¦–å…ˆè¿›è¡Œå‰ç¼€å­—ç¬¦çš„æŸ¥æ‰¾ï¼Œæ‰¾åˆ°æœ€é•¿åŒ¹é…é¡¹Cï¼Œç»§ç»­è¿›è¡Œæ­£åˆ™æŸ¥æ‰¾ï¼Œæ‰¾åˆ°åŒ¹é…é¡¹Eã€‚å› æ­¤ä½¿ç”¨Eã€‚</p><p>è¯·æ±‚ ==/images/1.jpg==åŒ¹é…Dã€‚é¦–å…ˆè¿›è¡Œå‰ç¼€å­—ç¬¦çš„æŸ¥æ‰¾ï¼Œæ‰¾åˆ°æœ€é•¿åŒ¹é…Dã€‚ä½†æ˜¯ï¼Œç‰¹æ®Šçš„æ˜¯å®ƒä½¿ç”¨äº†^~ä¿®é¥°ç¬¦ï¼Œä¸å†è¿›è¡Œæ¥ä¸‹æ¥çš„æ­£åˆ™çš„åŒ¹é…æŸ¥æ‰¾ï¼Œå› æ­¤ä½¿ç”¨Dã€‚è¿™é‡Œï¼Œå¦‚æœæ²¡æœ‰å‰é¢çš„ä¿®é¥°ç¬¦ï¼Œå…¶å®æœ€ç»ˆçš„åŒ¹é…æ˜¯Eã€‚å¤§å®¶å¯ä»¥æƒ³ä¸€æƒ³ä¸ºä»€ä¹ˆã€‚</p><p>è¯·æ±‚ ==/documents/about.html==åŒ¹é…Bã€‚å› ä¸ºBè¡¨ç¤ºä»»ä½•ä»¥/å¼€å¤´çš„URLéƒ½åŒ¹é…ã€‚åœ¨ä¸Šé¢çš„é…ç½®ä¸­ï¼Œåªæœ‰Bèƒ½æ»¡è¶³ï¼Œæ‰€ä»¥åŒ¹é…Bã€‚</p><h2 id="location-nameçš„ç”¨æ³•"><a href="#location-nameçš„ç”¨æ³•" class="headerlink" title="location @nameçš„ç”¨æ³•"></a>location @nameçš„ç”¨æ³•</h2><p>@ç”¨æ¥å®šä¹‰ä¸€ä¸ªå‘½ålocationã€‚ä¸»è¦ç”¨äºå†…éƒ¨é‡å®šå‘ï¼Œä¸èƒ½ç”¨æ¥å¤„ç†æ­£å¸¸çš„è¯·æ±‚ã€‚å…¶ç”¨æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F; &#123;</span><br><span class="line">    try_files $uri $uri&#x2F; @custom</span><br><span class="line">&#125;</span><br><span class="line">location @custom &#123;</span><br><span class="line">    # ...do something</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šä¾‹ä¸­ï¼Œå½“å°è¯•è®¿é—®urlæ‰¾ä¸åˆ°å¯¹åº”çš„æ–‡ä»¶å°±é‡å®šå‘åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„å‘½ålocationï¼ˆæ­¤å¤„ä¸ºcustomï¼‰ã€‚</p><p><strong>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå‘½ålocationä¸­ä¸èƒ½å†åµŒå¥—å…¶å®ƒçš„å‘½ålocation</strong>ã€‚</p><h2 id="URLå°¾éƒ¨çš„-éœ€ä¸éœ€è¦"><a href="#URLå°¾éƒ¨çš„-éœ€ä¸éœ€è¦" class="headerlink" title="URLå°¾éƒ¨çš„/éœ€ä¸éœ€è¦"></a>URLå°¾éƒ¨çš„/éœ€ä¸éœ€è¦</h2><p>å…³äºURLå°¾éƒ¨çš„/æœ‰ä¸‰ç‚¹ä¹Ÿéœ€è¦è¯´æ˜ä¸€ä¸‹ã€‚ç¬¬ä¸€ç‚¹ä¸locationé…ç½®æœ‰å…³ï¼Œå…¶ä»–ä¸¤ç‚¹æ— å…³ã€‚</p><ul><li>locationä¸­çš„å­—ç¬¦æœ‰æ²¡æœ‰/éƒ½æ²¡æœ‰å½±å“ã€‚ä¹Ÿå°±æ˜¯è¯´/user/å’Œ/useræ˜¯ä¸€æ ·çš„ã€‚</li><li>å¦‚æœURLç»“æ„æ˜¯<a href="https://domain.com/çš„å½¢å¼ï¼Œå°¾éƒ¨æœ‰æ²¡æœ‰/éƒ½ä¸ä¼šé€ æˆé‡å®šå‘ã€‚å› ä¸ºæµè§ˆå™¨åœ¨å‘èµ·è¯·æ±‚çš„æ—¶å€™ï¼Œé»˜è®¤åŠ ä¸Šäº†/ã€‚è™½ç„¶å¾ˆå¤šæµè§ˆå™¨åœ¨åœ°å€æ é‡Œä¹Ÿä¸ä¼šæ˜¾ç¤º/ã€‚è¿™ä¸€ç‚¹ï¼Œå¯ä»¥è®¿é—®baiduéªŒè¯ä¸€ä¸‹ã€‚" target="_blank" rel="noopener">https://domain.com/çš„å½¢å¼ï¼Œå°¾éƒ¨æœ‰æ²¡æœ‰/éƒ½ä¸ä¼šé€ æˆé‡å®šå‘ã€‚å› ä¸ºæµè§ˆå™¨åœ¨å‘èµ·è¯·æ±‚çš„æ—¶å€™ï¼Œé»˜è®¤åŠ ä¸Šäº†/ã€‚è™½ç„¶å¾ˆå¤šæµè§ˆå™¨åœ¨åœ°å€æ é‡Œä¹Ÿä¸ä¼šæ˜¾ç¤º/ã€‚è¿™ä¸€ç‚¹ï¼Œå¯ä»¥è®¿é—®baiduéªŒè¯ä¸€ä¸‹ã€‚</a></li><li>å¦‚æœURLçš„ç»“æ„æ˜¯<a href="https://domain.com/some-dir/ã€‚å°¾éƒ¨å¦‚æœç¼ºå°‘/å°†å¯¼è‡´é‡å®šå‘ã€‚å› ä¸ºæ ¹æ®çº¦å®šï¼ŒURLå°¾éƒ¨çš„/è¡¨ç¤ºç›®å½•ï¼Œæ²¡æœ‰/è¡¨ç¤ºæ–‡ä»¶ã€‚æ‰€ä»¥è®¿é—®/some-dir/æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè‡ªåŠ¨å»è¯¥ç›®å½•ä¸‹æ‰¾å¯¹åº”çš„é»˜è®¤æ–‡ä»¶ã€‚å¦‚æœè®¿é—®/some-dirçš„è¯ï¼ŒæœåŠ¡å™¨ä¼šå…ˆå»æ‰¾some-diræ–‡ä»¶ï¼Œæ‰¾ä¸åˆ°çš„è¯ä¼šå°†some-dirå½“æˆç›®å½•ï¼Œé‡å®šå‘åˆ°/some-dir/ï¼Œå»è¯¥ç›®å½•ä¸‹æ‰¾é»˜è®¤æ–‡ä»¶ã€‚å¯ä»¥å»æµ‹è¯•ä¸€ä¸‹ä½ çš„ç½‘ç«™æ˜¯ä¸æ˜¯è¿™æ ·çš„ã€‚" target="_blank" rel="noopener">https://domain.com/some-dir/ã€‚å°¾éƒ¨å¦‚æœç¼ºå°‘/å°†å¯¼è‡´é‡å®šå‘ã€‚å› ä¸ºæ ¹æ®çº¦å®šï¼ŒURLå°¾éƒ¨çš„/è¡¨ç¤ºç›®å½•ï¼Œæ²¡æœ‰/è¡¨ç¤ºæ–‡ä»¶ã€‚æ‰€ä»¥è®¿é—®/some-dir/æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè‡ªåŠ¨å»è¯¥ç›®å½•ä¸‹æ‰¾å¯¹åº”çš„é»˜è®¤æ–‡ä»¶ã€‚å¦‚æœè®¿é—®/some-dirçš„è¯ï¼ŒæœåŠ¡å™¨ä¼šå…ˆå»æ‰¾some-diræ–‡ä»¶ï¼Œæ‰¾ä¸åˆ°çš„è¯ä¼šå°†some-dirå½“æˆç›®å½•ï¼Œé‡å®šå‘åˆ°/some-dir/ï¼Œå»è¯¥ç›®å½•ä¸‹æ‰¾é»˜è®¤æ–‡ä»¶ã€‚å¯ä»¥å»æµ‹è¯•ä¸€ä¸‹ä½ çš„ç½‘ç«™æ˜¯ä¸æ˜¯è¿™æ ·çš„ã€‚</a><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2>locationçš„é…ç½®æœ‰ä¸¤ç§å½¢å¼ï¼Œå‰ç¼€å­—ç¬¦å’Œæ­£åˆ™ã€‚æŸ¥æ‰¾åŒ¹é…çš„æ—¶å€™ï¼Œå…ˆæŸ¥æ‰¾å‰ç¼€å­—ç¬¦ï¼Œé€‰æ‹©æœ€é•¿åŒ¹é…é¡¹ï¼Œå†æŸ¥æ‰¾æ­£åˆ™ã€‚æ­£åˆ™çš„ä¼˜å…ˆçº§é«˜äºå‰ç¼€å­—ç¬¦ã€‚</li></ul><p>æ­£åˆ™çš„æŸ¥æ‰¾æ˜¯æŒ‰ç…§åœ¨é…ç½®æ–‡ä»¶ä¸­çš„é¡ºåºè¿›è¡Œçš„ã€‚å› æ­¤æ­£åˆ™çš„é¡ºåºå¾ˆé‡è¦ï¼Œå»ºè®®è¶Šç²¾ç»†çš„æ”¾çš„è¶Šé å‰ã€‚</p><p>ä½¿ç”¨=ç²¾å‡†åŒ¹é…å¯ä»¥åŠ å¿«æŸ¥æ‰¾çš„é¡ºåºï¼Œå¦‚æœæ ¹åŸŸåç»å¸¸è¢«è®¿é—®çš„è¯å»ºè®®ä½¿ç”¨=ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> location </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ©ç”¨dockerå®ç°mysqlä¸»ä»åŒæ­¥è¯»å†™åˆ†ç¦»ï¼Œé™„èµ dockeræ­å»ºmycatè¯»å†™åˆ†ç¦»</title>
      <link href="/p/8eb47741/"/>
      <url>/p/8eb47741/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>ä¸‹è½½mysqlé•œåƒã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql5.7</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ps:å¦‚æœä¸‹è½½å¤ªæ…¢ï¼Œè¯·æ·»åŠ è…¾è®¯æº,ä¾æ¬¡æ‰§è¡Œ</span><br><span class="line">echo &quot;OPTIONS&#x3D;&#39;--registry-mirror&#x3D;https:&#x2F;&#x2F;mirror.ccs.tencentyun.com&#39;&quot; &gt;&gt; &#x2F;etc&#x2F;sysconfig&#x2F;docker</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">service docker restart</span><br><span class="line">æˆ–è€…ç›´æ¥å»é˜¿é‡Œä»“åº“ä¸‹https:&#x2F;&#x2F;dev.aliyun.com&#x2F;search.htmlæŠŠä¸Šé¢çš„--registry-mirror&#x3D;https:&#x2F;&#x2F;mirror.ccs.tencentyun.comæ¢æˆä½ çš„ä¸“å±æºå°±å¯ä»¥</span><br></pre></td></tr></table></figure><p>ä¸‹è½½å®Œè¾“å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br><span class="line">REPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">docker.io&#x2F;mysql            5.7               44a8e1a5c0b2        8 days ago          407 MB</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§ï¼šåˆ›å»º MySQL å®¹å™¨<br>åˆ›å»ºä¸»æ•°æ®åº“å®¹å™¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql-master -p 3307:3306 -e MYSQL_ROOT_PASSWORD&#x3D;123456 -d mysql:5.7</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä»æ•°æ®åº“å®¹å™¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql-slave -p 3308:3306 -e MYSQL_ROOT_PASSWORD&#x3D;123456 -d mysql:5.7</span><br></pre></td></tr></table></figure><p>é…ç½®ä¸»æ•°æ®åº“<br>é¦–å…ˆï¼Œè¿›å…¥å®¹å™¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it mysql-master &#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure><p>è¿æ¥mysql</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p123456</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ root å¯ä»¥é€šè¿‡ä»»ä½•å®¢æˆ·ç«¯è¿æ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER USER &#39;root&#39;@&#39;%&#39; IDENTIFIED WITH mysql_native_password BY &#39;123456&#39;;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ MySQL é…ç½®æ–‡æ¡£ ==/etc/mysql/mysql.conf.d/mysqld.cnf==ï¼Œåœ¨ [mysqld] æ®µæ·»åŠ ä»¥ä¸‹é…ç½®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">log-bin&#x3D;mysql-bin    &#x2F;&#x2F;[å¿…é¡»]å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">server-id&#x3D;1          &#x2F;&#x2F;[å¿…é¡»]æœåŠ¡å™¨æ ‡è¯†IDï¼Œæ¯å°æœåŠ¡å™¨å”¯ä¸€</span><br></pre></td></tr></table></figure><p>é…ç½®ä»æœåŠ¡å™¨<br>é¦–å…ˆï¼Œè¿›å…¥å®¹å™¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it mysql-master &#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure><p>è¿æ¥mysql</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p123456</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ root å¯ä»¥é€šè¿‡ä»»ä½•å®¢æˆ·ç«¯è¿æ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER USER &#39;root&#39;@&#39;%&#39; IDENTIFIED WITH mysql_native_password BY &#39;123456&#39;;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ MySQL é…ç½®æ–‡æ¡£ ==/etc/mysql/mysql.conf.d/mysqld.cnf==ï¼Œåœ¨ [mysqld] æ®µæ·»åŠ ä»¥ä¸‹é…ç½®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">log-bin&#x3D;mysql-bin    &#x2F;&#x2F;[å¿…é¡»]å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">server-id&#x3D;2          &#x2F;&#x2F;[å¿…é¡»]æœåŠ¡å™¨æ ‡è¯†IDï¼Œæ¯å°æœåŠ¡å™¨å”¯ä¸€</span><br></pre></td></tr></table></figure><h4 id="é‡å¯å®¹å™¨"><a href="#é‡å¯å®¹å™¨" class="headerlink" title="é‡å¯å®¹å™¨"></a>é‡å¯å®¹å™¨</h4><p>é…ç½® MySQL ä¸»ä»å¤åˆ¶<br>é¦–å…ˆè¿æ¥ master æœåŠ¡å™¨ï¼ŒæŸ¥çœ‹æ•°æ®åº“çŠ¶æ€ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show master status;</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| mysql-bin.000003 |      154 |              |                  |                   |</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>è®°å½• File çš„å€¼å’Œ Position çš„å€¼ï¼Œç­‰ä¼šé…ç½® slave æœåŠ¡å™¨çš„æ—¶å€™è¦ç”¨ã€‚</p><p>æ¥ä¸‹æ¥è¿æ¥ slave æœåŠ¡å™¨ï¼Œé…ç½®ä¸»ä»å¤åˆ¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;change master to</span><br><span class="line">master_host&#x3D;&#39;x.x.x.x&#39;,</span><br><span class="line">master_user&#x3D;&#39;user&#39;,</span><br><span class="line">master_log_file&#x3D;&#39;mysql-bin.000003&#39;,</span><br><span class="line">master_log_pos&#x3D;154,</span><br><span class="line">master_port&#x3D;3307,</span><br><span class="line">master_password&#x3D;&#39;123456&#39;;</span><br><span class="line">Query OK, 0 rows affected, 2 warnings (0.03 sec)</span><br><span class="line">mysql&gt; start slave;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br></pre></td></tr></table></figure><p>è§£é‡Šä¸‹é…ç½®å‚æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">master_host&#x3D;&#39;x.x.x.x&#39; &#x2F;&#x2F; è¿™é‡Œå¡« master ä¸»æœº ip</span><br><span class="line">master_log_file&#x3D;&#39;mysql-bin.000003&#39;, &#x2F;&#x2F; è¿™é‡Œå¡«å†™ File çš„å€¼</span><br><span class="line">master_log_pos&#x3D;154,&#x2F;&#x2F; è¿™é‡Œå¡«å†™ Position çš„å€¼ã€‚</span><br><span class="line">mysql&gt; start slave;&#x2F;&#x2F; å¯åŠ¨ä»æœåŠ¡å™¨å¤åˆ¶åŠŸèƒ½</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸å°å¿ƒé…ç½®é”™, è¾“å…¥ mysql&gt; stop slave; ç„¶åé‡æ–°å½•å…¥ä¸€éå°±å¯ä»¥äº†ã€‚</p><p>æ£€æŸ¥ä¸»ä»è¿æ¥çŠ¶æ€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: x.x.x.x</span><br><span class="line">                  Master_User: user</span><br><span class="line">                  Master_Port: 32768</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000003</span><br><span class="line">          Read_Master_Log_Pos: 1338</span><br><span class="line">               Relay_Log_File: 8d1e3b87d499-relay-bin.000002</span><br><span class="line">                Relay_Log_Pos: 1221</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000003</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 1338</span><br><span class="line">              Relay_Log_Space: 1435</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: 1</span><br><span class="line">                  Master_UUID: cd327a00-5e18-11e7-98f7-0242ac110006</span><br><span class="line">             Master_Info_File: &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;master.info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: </span><br><span class="line">            Executed_Gtid_Set: </span><br><span class="line">                Auto_Position: 0</span><br><span class="line">         Replicate_Rewrite_DB: </span><br><span class="line">                 Channel_Name: </span><br><span class="line">           Master_TLS_Version: </span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªå¿…é¡»æ˜¯Yes ä¸ºNo æˆ–è€…connectè¯´æ˜æ²¡æœ‰è¿æ¥ä¸Š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Slave_IO_Running: Yes</span><br><span class="line"></span><br><span class="line">Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä¸»ä»è¿æ¥<br>æ³¨æ„è®¾ç½®ä¸»ä»åï¼Œæ“ä½œåªèƒ½åœ¨masterç»ˆç«¯ä¸Šï¼Œslaveä¸Šçš„æ“ä½œä¸ä¼šåŒæ­¥åˆ°masterä¸Šã€‚</p><p>ç™»é™†masterç»ˆç«¯ï¼Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database sunhao;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sunhao             |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; use sunhao</span><br><span class="line">Database changed</span><br><span class="line"></span><br><span class="line">mysql&gt; CREATE TABLE &#96;user&#96; (</span><br><span class="line">  &#96;user_id&#96; bigint(20) AUTO_INCREMENT,</span><br><span class="line">  &#96;username&#96; varchar(30) NOT NULL,</span><br><span class="line">  &#96;password&#96; varchar(30) DEFAULT NULL,</span><br><span class="line">   PRIMARY KEY (&#96;user_id&#96;)</span><br><span class="line">   ) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br><span class="line">Query OK, 0 rows affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into user(username, password) values (&#39;test_user&#39;, &#39;test_pass&#39;);</span><br><span class="line">Query OK, 1 row affected (0.07 sec)</span><br></pre></td></tr></table></figure><pre><code>ç™»é™†slaveæœåŠ¡å™¨mysql&gt; show databases;+--------------------+| Database           |+--------------------+| information_schema || mysql              || performance_schema || sunhao             || sys                |+--------------------+5 rows in set (0.00 sec)mysql&gt; use sunhaomysql&gt; select * from user;+---------+-----------+-----------+| user_id | username  | password  |+---------+-----------+-----------+|       1 | test_user | test_pass |+---------+-----------+-----------+1 row in set (0.00 sec)å¦‚æœä¸»æœåŠ¡å™¨å·²ç»å­˜åœ¨åº”ç”¨æ•°æ®ï¼Œåˆ™åœ¨è¿›è¡Œä¸»ä»å¤åˆ¶æ—¶ï¼Œéœ€è¦å•ç‹¬å¤åˆ¶å¤„ç†ï¼ˆæ³¨æ„æ­¤æ“ä½œï¼Œå¦‚æœå¯¹ä»æœåŠ¡å™¨å•ç‹¬å½•å…¥çš„æ•°æ®ï¼Œä¼šè¢«è¦†ç›–æ‰ã€‚ï¼‰ï¼šè¿™é‡Œæˆ‘ä»¬åšä¸€æ¬¡å®Œæ•´çš„æµ‹è¯•(1)åœ¨ä¸»æœåŠ¡å™¨æ•°æ®åº“æ’å…¥æ–°çš„æ•°æ®ï¼Œå¹¶è¿›è¡Œé”è¡¨æ“ä½œï¼Œä¸è®©æ•°æ®å†è¿›è¡Œå†™å…¥åŠ¨ä½œmysql&gt; insert into sunhao values(2,&apos;xiaoshuai&apos;);Query OK, 1 row affected (0.01 sec)mysql&gt; select * from sunhao;                   +------+-----------+| id   | name      |+------+-----------+|    1 | xiaoshuai ||    2 | xiaoshuai |+------+-----------+2 rows in set (0.00 sec)mysql&gt; FLUSH TABLES WITH READ LOCK;mysql&gt; show full processlist; `(2)é€€å‡ºmysqlï¼Œç”¨mysqldumpå¤‡ä»½æ•°æ®æ–‡ä»¶åˆ°/var/lib,ç„¶åé¡ºä¾¿å¤šä½™çš„ç”¨taræ‰“åŒ…ä¸€ä¸‹ç©ã€‚å“ˆå“ˆã€‚mysql&gt; exitByeroot@980e5ea48152:/var/lib/mysql# mysqldump -u root -p  sunhao &gt; /var/lib/sunhao.dump    Enter password: root@980e5ea48152:/var/lib# tar -zcvf ./sunhao.dump .tar  ./sunhao.dump(3)æ‰“å¼€å®¿ä¸»æœåŠ¡å™¨ï¼Œå¤åˆ¶mysqlä¸»æœåŠ¡å™¨æ–‡ä»¶sunhao.dump.tarã€‚åˆ°å®¿ä¸»æœåŠ¡å™¨[root]# docker ps CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                     NAMES8d1e3b87d499        slave/mysql         &quot;docker-entrypoint.sh&quot;   4 hours ago         Up 4 hours          0.0.0.0:32769-&gt;3306/tcp   mysql-slave980e5ea48152        master/mysql        &quot;docker-entrypoint.sh&quot;   4 hours ago         Up 4 hours          0.0.0.0:32768-&gt;3306/tcp   mysql-mastermkdir -p /var/mydatadocker cp 980e:/var/lib/sunhao.dump.tar /var/mydata/cd /var/mydata[root@VM_128_230_centos mydata]# lssunhao.dump.tarè§£é‡Š:docker cp 980e:/var/lib/sunhao.dump.tar /var/mydata/980eæ˜¯980e5ea48152çš„ç¼©å†™ã€‚ä¿è¯ä¸é‡å¤ç®€å†™å°±å¯ä»¥980e:/var/lib/sunhao.dump.tar æ„æ€å°±æ˜¯é€‰ä¸­çš„å®¹å™¨ä¸‹é¢ä½ çš„æ–‡ä»¶ä¸‹çš„sunhao.dump.taræ–‡ä»¶/var/mydata/ ç›®æ ‡æ–‡ä»¶(4)åœ¨å®¿ä¸»ä¸»æœºä¸Šè¾“å…¥[root]# docker cp /var/mydata/sunhao.dump.tar 8d1e3b87d49936414c0e91ffdc60a054e7f4ef8b15baee295350565519abba0e:/var/lib/(5)åœ¨ä»æœåŠ¡å™¨ä¸Šè¾“å…¥root@8d1e3b87d499:/# cd /var/lib/root@8d1e3b87d499:/var/lib# tar -zcvf sunhao.dump.tar(6)åœ¨ä»æœåŠ¡å™¨ä¸Šè¾“å…¥tar -zxvpf /var/lib/mysqlbak.sql.tarmysql -uroot -pmysql sunhao &lt; /var/lib/sunhao.dump;å¦‚æœå†™å…¥æˆåŠŸ,è¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç”¨selectæŸ¥è¯¢åˆ°æ•°æ®ã€‚(2)å–æ¶ˆä¸»æœåŠ¡å™¨æ•°æ®åº“é”å®šmysql&gt; UNLOCK TABLES;dockeræ­å»ºmycatè¯»å†™åˆ†ç¦»åˆ¶ä½œmycatå®¹å™¨ï¼Œå¹¶è¿è¡Œé¦–å…ˆåœ¨æœ¬åœ°æ–°å»ºä¸ªæ–‡ä»¶å¤¹/usr/mycatã€‚ç„¶åå»mycatå®˜ç½‘ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ï¼Œè¿™é‡Œæˆ‘ä¸‹è½½çš„æ˜¯1.6ç‰ˆæœ¬ã€‚å®‰è£…å®Œè§£å‹åˆ°è¿™é‡Œã€‚http://dl.mycat.io/[http://dl.mycat.io/1.6-RELEASE/](http://dl.mycat.io/1.6-RELEASE/ &quot;http://dl.mycat.io/1.6-RELEASE/&quot;)ç¼–å†™Dockerfileï¼Œå†…å®¹ä¸º# æ¥æºé•œåƒ,å› ä¸ºmycatä¾èµ–javaï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥é€‰çš„javaç¯å¢ƒã€‚FROM javaRUN  mkdir -p /var/local/mycat/# Addå¤åˆ¶Mycatåˆ°å®¹å™¨ADD  mycat/ /var/local/mycat/ ENTRYPOINT  [&quot;/var/local/mycat/bin/mycat&quot;,&quot;console&quot;,&quot;&amp;&quot;]# å¯¹å¤–ç«¯å£EXPOSE 8066 9066# å¯åŠ¨æ§åˆ¶å°CMD  [&quot;/var/local/mycat/bin/mycat&quot;,&quot;console&quot;,&quot;&amp;&quot;]å…ˆåˆ«æ€¥ç€æ„å»ºé•œåƒï¼Œæˆ‘ä»¬å…ˆä¿®æ”¹ä¸‹mycatçš„é…ç½®æ–‡ä»¶ã€‚[root@centos mycat]# lltotal 15324-rw-r--r-- 1 root root      357 Jul  5 15:26 Dockerfile-rw-r--r-- 1 root root 15662280 Jul  3 15:07 Mycat-server-1.6-RELEASE-20161028204710-linux.tar.gzdrwxr-xr-x 7 root root     4096 Jul  5 15:27 mycatåœ¨æˆ‘ç”¨çš„1.6ç‰ˆæœ¬ã€‚mycatå¯¹å¤–ç«¯å£æ˜¯æ³¨é‡Šæ‰çš„ã€‚æˆ‘ä»¬è¦æ‰“å¼€ä¸‹ã€‚æˆ‘ä»¬ç¼–è¾‘/usr/mycat/mycat/conf/server.xml.æ‰¾åˆ°ç¬¬32-35è¡Œã€‚å»æ‰æ³¨é‡Šç¬¦å·ã€‚&lt;!--    &lt;property name=&quot;serverPort&quot;&gt;8066&lt;/property&gt; &lt;property name=&quot;managerPort&quot;&gt;9066&lt;/property&gt;     &lt;property name=&quot;idleTimeout&quot;&gt;300000&lt;/property&gt; &lt;property name=&quot;bindIp&quot;&gt;0.0.0.0&lt;/property&gt;     &lt;property name=&quot;frontWriteQueueSize&quot;&gt;4096&lt;/property&gt; &lt;property name=&quot;processors&quot;&gt;32&lt;/property&gt; --&gt;æˆ‘ä»¬å¾€ä¸‹çœ‹ æœ‰è¿™ä¹ˆå‡ å¥ã€‚è¿™é‡Œåˆ†åˆ«é»˜è®¤ä¸¤ä¸ªç”¨æˆ·ã€‚ nameä¸ºrootçš„ç®¡ç†å‘˜ï¼Œå¯ä»¥è¿›è¡Œè¯»å†™ã€‚å’Œæ™®é€šç”¨æˆ·åªèƒ½è¿›è¡Œè¯»ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»ºä¿®æ”¹ï¼Œå¦å¤–passwordæ˜¯å¯†ç  schemasæ˜¯ç”¨æˆ·æ‰€èƒ½æ“ä½œçš„åº“ã€‚ åœ¨è¿™é‡Œæˆ‘ä»€ä¹ˆéƒ½æ²¡æœ‰æ”¹ã€‚ä¸‹é¢éƒ½æ˜¯é»˜è®¤ã€‚&lt;user name=&quot;root&quot;&gt;        &lt;property name=&quot;password&quot;&gt;123456&lt;/property&gt;        &lt;property name=&quot;schemas&quot;&gt;TESTDB&lt;/property&gt;        &lt;!-- è¡¨çº§ DML æƒé™è®¾ç½® --&gt;        &lt;!--                 &lt;privileges check=&quot;false&quot;&gt;            &lt;schema name=&quot;TESTDB&quot; dml=&quot;0110&quot; &gt;                &lt;table name=&quot;tb01&quot; dml=&quot;0000&quot;&gt;&lt;/table&gt;                &lt;table name=&quot;tb02&quot; dml=&quot;1111&quot;&gt;&lt;/table&gt;            &lt;/schema&gt;        &lt;/privileges&gt;                 --&gt;    &lt;/user&gt;    &lt;user name=&quot;user&quot;&gt;        &lt;property name=&quot;password&quot;&gt;user&lt;/property&gt;        &lt;property name=&quot;schemas&quot;&gt;TESTDB&lt;/property&gt;        &lt;property name=&quot;readOnly&quot;&gt;true&lt;/property&gt;    &lt;/user&gt;æˆ‘ä»¬ç¼–è¾‘/usr/mycat/mycat/conf/schema.xmlï¼Œè¿™ä¸ªæ˜¯æˆ‘ä»¬é…ç½®åˆ†ç‰‡å’Œé€»è¾‘åº“è¡¨ï¼Œè§„åˆ™çš„åœ°æ–¹ï¼Œæ•°æ®èŠ‚ç‚¹ï¼Œå’Œæ•°æ®æºã€‚å…¶ä¸­schemaæ˜¯æˆ‘ä»¬æ‰€æ“ä½œçš„é€»è¾‘åº“ã€‚é»˜è®¤ä¸ºTESTDBã€‚ä¸‹é¢åˆ†åˆ«æ˜¯å„ä¸ªé€»è¾‘è¡¨ã€‚åœ¨è¿™é‡Œç›´æ¥é»˜è®¤ã€‚æˆ‘åªæ˜¯ä¸ºäº†åŒºåˆ†dhå’Œdbä¸¤ä¸ªå­—çš„åŒºåˆ«ï¼ŒæŠŠdb1-3æ”¹äº†data1-3ä½ ä»¬å¯ä»¥ä¸ç”¨ç®¡ã€‚&lt;schema name=&quot;TESTDB&quot; checkSQLschema=&quot;false&quot; sqlMaxLimit=&quot;100&quot;&gt;    &lt;!-- auto sharding by id (long) --&gt;    &lt;table name=&quot;travelrecord&quot; dataNode=&quot;dn1,dn2,dn3&quot; rule=&quot;auto-sharding-long&quot; /&gt;    &lt;!-- global table is auto cloned to all defined data nodes ,so can join        with any table whose sharding node is in the same data node --&gt;    &lt;table name=&quot;company&quot; primaryKey=&quot;ID&quot; type=&quot;global&quot; dataNode=&quot;dn1,dn2,dn3&quot; /&gt;    &lt;table name=&quot;goods&quot; primaryKey=&quot;ID&quot; type=&quot;global&quot; dataNode=&quot;dn1,dn2&quot; /&gt;    &lt;!-- random sharding using mod sharind rule --&gt;    &lt;table name=&quot;hotnews&quot; primaryKey=&quot;ID&quot; autoIncrement=&quot;true&quot; dataNode=&quot;dn1,dn2,dn3&quot;           rule=&quot;mod-long&quot; /&gt;    &lt;!-- &lt;table name=&quot;dual&quot; primaryKey=&quot;ID&quot; dataNode=&quot;dnx,dnoracle2&quot; type=&quot;global&quot;        needAddLimit=&quot;false&quot;/&gt; &lt;table name=&quot;worker&quot; primaryKey=&quot;ID&quot; dataNode=&quot;jdbc_dn1,jdbc_dn2,jdbc_dn3&quot;        rule=&quot;mod-long&quot; /&gt; --&gt;    &lt;table name=&quot;employee&quot; primaryKey=&quot;ID&quot; dataNode=&quot;dn1,dn2&quot;           rule=&quot;sharding-by-intfile&quot; /&gt;    &lt;table name=&quot;customer&quot; primaryKey=&quot;ID&quot; dataNode=&quot;dn1,dn2&quot;           rule=&quot;sharding-by-intfile&quot;&gt;        &lt;childTable name=&quot;orders&quot; primaryKey=&quot;ID&quot; joinKey=&quot;customer_id&quot;                    parentKey=&quot;id&quot;&gt;            &lt;childTable name=&quot;order_items&quot; joinKey=&quot;order_id&quot;                        parentKey=&quot;id&quot; /&gt;        &lt;/childTable&gt;        &lt;childTable name=&quot;customer_addr&quot; primaryKey=&quot;ID&quot; joinKey=&quot;customer_id&quot;                    parentKey=&quot;id&quot; /&gt;    &lt;/table&gt;    &lt;!-- &lt;table name=&quot;oc_call&quot; primaryKey=&quot;ID&quot; dataNode=&quot;dn1$0-743&quot; rule=&quot;latest-month-calldate&quot;        /&gt; --&gt;&lt;/schema&gt;ä¿®æ”¹37-45è¡Œ /usr/mycat/mycat/conf/wrapper.confã€‚è®¾ç½®javaè™šæ‹Ÿæœºå†…å­˜ã€‚# Initial Java Heap Size (in MB)wrapper.java.initmemory=3# Maximum Java Heap Size (in MB)wrapper.java.maxmemory=64åœ¨schema.xmlå¾€ä¸‹ä¿®æ”¹ã€‚43-55è¡Œã€‚æ•°æ®æºåœ°å€dataHostã€‚è¿™äº›å°±æ˜¯æˆ‘ä»¬çš„æ•°æ®æºï¼ŒmycatæŠŠé€»è¾‘è¡¨çš„æ•°æ®ï¼Œè¯»å†™éƒ½æ¥æºäºæˆ‘ä»¬é…ç½®åœ°å€ã€‚å…¶ä¸­writeHostå†™å…¥æºã€‚è®¾ç½®å¤šä¸ªï¼Œé»˜è®¤ä¹Ÿåªç”¨ç¬¬ä¸€ä¸ªã€‚readHostæ˜¯è¯»æœåŠ¡å™¨ã€‚heartbeatæ˜¯æˆ‘ä»¬æ£€æµ‹æ•°æ®åº“æ˜¯å¦æ­£å¸¸è¿è¡Œçš„ã€‚åœ¨è¿™é‡Œ mycat æœ‰ä¸¤ç§é…ç½®æ–¹å¼ã€‚åˆ†åˆ«æ˜¯ä¸¤ä¸ªwriteHostå’Œä¸€ä¸ªwriteHostä¸€ä¸ªreadHostç¬¬ä¸€ç§å¦‚æœå†™å…¥å¤±è´¥ï¼Œè¿˜æ˜¯å¯è¯»ã€‚ç¬¬äºŒç§å¦‚æœå†™å…¥å¤±è´¥ï¼Œä¸å¯è¯»ã€‚æˆ‘ä»¬é‡‡ç”¨å®‰å…¨ç¨³å¦¥çš„æ–¹å¼ã€‚ä¸€ä¸ªwriteHostä¸€ä¸ªreadHostæˆ‘çš„é…ç½®ä¸º&lt;dataHost name=&quot;localhost1&quot; maxCon=&quot;1000&quot; minCon=&quot;20&quot; balance=&quot;1&quot;          writeType=&quot;0&quot; dbType=&quot;mysql&quot; dbDriver=&quot;native&quot; switchType=&quot;2&quot;  slaveThreshold=&quot;100&quot;&gt;    &lt;heartbeat&gt;show slave status&lt;/heartbeat&gt;    &lt;!-- can have multi write hosts --&gt;    &lt;writeHost host=&quot;hostM1&quot; url=&quot;115.159.124.18:32768&quot; user=&quot;root&quot;    password=&quot;mysql&quot;&gt;        &lt;!-- can have multi read hosts --&gt;        &lt;readHost host=&quot;hostS1&quot; url=&quot;115.159.124.18:32769&quot; user=&quot;root&quot;    password=&quot;mysql&quot; /&gt;    &lt;/writeHost&gt;&lt;/dataHost&gt;hostM1å’ŒhostS1åˆ†åˆ«å¯¹åº”æˆ‘ä»¬åˆ›å»ºçš„ä¸¤ä¸ªdockerå®¹å™¨çš„å¯¹å¤–ç«¯å£ã€‚ä¿®æ”¹/usr/mycat/mycat/conf/log4j2.xml è¿™ä¸ªæ˜¯é…ç½®æ—¥å¿—æ–‡ä»¶çš„ï¼Œæˆ‘ä»¬æ‰“å¼€debugæ–¹ä¾¿æˆ‘ä»¬å­¦ä¹ ã€‚ä¿®æ”¹ç¬¬25è¡Œinfoä¸ºdebug&lt;asyncRoot level=&quot;debug&quot; includeLocation=&quot;true&quot;&gt;     &lt;AppenderRef ref=&quot;Console&quot; /&gt;     &lt;AppenderRef ref=&quot;RollingFile&quot;/&gt; &lt;/asyncRoot&gt;æ„å»ºé•œåƒdocker build -t sunhao/mycat:1.6  . åˆ«å¿˜äº†æœ€åé¢çš„åœ†ç‚¹è¿è¡Œåˆ›å»ºå®¹å™¨docker  run  --name sunhaomycat  -d -p 8066:8066 -p 9066:9066 sunhao/mycat:1.6å°±é‚£ä¹ˆç®€å•ã€‚æˆ‘ä»¬çš„mycatå·²ç»æ­å»ºæˆåŠŸäº†ã€‚æµ‹è¯•ä¸‹å§æ‰“å¼€4ä¸ªç»ˆç«¯1ä¸ªå®¿ä¸»ï¼Œ1ä¸ªmysqlä¸»ï¼Œ1ä¸ªmysqlä»ï¼Œ1ä¸ªç”¨æ¥çœ‹mycatæ—¥å¿—ã€‚å®¿ä¸»ç¯å¢ƒæ“ä½œåœ¨å®¿ä¸»ç»ˆç«¯ä¸Šï¼Œå®‰è£…mysqlã€‚å¹¶ä¸”è¿æ¥æˆ‘ä»¬çš„mycatã€‚[root@VM_128_230_centos mycat]# mysql -uroot -p123456 -h115.159.124.18 -P8066Welcome to the MariaDB monitor.  Commands end with ; or \g.Your MySQL connection id is 8Server version: 5.6.29-mycat-1.6-RELEASE-20161028204710 MyCat Server (OpenCloundDB)Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.MySQL [(none)]&gt;å®Œç¾ï¼ŒServer version: 5.6.29-mycat-1.6-RELEASE-20161028204710 MyCat Server å‡ºç°è¿™ï¼Œè¯´æ˜mycatè¿è¡Œäº†ã€‚è¿›è¡Œç®€å•çš„æ“ä½œã€‚Database changedMySQL [TESTDB]&gt; show databases;+----------+| DATABASE |+----------+| TESTDB   |+----------+1 row in set (0.00 sec)MySQL [TESTDB]&gt; show tables;+------------------+| Tables in TESTDB |+------------------+| company          || customer         || customer_addr    || employee         || goods            || hotnews          || orders           || order_items      || travelrecord     |+------------------+9 rows in set (0.00 sec)MySQL [TESTDB]&gt;æµ‹è¯•ä¸‹å†™å…¥MySQL [TESTDB]&gt; create table travelrecord (id bigint not null primary key,user_id varchar(100),traveldate DATE, fee decimal,days int);ERROR 1105 (HY000): Table &apos;travelrecord&apos; already existsMySQL [TESTDB]&gt; insert into travelrecord(id,user_id,traveldate,fee,days)  values(1,@@hostname,20170707,100,10);Query OK, 1 row affected (0.01 sec)MySQL [TESTDB]&gt; MySQL [TESTDB]&gt; insert into travelrecord(id,user_id,traveldate,fee,days)  values(10000001,@@hostname,20170707,100,10);Query OK, 1 row affected (0.00 sec)åˆ†åˆ«è¿›å…¥mysqlä¸»å’Œmysqlä»å¯ä»¥çœ‹åˆ°ã€‚MySQL [data2]&gt; use data3                  Reading table information for completion of table and column namesYou can turn off this feature to get a quicker startup with -ADatabase changedMySQL [data3]&gt; select * from travelrecord;+----------+--------------+------------+------+------+| id       | user_id      | traveldate | fee  | days |+----------+--------------+------------+------+------+| 10000001 | 980e5ea48152 | 2017-07-07 |  100 |   10 |+----------+--------------+------------+------+------+1 row in set (0.00 sec)MySQL [data3]&gt; use data1;                 Reading table information for completion of table and column namesYou can turn off this feature to get a quicker startup with -ADatabase changedMySQL [data1]&gt; select * from travelrecord;+----+--------------+------------+------+------+| id | user_id      | traveldate | fee  | days |+----+--------------+------------+------+------+|  1 | 980e5ea48152 | 2017-07-07 |  100 |   10 |+----+--------------+------------+------+------+1 row in set (0.00 sec)MySQL [data1]&gt;æµ‹è¯•è¯»å–åˆ†ç¦»æ‰“å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œç”¨docker exec -it 61e74eee274d9d0f0404a572dec1d14c8b03dfd480e13d3c96fa04c534df0556  bashè¿›å…¥æˆ‘ä»¬çš„mycatå®¹å™¨å…¶ä¸­61e74ä¸ºä½ çš„mycatå®¹å™¨è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬çš„æ—¥å¿—ç»ˆç«¯root@61e74eee274d:/var/local/mycat/logs# ls2017-07  mycat.log  mycat.pid  wrapper.logroot@61e74eee274d:/var/local/mycat/logs# tail -f  mycat.logåœ¨å®¿ä¸»ç¯å¢ƒmycatä¸‹è¾“å…¥MySQL [TESTDB]&gt; select * from travelrecord ;ERROR 2006 (HY000): MySQL server has gone awayNo connection. Trying to reconnect...Connection id:    9Current database: TESTDB+----------+--------------+------------+------+------+| id       | user_id      | traveldate | fee  | days |+----------+--------------+------------+------+------+|        1 | 980e5ea48152 | 2017-07-07 |  100 |   10 || 10000001 | 980e5ea48152 | 2017-07-07 |  100 |   10 |+----------+--------------+------------+------+------+2 rows in set (0.02 sec)ç„¶ååˆ‡å›æˆ‘ä»¬çš„æ—¥å¿—ç»ˆç«¯ï¼ŒæŒ‰ctrl+cä¸­æ–­ã€‚ç„¶åè¾“å…¥cat tail è¿›è¡ŒæŸ¥çœ‹ï¼Œå¾ˆé•¿åœ¨æœ€åé¢æ‰¾ä¸ªç©ºç™½çš„å¤§å‘ï¼ˆè‡ªå·±ä½“ä¼šï¼‰æ…¢æ…¢æ‰¾ã€‚017-07-07 06:28:16.863 DEBUG [$_NIOREACTOR-5-RW] (io.mycat.backend.datasource.PhysicalDatasource.releaseChannel(PhysicalDatasource.java:442)) - release channel MySQLConnection [id=5, lastTime=1499408896859, user=root, schema=data3, old shema=data3, borrowed=true, fromSlaveDB=false, threadId=527, charset=latin1, txIsolation=3, autocommit=true, attachment=null, respHandler=null, host=115.159.184.18, port=32774, statusSync=null, writeQueue=0, modifiedSQLExecuted=false]2017-07-07 06:28:16.864 DEBUG [$_NIOREACTOR-3-RW] (io.mycat.backend.datasource.PhysicalDatasource.releaseChannel(PhysicalDatasource.java:442)) - release channel MySQLConnection [id=33, lastTime=1499408896859, user=root, schema=data3, old shema=data3, borrowed=true, fromSlaveDB=true, threadId=108, charset=latin1, txIsolation=3, autocommit=true, attachment=null, respHandler=null, host=115.159.184.18, port=32770, statusSync=null, writeQueue=0, modifiedSQLExecuted=false]2017-07-07 06:28:24.473 DEBUG [$_NIOREACTOR-29-RW] (io.mycat.net.FrontendConnection.query(FrontendConnection.java:288)) - ServerConnection [id=2, schema=TESTDB, host=115.159.184.18, user=root,txIsolation=3, autocommit=true, schema=TESTDB] select * from travelrecord2017-07-07 06:28:24.474 DEBUG [$_NIOREACTOR-29-RW] (io.mycat.server.ServerQueryHandler.query(ServerQueryHandler.java:57)) - ServerConnection [id=2, schema=TESTDB, host=115.159.184.18, user=root,txIsolation=3, autocommit=true, schema=TESTDB]select * from travelrecord2017-07-07 06:28:24.474 DEBUG [$_NIOREACTOR-29-RW] (io.mycat.cache.impl.EnchachePool.get(EnchachePool.java:71)) - SQLRouteCache hit cache ,key:TESTDBselect * from travelrecord2017-07-07 06:28:24.474 DEBUG [$_NIOREACTOR-29-RW] (io.mycat.server.NonBlockingSession.execute(NonBlockingSession.java:110)) - ServerConnection [id=2, schema=TESTDB, host=115.159.184.18, user=root,txIsolation=3, autocommit=true, schema=TESTDB]select * from travelrecord, route={   1 -&gt; dn1{SELECT *FROM travelrecordLIMIT 100}   2 -&gt; dn2{SELECT *FROM travelrecordLIMIT 100}   3 -&gt; dn3{SELECT *FROM travelrecordLIMIT 100}} rrs 2017-07-07 06:28:24.474 DEBUG [$_NIOREACTOR-29-RW] (io.mycat.backend.mysql.nio.handler.MultiNodeQueryHandler.&lt;init&gt;(MultiNodeQueryHandler.java:101)) - execute mutinode query select * from travelrecord2017-07-07 06:28:24.474 DEBUG [$_NIOREACTOR-29-RW] (io.mycat.backend.mysql.nio.handler.MultiNodeQueryHandler.&lt;init&gt;(MultiNodeQueryHandler.java:137)) - has data merge logic 2017-07-07 06:28:24.474 DEBUG [$_NIOREACTOR-29-RW] (io.mycat.backend.mysql.nio.handler.MultiNodeQueryHandler.execute(MultiNodeQueryHandler.java:170)) - rrs.getRunOnSlave()-null2017-07-07 06:28:24.474 DEBUG [$_NIOREACTOR-29-RW] (io.mycat.backend.mysql.nio.handler.MultiNodeQueryHandler.execute(MultiNodeQueryHandler.java:180)) - node.getRunOnSlave()1-null2017-07-07 06:28:24.474 DEBUG [$_NIOREACTOR-29-RW] (io.mycat.backend.mysql.nio.handler.MultiNodeQueryHandler.execute(MultiNodeQueryHandler.java:182)) - node.getRunOnSlave()2-null2017-07-07 06:28:24.474 DEBUG [$_NIOREACTOR-29-RW] (io.mycat.backend.datasource.PhysicalDBNode.getConnection(PhysicalDBNode.java:96)) - rrs.getRunOnSlave() null2017-07-07 06:28:24.475 DEBUG [$_NIOREACTOR-29-RW] (io.mycat.backend.datasource.PhysicalDBNode.getConnection(PhysicalDBNode.java:127)) - rrs.getRunOnSlave() null2017-07-07 06:28:24.475 DEBUG [$_NIOREACTOR-29-RW] (io.mycat.backend.datasource.PhysicalDBPool.getRWBanlanceCon(PhysicalDBPool.java:456)) - select read source hostS1 for dataHost:localhost12017-07-07 06:28:24.475 DEBUG [$_NIOREACTOR-29-RW] (io.mycat.backend.mysql.nio.handler.MultiNodeQueryHandler.execute(MultiNodeQueryHandler.java:180)) - node.getRunOnSlave()1-null2017-07-07 06:28:24.475 DEBUG [$_NIOREACTOR-29-RW] (io.mycat.backend.mysql.nio.handler.MultiNodeQueryHandler.execute(MultiNodeQueryHandler.java:182)) - node.getRunOnSlave()2-null2017-07-07 06:28:24.475 DEBUG [$_NIOREACTOR-29-RW] (io.mycat.backend.datasource.PhysicalDBNode.getConnection(PhysicalDBNode.java:96)) - rrs.getRunOnSlave() null2017-07-07 06:28:24.475 DEBUG [$_NIOREACTOR-29-RW] (io.mycat.backend.datasource.PhysicalDBNode.getConnection(PhysicalDBNode.java:127)) - rrs.getRunOnSlave() nullå°±æ˜¯è¿™äº†æˆ‘ä»¬å¯ä»¥çœ‹åˆ°select read source hostS1 for dataHost:localhost1æ¥è‡³å“ªä¸ªæœåŠ¡å™¨2017-07-07 06:28:24.475 DEBUG [$_NIOREACTOR-29-RW] (io.mycat.backend.datasource.PhysicalDBPool.getRWBanlanceCon(PhysicalDBPool.java:456)) - select read source hostS1 for dataHost:localhost12017-07-07 06:28:24.475 DEBUG [$_NIOREACTOR-29-RW] (io.mycat.backend.mysql.nio.handler.MultiNodeQueryHandler.execute(MultiNodeQueryHandler.java:180)) - node.getRunOnSlave()1-null2017-07-07 06:28:24.475 DEBUG [$_NIOREACTOR-29-RW] (io.mycat.backend.mysql.nio.handler.MultiNodeQueryHandler.execute(MultiNodeQueryHandler.java:182)) - node.getRunOnSlave()2-null2017-07-07 06:28:24.475 DEBUG [$_NIOREACTOR-29-RW] (io.mycat.backend.datasource.PhysicalDBNode.getConnection(PhysicalDBNode.java:96)) - rrs.getRunOnSlave() null2017-07-07 06:28:24.476 DEBUG [$_NIOREACTOR-29-RW] (io.mycat.backend.datasource.PhysicalDBNode.getConnectionå¦‚æœé…ç½®ä¸å°å¿ƒé”™äº†ï¼Œå¯ä»¥ç”¨docker cp å¤åˆ¶åˆ°é•œåƒé‡Œï¼Œç„¶åé‡å¯é•œåƒdocker cp /usr/mycat/mycat/conf 61e74eee274d9d0f0404a572dec1d14c8b03dfd480e13d3c96fa04c534df0556:/var/local/mycat/confdocker restart 61e74eee274</code></pre>]]></content>
      
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> docker </tag>
            
            <tag> mycat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx rewriteæ¨¡å—æ·±å…¥æµ…å‡ºè¯¦è§£</title>
      <link href="/p/eee93e1e/"/>
      <url>/p/eee93e1e/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h5 id="ewriteæ¨¡å—ï¼ˆngx-http-rewrite-moduleï¼‰"><a href="#ewriteæ¨¡å—ï¼ˆngx-http-rewrite-moduleï¼‰" class="headerlink" title="ewriteæ¨¡å—ï¼ˆngx_http_rewrite_moduleï¼‰"></a>ewriteæ¨¡å—ï¼ˆngx_http_rewrite_moduleï¼‰</h5><p>nginxé€šè¿‡ngx_http_rewrite_moduleæ¨¡å—æ”¯æŒurlé‡å†™ã€æ”¯æŒifæ¡ä»¶åˆ¤æ–­ï¼Œä½†ä¸æ”¯æŒelseã€‚å¦å¤–è¯¥æ¨¡å—éœ€è¦PCREæ”¯æŒï¼Œåº”åœ¨ç¼–è¯‘nginxæ—¶æŒ‡å®šPCREæ”¯æŒã€‚æ ¹æ®ç›¸å…³å˜é‡é‡å®šå‘å’Œé€‰æ‹©ä¸åŒçš„é…ç½®ï¼Œä»ä¸€ä¸ªlocationè·³è½¬åˆ°å¦ä¸€ä¸ªlocationï¼Œä¸è¿‡è¿™æ ·çš„å¾ªç¯æœ€å¤šå¯ä»¥æ‰§è¡Œ10æ¬¡ï¼Œè¶…è¿‡ånginxå°†è¿”å›500é”™è¯¯ã€‚åŒæ—¶ï¼Œé‡å†™æ¨¡å—åŒ…å«setæŒ‡ä»¤ï¼Œæ¥åˆ›å»ºæ–°çš„å˜é‡å¹¶è®¾å…¶å€¼ï¼Œè¿™åœ¨æœ‰äº›æƒ…æ™¯ä¸‹éå¸¸æœ‰ç”¨çš„ï¼Œå¦‚è®°å½•æ¡ä»¶æ ‡è¯†ã€ä¼ é€’å‚æ•°åˆ°å…¶ä»–locationã€è®°å½•åšäº†ä»€ä¹ˆç­‰ç­‰ã€‚å­¦ä¹ rewriteä¹‹å‰è¦å¯¹æ­£åˆ™è¡¨è¾¾å¼è¦å¾ˆç†Ÿæ‚‰ï¼Œä¸‹é¢å…ˆç»™å‡ºä¸€äº›å¸¸ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼å…ƒå­—ç¬¦ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.     :åŒ¹é…é™¤æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„å­—ç¬¦</span><br><span class="line">?     :é‡å¤0æ¬¡æˆ–1æ¬¡</span><br><span class="line">+     :é‡å¤1æ¬¡æˆ–æ›´å¤šæ¬¡</span><br><span class="line">*     :é‡å¤0æ¬¡æˆ–æ›´å¤šæ¬¡</span><br><span class="line">\d    :åŒ¹é…æ•°å­—</span><br><span class="line">^     :åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹å­—ç¬¦</span><br><span class="line">$     :åŒ¹é…å­—ç¬¦ä¸²çš„ç»“æŸå­—ç¬¦</span><br><span class="line">&#123;n&#125;   :é‡å¤næ¬¡</span><br><span class="line">&#123;n,&#125;  :é‡å¤næ¬¡æˆ–æ›´å¤šæ¬¡</span><br><span class="line">[c]   :åŒ¹é…å•ä¸ªå­—ç¬¦c</span><br><span class="line">[a-z] :åŒ¹é…a-zå°å†™å­—æ¯çš„ä»»æ„ä¸€ä¸ª</span><br></pre></td></tr></table></figure><p>åœ¨rewriteä¸­ï¼Œå¦‚æœä½¿ç”¨å°æ‹¬å·()ï¼Œé‚£ä¹ˆåœ¨å°æ‹¬å·ä¹‹é—´åŒ¹é…çš„å†…å®¹ï¼Œå¯ä»¥åœ¨åé¢é€šè¿‡$1æ¥å¼•ç”¨ï¼Œ$2è¡¨ç¤ºçš„æ˜¯å‰é¢ç¬¬äºŒä¸ª()é‡Œçš„å†…å®¹ï¼Œåé¢ä¼šè¯´åˆ°ã€‚</p><h6 id="Rewriteæ¨¡å—æŒ‡ä»¤"><a href="#Rewriteæ¨¡å—æŒ‡ä»¤" class="headerlink" title="Rewriteæ¨¡å—æŒ‡ä»¤"></a>Rewriteæ¨¡å—æŒ‡ä»¤</h6><p>1ï¼‰break</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Syntax: break;</span><br><span class="line">Default:â€”</span><br><span class="line">Context:server, location, if</span><br></pre></td></tr></table></figure><p>æ­¤æŒ‡ä»¤çš„æ„æ€æ˜¯åœæ­¢æ‰§è¡Œå½“å‰è™šæ‹Ÿä¸»æœºçš„åç»­rewriteæŒ‡ä»¤é›†ã€‚ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if ($slow) &#123;</span><br><span class="line">     limit_rate 10k;</span><br><span class="line">     break;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ï¼‰if  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Syntax: if (condition) &#123; ... &#125;</span><br><span class="line">Default:â€”</span><br><span class="line">Context:server, location</span><br></pre></td></tr></table></figure><p>å¯¹ç»™å®šçš„æ¡ä»¶ï¼ˆconditionï¼‰è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ¡ä»¶ä¸ºçœŸï¼Œå¤§æ‹¬å·å†…çš„rewriteæŒ‡ä»¤å°†è¢«æ‰§è¡Œã€‚</p><p>æ¡ä»¶(conditon)å¯ä»¥æ˜¯å¦‚ä¸‹ä»»ä½•æ“ä½œï¼š</p><ul><li><ol><li>å½“è¡¨è¾¾å¼åªæ˜¯ä¸€ä¸ªå˜é‡æ—¶ï¼Œå¦‚æœå€¼ä¸ºç©ºæˆ–ä»»ä½•ä»¥0å¼€å¤´çš„å­—ç¬¦ä¸²éƒ½ä¼šå½“åšfalseï¼›</li></ol></li><li><ol start="2"><li>ä½¿ç”¨â€œ=â€å’Œâ€œ!=â€æ¯”è¾ƒä¸€ä¸ªå˜é‡å’Œå­—ç¬¦ä¸²ï¼›</li></ol></li><li><ol start="3"><li>ä½¿ç”¨â€œ<del>â€åšæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œâ€œ</del>*â€åšä¸åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é…ï¼Œâ€œ!~â€åšåŒºåˆ†å¤§å°å†™çš„æ­£åˆ™ä¸åŒ¹é…ï¼›</li></ol></li><li><ol start="4"><li>ä½¿ç”¨â€œ-fâ€å’Œâ€œ!-fâ€ æ£€æŸ¥ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼›</li></ol></li><li><ol start="5"><li>ä½¿ç”¨â€œ-dâ€å’Œâ€œ!-dâ€æ£€æŸ¥ä¸€ä¸ªç›®å½•æ˜¯å¦å­˜åœ¨ï¼›</li></ol></li><li><ol start="6"><li>ä½¿ç”¨â€œ-eâ€å’Œâ€œ!-eâ€æ£€æŸ¥ä¸€ä¸ªæ–‡ä»¶ã€ç›®å½•ã€ç¬¦å·é“¾æ¥æ˜¯å¦å­˜åœ¨ï¼›</li></ol></li><li><ol start="7"><li>ä½¿ç”¨â€œ-xâ€å’Œâ€œ !-xâ€æ£€æŸ¥ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œï¼›<br>å¦‚ä¸‹ç¤ºä¾‹ï¼š</li></ol></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;å¦‚æœUAåŒ…å«&quot;MSIE&quot;ï¼Œrewriteè¯·æ±‚åˆ°&#x2F;msid&#x2F;ç›®å½•ä¸‹</span><br><span class="line">if ($http_user_agent ~ MSIE) &#123;</span><br><span class="line">    rewrite ^(.*)$ &#x2F;msie&#x2F;$1 break;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">&#x2F;&#x2F;å¦‚æœcookieåŒ¹é…æ­£åˆ™ï¼Œè®¾ç½®å˜é‡$idç­‰äºæ­£åˆ™å¼•ç”¨éƒ¨åˆ†</span><br><span class="line">if ($http_cookie ~* &quot;id&#x3D;([^;]+)(?:;|$)&quot;) &#123;</span><br><span class="line">    set $id $1;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">&#x2F;&#x2F;ç»™æŸä¸ªè®¿é—®IPè¿”å›403</span><br><span class="line">if ( $remote_addr &#x3D; &quot;202\.38\.78\.85&quot; )&#123;</span><br><span class="line">    return 403;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">&#x2F;&#x2F;å¦‚æœæäº¤æ–¹æ³•ä¸ºPOSTï¼Œåˆ™è¿”å›çŠ¶æ€405ï¼ˆMethod not allowedï¼‰ã€‚returnä¸èƒ½è¿”å›301,302</span><br><span class="line">if ($request_method &#x3D; POST) &#123;</span><br><span class="line">    return 405;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">&#x2F;&#x2F;å¦‚æœ$slowå¯ä»¥é€šè¿‡setæŒ‡ä»¤è®¾ç½®ï¼Œåˆ™è¿›è¡Œé™é€Ÿå¤„ç†</span><br><span class="line">if ($slow) &#123;</span><br><span class="line">    limit_rate 10k;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">&#x2F;&#x2F;å¦‚æœè¯·æ±‚çš„æ–‡ä»¶åä¸å­˜åœ¨ï¼Œåˆ™åå‘ä»£ç†åˆ°localhost ã€‚è¿™é‡Œçš„breakä¹Ÿæ˜¯åœæ­¢rewriteæ£€æŸ¥</span><br><span class="line">if (!-f $request_filename)&#123;</span><br><span class="line">    break;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;127.0.0.1;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">&#x2F;&#x2F;å¦‚æœquery stringä¸­åŒ…å«&quot;post&#x3D;140&quot;ï¼Œåˆ™æ°¸ä¹…é‡å®šå‘åˆ°example.com</span><br><span class="line">if ($args ~ post&#x3D;140)&#123;</span><br><span class="line">    rewrite ^ http:&#x2F;&#x2F;example.com&#x2F; permanent;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">&#x2F;&#x2F;é˜²ç›—é“¾</span><br><span class="line">location ~* \.(gif|jpg|png|swf|flv)$ &#123;</span><br><span class="line">    valid_referers none blocked www.baidu.com www.ywnds.com;</span><br><span class="line">    if ($invalid_referer) &#123;</span><br><span class="line">        return 404;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ï¼‰return</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Syntax: return code [text];</span><br><span class="line">        return code URL;</span><br><span class="line">        return URL;</span><br><span class="line">Default:â€”</span><br><span class="line">Context:server, location, if</span><br></pre></td></tr></table></figure><p>åœæ­¢å¤„ç†å¹¶ä¸ºå®¢æˆ·ç«¯è¿”å›çŠ¶æ€ç ï¼Œéæ ‡å‡†çš„444çŠ¶æ€ç å°†å…³é—­è¿æ¥ï¼Œä¸å‘é€ä»»ä½•å“åº”å¤´ã€‚å¯ä»¥ä½¿ç”¨çš„çŠ¶æ€ç æœ‰ï¼š204ï¼Œ400ï¼Œ402-406ï¼Œ408ï¼Œ410, 411, 413, 416ä¸500-504ã€‚å¦‚æœçŠ¶æ€ç é™„å¸¦æ–‡å­—æ®µè½ï¼Œè¯¥æ–‡æœ¬å°†è¢«æ”¾ç½®åœ¨å“åº”ä¸»ä½“ã€‚ç›¸åï¼Œå¦‚æœçŠ¶æ€ç åé¢æ˜¯ä¸€ä¸ªURLï¼Œè¯¥URLå°†æˆä¸ºlocationå¤´éƒ¨å€¼ã€‚æ²¡æœ‰çŠ¶æ€ç çš„URLå°†è¢«è§†ä¸ºä¸€ä¸ª302çŠ¶æ€ç ã€‚</p><p>4ï¼‰rewrite</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Syntax: rewrite regex replacement [flag];</span><br><span class="line">Default:â€”</span><br><span class="line">Context:server, location, if</span><br></pre></td></tr></table></figure><p>rewriteæŒ‡ä»¤çš„åŠŸèƒ½å°±æ˜¯ï¼Œä½¿ç”¨nginxæä¾›çš„å…¨å±€å˜é‡æˆ–è‡ªå·±è®¾ç½®çš„å˜é‡ï¼Œç„¶åç»“åˆæ­£åˆ™è¡¨è¾¾å¼å’Œæ ‡å¿—ä½å®ç°urlé‡å†™ä»¥åŠé‡å®šå‘ã€‚rewriteæŒ‡ä»¤åªèƒ½æ”¾åœ¨serverã€locationæˆ–ifä¸­ï¼Œå¹¶ä¸”åªèƒ½å¯¹åŸŸååè¾¹çš„é™¤å»ä¼ é€’çš„å‚æ•°å¤–çš„å­—ç¬¦ä¸²èµ·ä½œç”¨ï¼Œä¾‹å¦‚ <a href="http://ywnds.com/a/we/index.php?id=1&amp;u=strï¼Œåªå¯¹/a/we/index.phpé‡å†™ï¼Œè¯­æ³•å¦‚ä¸Šé¢æ‰€ç¤ºã€‚" target="_blank" rel="noopener">http://ywnds.com/a/we/index.php?id=1&amp;u=strï¼Œåªå¯¹/a/we/index.phpé‡å†™ï¼Œè¯­æ³•å¦‚ä¸Šé¢æ‰€ç¤ºã€‚</a></p><p>å¦‚æœæƒ³å¯¹åŸŸåæˆ–å‚æ•°å­—ç¬¦ä¸²èµ·ä½œç”¨ï¼Œå¯ä»¥ä½¿ç”¨å…¨å±€å˜é‡åŒ¹é…ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨proxy_passåå‘ä»£ç†ã€‚</p><p>æˆ–è®¸çœ‹rewriteå’ŒlocationåŠŸèƒ½æœ‰ç‚¹åƒï¼Œéƒ½èƒ½å®ç°è·³è½¬ï¼Œä¸»è¦åŒºåˆ«åœ¨äºrewriteæ˜¯åœ¨åŒä¸€åŸŸåå†…æ›´æ”¹è·å–èµ„æºçš„è·¯å¾„ï¼Œè€Œlocationæ˜¯å¯¹ä¸€ç±»è·¯å¾„åšæ§åˆ¶è®¿é—®æˆ–åå‘ä»£ç†ï¼Œå¯ä»¥proxy_passåˆ°å…¶ä»–æœºå™¨ã€‚å¾ˆå¤šæƒ…å†µä¸‹rewriteä¹Ÿä¼šå†™åœ¨locationé‡Œï¼Œå®ƒä»¬çš„æ‰§è¡Œé¡ºåºæ˜¯ï¼š</p><p>1ï¼‰å¤„ç†åœ¨serverçº§åˆ«ä¸­å®šä¹‰çš„æ¨¡å—æŒ‡ä»¤ï¼›</p><p>2ï¼‰ä¸ºè¯·æ±‚æŸ¥æ‰¾locationï¼›</p><p>3ï¼‰å¤„ç†åœ¨é€‰ä¸­çš„locationä¸­å®šä¹‰çš„æ¨¡å—æŒ‡ä»¤ï¼Œå¦‚æœæŒ‡ä»¤æ”¹å˜äº†URIï¼ŒæŒ‰æ–°çš„URIæŸ¥æ‰¾locationã€‚è¿™ä¸ªå¾ªç¯è‡³å¤šé‡å¤10æ¬¡ï¼Œä¹‹ånginxè¿”å›é”™è¯¯500 (Internal Server Error)ï¼›</p><p>å¦‚æœä¸€ä¸ªURIåŒ¹é…äº†rewriteæŒ‡ä»¤æŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼ï¼ˆregexï¼‰ï¼Œåˆ™URIå°±æŒ‰ç…§replacementè¿›è¡Œé‡å†™ï¼Œè€ŒrewriteæŒ‰é…ç½®æ–‡ä»¶ä¸­å‡ºç°çš„é¡ºåºæ‰§è¡Œã€‚å…¶ä¸­flagæ ‡å¿—å¯ä»¥åœæ­¢ç»§ç»­å¤„ç†ã€‚å¦‚æœreplacementä»¥â€http://â€æˆ–â€https://â€å¼€å§‹ï¼Œå°†ä¸å†ç»§ç»­å¤„ç†ï¼Œé‚£ä¹ˆè¿™ä¸ªé‡å®šå‘å°†ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>flagå¯ä»¥æ˜¯å¦‚ä¸‹å‚æ•°ï¼š</p><p>lastï¼Œå®Œæˆè¯¥rewriteè§„åˆ™çš„æ‰§è¡Œåï¼Œåœæ­¢å¤„ç†åç»­rewriteæŒ‡ä»¤é›†ï¼›ç„¶åæŸ¥æ‰¾åŒ¹é…æ”¹å˜åURIçš„æ–°locationï¼›</p><p>breakï¼Œå®Œæˆè¯¥rewriteè§„åˆ™çš„æ‰§è¡Œåï¼Œåœæ­¢å¤„ç†åç»­rewriteæŒ‡ä»¤é›†ï¼Œå¹¶ä¸å†é‡æ–°æŸ¥æ‰¾ï¼›ä½†æ˜¯å½“å‰locationå†…å‰©ä½™érewriteè¯­å¥å’Œlocationå¤–çš„çš„érewriteè¯­å¥å¯ä»¥æ‰§è¡Œï¼›</p><p>redirectï¼Œè¿”å›302ä¸´æ—¶é‡å®šå‘ï¼Œåœ°å€æ ä¼šæ˜¾ç¤ºè·³è½¬åçš„åœ°å€ï¼›</p><p>permanentï¼Œè¿”å›301æ°¸ä¹…é‡å®šå‘ï¼Œåœ°å€æ ä¼šæ˜¾ç¤ºè·³è½¬åçš„åœ°å€ï¼›å³è¡¨ç¤ºå¦‚æœå®¢æˆ·ç«¯ä¸æ¸…ç†æµè§ˆå™¨ç¼“å­˜ï¼Œé‚£ä¹ˆè¿”å›çš„ç»“æœå°†æ°¸ä¹…ä¿å­˜åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ä¸­äº†ã€‚</p><p>å› ä¸º301å’Œ302ä¸èƒ½ç®€å•çš„åªè¿”å›çŠ¶æ€ç ï¼Œè¿˜å¿…é¡»æœ‰é‡å®šå‘çš„URLï¼Œè¿™å°±æ˜¯returnæŒ‡ä»¤æ— æ³•è¿”å›301,302çš„åŸå› äº†ã€‚è¿™é‡Œlastå’ŒbreakåŒºåˆ«æœ‰ç‚¹éš¾ä»¥ç†è§£ï¼š</p><p>1ï¼‰lastä¸€èˆ¬å†™åœ¨serverå’Œifä¸­ï¼Œè€Œbreakä¸€èˆ¬ä½¿ç”¨åœ¨locationä¸­ï¼›</p><p>2ï¼‰lastä¸ç»ˆæ­¢é‡å†™åçš„urlåŒ¹é…ï¼Œå³æ–°çš„urlä¼šå†ä»serverèµ°ä¸€éåŒ¹é…æµç¨‹ï¼Œè€Œbreakç»ˆæ­¢é‡å†™åçš„åŒ¹é…ï¼›</p><p>3ï¼‰breakå’Œlastéƒ½èƒ½ç»„ç»‡ç»§ç»­æ‰§è¡Œåé¢çš„rewriteæŒ‡ä»¤ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">     ...</span><br><span class="line">     rewrite ^(&#x2F;download&#x2F;.*)&#x2F;media&#x2F;(.*)..*$ $1&#x2F;mp3&#x2F;$2.mp3 last;</span><br><span class="line">     rewrite ^(&#x2F;download&#x2F;.*)&#x2F;audio&#x2F;(.*)..*$ $1&#x2F;mp3&#x2F;$2.ra last;</span><br><span class="line">     return 403;</span><br><span class="line">     ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿™äº›rewriteæ”¾åˆ°â€œ/download/â€è·¯å¾„ï¼Œé‚£ä¹ˆlocationå¦‚ä¸‹æ‰€ç¤ºï¼Œè¿™æ—¶åº”ä½¿ç”¨breakè€Œä¸æ˜¯lastï¼Œä½¿ç”¨lastå°†å¾ªç¯10æ¬¡åŒ¹é…ï¼Œç„¶åè¿”å›500é”™è¯¯:   </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F;download&#x2F; &#123;</span><br><span class="line">     rewrite ^(&#x2F;download&#x2F;.*)&#x2F;media&#x2F;(.*)..*$ $1&#x2F;mp3&#x2F;$2.mp3 break;</span><br><span class="line">     rewrite ^(&#x2F;download&#x2F;.*)&#x2F;audio&#x2F;(.*)..*$ $1&#x2F;mp3&#x2F;$2.ra break;</span><br><span class="line">     return 403;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºé‡å†™åçš„URLï¼ˆreplacementï¼‰åŒ…å«åŸè¯·æ±‚çš„è¯·æ±‚å‚æ•°ï¼ŒåŸURLçš„?åçš„å†…å®¹ã€‚å¦‚æœä¸æƒ³å¸¦åŸè¯·æ±‚çš„å‚æ•°ï¼Œå¯ä»¥åœ¨replacementååŠ ä¸€ä¸ªé—®å·ã€‚å¦‚ä¸‹ï¼Œæˆ‘ä»¬åŠ äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„å‚æ•°user=$1,ç„¶ååœ¨ç»“å°¾å¤„æ”¾äº†ä¸€ä¸ªé—®å·?ï¼ŒæŠŠåŸè¯·æ±‚çš„å‚æ•°å»æ‰ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rewrite ^&#x2F;users&#x2F;(.*)$ &#x2F;show?user&#x3D;$1? last;</span><br></pre></td></tr></table></figure><p>æ³¨: å¯¹èŠ±æ‹¬å·â€œ}â€æˆ–â€œ;â€æ¥è¯´ï¼Œä½¿ç”¨æ—¶éœ€è¦ç”¨åŒå¼•å·æˆ–å•å¼•å·åŒ…å›´ã€‚å› ä¸ºä»–ä»¬æ—¢èƒ½ç”¨åœ¨é‡å®šå‘çš„æ­£åˆ™è¡¨è¾¾å¼é‡Œï¼Œä¹Ÿæ˜¯ç”¨åœ¨é…ç½®æ–‡ä»¶é‡Œåˆ†å‰²ä»£ç å—, ä¸ºäº†é¿å…å†²çª, æ­£åˆ™è¡¨è¾¾å¼é‡Œå¸¦èŠ±æ‹¬å·çš„è¯ï¼Œåº”è¯¥ç”¨åŒå¼•å·ï¼ˆæˆ–è€…å•å¼•å·ï¼‰åŒ…å›´ã€‚æ¯”å¦‚ï¼Œè¦å°†ç±»ä¼¼ä»¥ä¸‹çš„URIï¼šâ€/photos/123456â€³é‡å®šå‘åˆ°â€/path/to/photos/12/1234/123456.pngâ€å¯ä»¥ç”¨ä»¥ä¸‹æ–¹æ³• (æ³¨æ„åŒå¼•å·):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rewrite &quot;&#x2F;photos&#x2F;([0-9] &#123;2&#125;)([0-9] &#123;2&#125;)([0-9] &#123;2&#125;)&quot; &#x2F;path&#x2F;to&#x2F;photos&quot;</span><br></pre></td></tr></table></figure><p>5ï¼‰set</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Syntax: set $variable value;</span><br><span class="line">Default:â€”</span><br><span class="line">Context:server, location, if</span><br></pre></td></tr></table></figure><p>å®šä¹‰ä¸€ä¸ªå˜é‡å¹¶èµ‹å€¼ï¼Œå€¼å¯ä»¥æ˜¯æ–‡æœ¬ï¼Œå˜é‡æˆ–è€…æ–‡æœ¬å˜é‡æ··åˆä½“ã€‚</p><p>6ï¼‰rewrite_log</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Syntax: rewrite_log on | off;</span><br><span class="line">Default:rewrite_log off;</span><br><span class="line">Context:http, server, location, if</span><br></pre></td></tr></table></figure><p>å¼€å¯æˆ–å…³é—­ä»¥noticeçº§åˆ«æ‰“å°rewriteå¤„ç†æ—¥å¿—åˆ°error logæ–‡ä»¶ã€‚nginxæ‰“å¼€rewrite logçš„ä¾‹å­å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rewrite_log on;                        &#x2F;&#x2F;æ‰“å¼€rewrite log</span><br><span class="line">error_log logs&#x2F;xxx.error.log notice;   &#x2F;&#x2F;æŠŠerror logçš„çº§åˆ«è°ƒæ•´ä¸ºnotice</span><br></pre></td></tr></table></figure><p>7ï¼‰uninitialized_variable_warn  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Syntax: uninitialized_variable_warn on | off;</span><br><span class="line">Default:uninitialized_variable_warn on;</span><br><span class="line">Context:http, server, location, if</span><br></pre></td></tr></table></figure><p>æ§åˆ¶æ˜¯å¦è¾“å‡ºä¸ºåˆå§‹åŒ–çš„å˜é‡åˆ°æ—¥å¿—ã€‚</p><p>é‡å†™è§„åˆ™ç»„æˆéƒ¨åˆ†</p><p>ç¬¬ä¸€éƒ¨åˆ†ï¼šä»»ä½•é‡å†™è§„åˆ™çš„ç¬¬ä¸€éƒ¨åˆ†éƒ½æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼</p><p>æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥ä½¿ç”¨æ‹¬å·æ¥æ•è·ï¼Œåç»­å¯ä»¥æ ¹æ®ä½ç½®æ¥å°†å…¶å¼•ç”¨ï¼Œä½ç½®å˜é‡å€¼å–å†³äºæ•è·æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„é¡ºåºï¼Œ$1å¼•ç”¨ç¬¬ä¸€ä¸ªæ‹¬å·ä¸­çš„å€¼ï¼Œ$2å¼•ç”¨ç¬¬äºŒä¸ªæ‹¬å·ä¸­çš„å€¼ï¼Œä»¥æ­¤ç±»æ¨ã€‚å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^&#x2F;images&#x2F;([a-z]&#123;2&#125;)&#x2F;([a-z0-9]&#123;5&#125;)&#x2F;(.*)\.(png|jpg|gif)$</span><br></pre></td></tr></table></figure><p>$1æ˜¯ä¸¤ä¸ªå°å†™å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œ$2æ˜¯ç”±å°å†™å­—æ¯å’Œ0åˆ°9çš„æ•°å­—ç»„æˆçš„5ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œ$3å°†æ˜¯ä¸ªæ–‡ä»¶åï¼Œ$4æ˜¯pngã€jpgã€gifä¸­çš„å…¶ä¸­ä¸€ä¸ªã€‚</p><p>ç¬¬äºŒéƒ¨åˆ†ï¼šé‡å†™è§„åˆ™çš„ç¬¬äºŒéƒ¨åˆ†æ˜¯URI</p><p>å½“é‡å†™è§„åˆ™ç¬¬ä¸€éƒ¨åˆ†è¢«åŒ¹é…åˆ°äº†ä¹‹åï¼Œåˆ™è¯·æ±‚è¢«æ”¹å†™ï¼Œé‚£ä¹ˆè¯¥URIå¯èƒ½åŒ…å«æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„æ•è·çš„ä½ç½®å‚æ•°æˆ–è¿™ä¸ªçº§åˆ«ä¸‹çš„nginxä»»ä½•é…ç½®å˜é‡ã€‚å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;data?file&#x3D;$3.$4</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿™ä¸ªURIä¸åŒ¹é…nginxé…ç½®çš„ä»»ä½•locationï¼Œé‚£ä¹ˆå°†ç»™å®¢æˆ·ç«¯è¿”å›301(æ°¸ä¹…é‡å®šå‘)æˆ–302(ä¸´æ—¶é‡å®šå‘)çš„çŠ¶æ€ç æ¥è¡¨ç¤ºé‡å®šå‘ç±»å‹ã€‚è¯¥çŠ¶æ€ç å¯ä»¥é€šè¿‡ç¬¬ä¸‰ä¸ªå‚æ•°æ¥æ˜ç¡®æŒ‡å®šã€‚</p><p>ç¬¬ä¸‰éƒ¨åˆ†ï¼šé‡å†™è§„åˆ™çš„ç¬¬ä¸‰éƒ¨åˆ†å°±æ˜¯æ ‡è®°ï¼ˆflagï¼‰</p><p>ç¬¬ä¸‰éƒ¨åˆ†ä¹Ÿå°±æ˜¯å°¾éƒ¨çš„æ ‡è®°ï¼ˆflagï¼‰ï¼Œ lastæ ‡è®°å°†å¯¼è‡´é‡å†™åçš„URIæœç´¢åŒ¹é…nginxçš„å…¶ä»–locationï¼Œæœ€å¤šå¯å¾ªç¯10æ¬¡ã€‚å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rewrite &#39;^&#x2F;images&#x2F;([a-z]&#123;2&#125;)&#x2F;([a-z0-9]&#123;5&#125;)&#x2F;(.*)\.(png|jpg|gif)$&#39; &#x2F;data?file&#x3D;$3.$4 last;</span><br></pre></td></tr></table></figure><p>å…¨å±€å˜é‡</p><p>ä¸‹é¢æ˜¯å¯ä»¥ç”¨ä½œifåˆ¤æ–­çš„å…¨å±€å˜é‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$args               #è¿™ä¸ªå˜é‡ç­‰äºè¯·æ±‚è¡Œä¸­çš„å‚æ•°ï¼ŒåŒ$query_string;</span><br><span class="line">$content_length     #è¯·æ±‚å¤´ä¸­çš„Content-lengthå­—æ®µ;</span><br><span class="line">$content_type       #è¯·æ±‚å¤´ä¸­çš„Content-Typeå­—æ®µ;</span><br><span class="line">$document_root      #å½“å‰è¯·æ±‚åœ¨rootæŒ‡ä»¤ä¸­æŒ‡å®šçš„å€¼ï¼Œå¦‚:root &#x2F;var&#x2F;www&#x2F;html;</span><br><span class="line">$host               #è¯·æ±‚ä¸»æœºå¤´å­—æ®µï¼Œå¦åˆ™ä¸ºæœåŠ¡å™¨åç§°;</span><br><span class="line">$http_user_agent    #å®¢æˆ·ç«¯agentä¿¡æ¯;</span><br><span class="line">$http_cookie        #å®¢æˆ·ç«¯cookieä¿¡æ¯;</span><br><span class="line">$limit_rate         #è¿™ä¸ªå˜é‡å¯ä»¥é™åˆ¶è¿æ¥é€Ÿç‡;</span><br><span class="line">$request_method     #å®¢æˆ·ç«¯è¯·æ±‚çš„åŠ¨ä½œï¼Œé€šå¸¸ä¸ºGETæˆ–POST;</span><br><span class="line">$remote_addr        #å®¢æˆ·ç«¯çš„IPåœ°å€;</span><br><span class="line">$remote_port        #å®¢æˆ·ç«¯çš„ç«¯å£;</span><br><span class="line">$remote_user        #å·²ç»ç»è¿‡Auth Basic ModuleéªŒè¯çš„ç”¨æˆ·å;</span><br><span class="line">$request_filename   #å½“å‰è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„ï¼Œç”±rootæˆ–aliasæŒ‡ä»¤ä¸URIè¯·æ±‚ç”Ÿæˆ;</span><br><span class="line">$scheme             #HTTPæ–¹æ³•ï¼ˆå¦‚httpï¼Œhttpsï¼‰;</span><br><span class="line">$server_protocol    #è¯·æ±‚ä½¿ç”¨çš„åè®®ï¼Œé€šå¸¸æ˜¯HTTP&#x2F;1.0æˆ–HTTP&#x2F;1.1;</span><br><span class="line">$server_addr        #æœåŠ¡å™¨åœ°å€ï¼Œåœ¨å®Œæˆä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨åå¯ä»¥ç¡®å®šè¿™ä¸ªå€¼;</span><br><span class="line">$server_name        #æœåŠ¡å™¨åç§°;</span><br><span class="line">$server_port        #è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨çš„ç«¯å£å·;</span><br><span class="line">$request_uri        #åŒ…å«è¯·æ±‚å‚æ•°çš„åŸå§‹URIï¼Œä¸åŒ…å«ä¸»æœºåï¼Œå¦‚ï¼šâ€&#x2F;foo&#x2F;bar.php?arg&#x3D;bazâ€;</span><br><span class="line">$uri                #ä¸å¸¦è¯·æ±‚å‚æ•°çš„å½“å‰URIï¼Œ$uriä¸åŒ…å«ä¸»æœºåï¼Œå¦‚â€&#x2F;foo&#x2F;bar.htmlâ€;</span><br><span class="line">$document_uri       #ä¸$uriç›¸åŒ,ä¾‹ï¼šhttp:&#x2F;&#x2F;localhost:88&#x2F;test1&#x2F;test2&#x2F;test.php;</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š<a href="http://localhost:88/test1/test2/test.phpè¿™ä¸ªURLï¼Œå…¶ä¸­ï¼š" target="_blank" rel="noopener">http://localhost:88/test1/test2/test.phpè¿™ä¸ªURLï¼Œå…¶ä¸­ï¼š</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$hostï¼šlocalhost</span><br><span class="line">$server_portï¼š88</span><br><span class="line">$request_uriï¼šhttp:&#x2F;&#x2F;localhost:88&#x2F;test1&#x2F;test2&#x2F;test.php</span><br><span class="line">$document_uriï¼š&#x2F;test1&#x2F;test2&#x2F;test.php</span><br><span class="line">$document_rootï¼š&#x2F;var&#x2F;www&#x2F;html</span><br><span class="line">$request_filenameï¼š&#x2F;var&#x2F;www&#x2F;html&#x2F;test1&#x2F;test2&#x2F;test.php</span><br></pre></td></tr></table></figure><p>Rewriteæ¨¡å—ä½¿ç”¨å®ä¾‹</p><p>1ï¼‰ä½¿ç”¨rewriteæŒ‡ä»¤æŠŠè®¿é—®80ç«¯å£çš„è¯·æ±‚é‡å®šå‘åˆ°443</p><p>å¯¹äºHTTPSç½‘ç«™ï¼Œä¸€èˆ¬æœ€å°‘éœ€è¦å®šä¹‰ä¸¤ä¸ªè™šæ‹Ÿä¸»æœºï¼Œä¸€ä¸ªæ˜¯ä½¿ç”¨80çš„è™šæ‹Ÿä¸»æœºï¼Œå¦ä¸€ä¸ªå°±æ˜¯ä½¿ç”¨443ç«¯å£çš„è™šæ‹Ÿä¸»æœºäº†ã€‚æ¯”å¦‚åœ¨æµè§ˆå™¨è¾“å…¥<a href="http://www.ywnds.comï¼ˆhttp://www.ywnds.comï¼‰ä¼šè‡ªåŠ¨è·³è½¬åˆ°https://www.ywnds.comã€‚" target="_blank" rel="noopener">www.ywnds.comï¼ˆhttp://www.ywnds.comï¼‰ä¼šè‡ªåŠ¨è·³è½¬åˆ°https://www.ywnds.comã€‚</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rewrite ^(.*)$ https:&#x2F;&#x2F;www.ywnds.com$uri redirect;</span><br></pre></td></tr></table></figure><p>è¿™ç§è·³è½¬å°±æ˜¯302ä¸´æ—¶é‡å®šå‘è·³è½¬ï¼Œå¦‚æœæŠŠflagå˜æˆpermanentå°±æˆäº†301æ°¸ä¹…é‡å®šå‘è·³è½¬äº†ã€‚</p><p>2ï¼‰ä½œä¸ºé‡å†™è§„åˆ™çš„ä¸€éƒ¨åˆ†ï¼Œä¼ é€’æ–°çš„æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°æ˜¯ä½¿ç”¨é‡å†™è§„åˆ™çš„ç›®æ ‡ä¹‹ä¸€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rewrite ^&#x2F;images&#x2F;(.*)_(\d+)x(\d+)\.(png|jpg|gif)$ &#x2F;resizer&#x2F;$1.$4?width&#x3D;$2&amp;height&#x3D;$3? last;</span><br></pre></td></tr></table></figure><p>3ï¼‰ä½¿ç”¨rewriteæ¨¡å—ç¦æ­¢ç”¨æˆ·ä»£ç†</p><p>Nginxå¯ä»¥é€šè¿‡å„ç§æ–¹å¼æ¥é™åˆ¶è®¿é—®ï¼Œä¾‹å¦‚NGINXåŸºæœ¬Httpè®¤è¯ã€allow/denyç­‰ç­‰ï¼Œè¿™äº›éƒ½æ˜¯å‰æ–‡æè¿‡çš„ï¼Œä¸‹é¢æ¥çœ‹çœ‹nginxå¦‚ä½•é€šè¿‡ç”¨æˆ·ä»£ç†æ¥ç¦æ­¢è®¿é—®ã€‚</p><p>user agentæ˜¯ä»€ä¹ˆ?</p><p>ç®€å•æ¥è¯´å‘Šè¯‰æœåŠ¡å™¨ä½ å½“å‰ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆæµè§ˆå™¨ã€å·¥å…·ç­‰æ¥è®¿é—®æˆ‘çš„ã€‚ä¾‹å¦‚ç«ç‹ã€chromeã€wgetã€curlç­‰æµè§ˆå™¨æˆ–å·¥å…·ã€‚ä½¿ç”¨$http_user_agentå˜é‡å°±å¯ä»¥è·å–åˆ°ç”¨æˆ·ä»£ç†ï¼Œä¸€èˆ¬åœ¨å®šä¹‰æ—¥å¿—æ ¼å¼æ—¶éƒ½ä¼šä½¿ç”¨è¿™ä¸ªå˜é‡ï¼ŒæŠŠç”¨æˆ·ä»£ç†è®°å½•åˆ°æ—¥å¿—ä¸­å»ã€‚</p><p>å¦‚ä½•ç¦æ­¢ç‰¹å®šUAï¼Ÿ</p><p>æˆ‘ä»¬ä¸å¸Œæœ›è¢«ä½¿ç”¨wgetæˆ–è€…curlæ¥ä¸‹è½½æˆ‘çš„æ–‡ä»¶ï¼Œæ€ä¹ˆåšå‘¢ï¼Ÿè¿™é‡Œå°±å¯ä»¥ä½¿ç”¨rewriteæ¨¡å—äº†ï¼Œç¼–è¾‘nginxé…ç½®æ–‡ä»¶ï¼Œä»¥ä¸‹å†…å®¹æ”¾åœ¨httpé…ç½®æ®µï¼Œé‚£ä¹ˆæ•´ä¸ªnginxéƒ½ç”Ÿæ•ˆã€‚å¦‚æœæ”¾åˆ°serveré‡Œï¼Œé‚£ä¹ˆä¸€ä¸ªåŸŸåç”Ÿæ•ˆï¼Œä½ æ”¾å“ªï¼Œå“ªå°±æœ‰æ•ˆï¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if ($http_user_agent ~* (curl) ) &#123;</span><br><span class="line">    return 404;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¦æ­¢å¤šä¸ªUA</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if ($http_user_agent ~* (wget|curl) ) &#123;</span><br><span class="line">    return 404;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>nginxé‡å†™è§„åˆ™è¯´èµ·æ¥æŒºç®€å•çš„ï¼Œåšèµ·æ¥å°±éš¾ï¼Œé‡ç‚¹åœ¨äºæ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒæ—¶ï¼Œè¿˜éœ€è¦è€ƒè™‘åˆ°nginxæ‰§è¡Œé¡ºåºã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> rewrite </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginx expiresé…ç½®è¯¦è§£</title>
      <link href="/p/492994d9/"/>
      <url>/p/492994d9/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>expiresèµ·åˆ°æ§åˆ¶é¡µé¢ç¼“å­˜çš„ä½œç”¨ï¼Œåˆç†çš„é…ç½®expireså¯ä»¥å‡å°‘å¾ˆå¤šæœåŠ¡å™¨çš„è¯·æ±‚</p><p>è¦é…ç½®expiresï¼Œå¯ä»¥åœ¨httpæ®µä¸­æˆ–è€…serveræ®µä¸­æˆ–è€…locationæ®µä¸­åŠ å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location ~ \.(gif|jpg|jpeg|png|bmp|ico)$ &#123;</span><br><span class="line">           root &#x2F;var&#x2F;www&#x2F;img&#x2F;;</span><br><span class="line">           expires 30d;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure><p>æ§åˆ¶å›¾ç‰‡ç­‰è¿‡æœŸæ—¶é—´ä¸º30å¤©ï¼Œå½“ç„¶è¿™ä¸ªæ—¶é—´å¯ä»¥è®¾ç½®çš„æ›´é•¿ã€‚å…·ä½“è§†æƒ…å†µè€Œå®š</p><p>æ¯”å¦‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location ~ \.(wma|wmv|asf|mp3|mmf|zip|rar|swf|flv)$ &#123;</span><br><span class="line">               root &#x2F;var&#x2F;www&#x2F;upload&#x2F;;</span><br><span class="line">               expires max;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure><p>expires æŒ‡ä»¤å¯ä»¥æ§åˆ¶ HTTP åº”ç­”ä¸­çš„â€œ Expires â€å’Œâ€œ Cache-Control â€çš„å¤´æ ‡ï¼ˆèµ·åˆ°æ§åˆ¶é¡µé¢ç¼“å­˜çš„ä½œç”¨ï¼‰</p><p>è¯­æ³•ï¼šexpires [time|epoch|max|pff]</p><p>é»˜è®¤å€¼ï¼šoff</p><p>expiresæŒ‡ä»¤æ§åˆ¶HTTPåº”ç­”ä¸­çš„â€œExpiresâ€å’Œâ€œCache-Controlâ€Headerå¤´éƒ¨ä¿¡æ¯ï¼Œå¯åŠ¨æ§åˆ¶é¡µé¢ç¼“å­˜çš„ä½œç”¨</p><p>time:å¯ä»¥ä½¿ç”¨æ­£æ•°æˆ–è´Ÿæ•°ã€‚â€œExpiresâ€å¤´æ ‡çš„å€¼å°†é€šè¿‡å½“å‰ç³»ç»Ÿæ—¶é—´åŠ ä¸Šè®¾å®štimeå€¼æ¥è®¾å®šã€‚</p><p>timeå€¼è¿˜æ§åˆ¶â€Cache-Controlâ€çš„å€¼ï¼š</p><p>è´Ÿæ•°è¡¨ç¤ºno-cache</p><p>æ­£æ•°æˆ–é›¶è¡¨ç¤ºmax-age=time</p><p>epochï¼šæŒ‡å®šâ€œExpiresâ€çš„å€¼ä¸º 1 January,1970,00:00:01 GMT</p><p>max:æŒ‡å®šâ€œExpiresâ€çš„å€¼ä¸º31 December2037 23:59:59GMT,â€Cache-Controlâ€çš„å€¼ä¸º10å¹´ã€‚</p><p>-1ï¼šæŒ‡å®šâ€œExpiresâ€çš„å€¼ä¸ºå½“å‰æœåŠ¡å™¨æ—¶é—´-1sï¼Œå³æ°¸è¿œè¿‡æœŸã€‚</p><p>offï¼šä¸ä¿®æ”¹â€œExpiresâ€å’Œâ€Cache-Controlâ€çš„å€¼</p><p>expiresä½¿ç”¨äº†ç‰¹å®šçš„æ—¶é—´ï¼Œå¹¶ä¸”è¦æ±‚æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„æ˜¯ä¸­ä¸¥æ ¼åŒæ­¥ã€‚</p><p>è€ŒCache-Controlæ˜¯ç”¨max-ageæŒ‡ä»¤æŒ‡å®šç»„ä»¶è¢«ç¼“å­˜å¤šä¹…ã€‚</p><p>å¯¹äºä¸æ”¯æŒhttp1.1çš„æµè§ˆå™¨ï¼Œè¿˜æ˜¯éœ€è¦expiresæ¥æ§åˆ¶ã€‚æ‰€ä»¥æœ€å¥½èƒ½æŒ‡å®šä¸¤ä¸ªå“åº”å¤´ã€‚ä½†HTTPè§„èŒƒè§„å®šmax-ageæŒ‡ä»¤å°†é‡å†™expireså¤´ã€‚</p><p>nginx é™æ€èµ„æºç¼“å­˜è®¾ç½®<br>May 13, 2018<br>nginx é™æ€èµ„æºç¼“å­˜ å¸¸ç”¨é…ç½®ç¤ºä¾‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location ~.*\.(js|css|html|png|jpg)$ &#123;</span><br><span class="line">    expires 3d;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ nginx é™æ€èµ„æºç¼“å­˜ è¯´æ˜:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">expires 3d; &#x2F;&#x2F; è¡¨ç¤ºç¼“å­˜ 3 å¤©</span><br><span class="line"></span><br><span class="line">expires 3h; &#x2F;&#x2F; è¡¨ç¤ºç¼“å­˜ 3 å°æ—¶</span><br><span class="line"></span><br><span class="line">expires max; &#x2F;&#x2F; è¡¨ç¤ºç¼“å­˜ 10 å¹´</span><br><span class="line"></span><br><span class="line">expires -1; &#x2F;&#x2F; è¡¨ç¤ºæ°¸è¿œè¿‡æœŸã€‚</span><br></pre></td></tr></table></figure><p>å¦‚æœè®¾ç½®ä¸º -1 åœ¨ jsã€css ç­‰é™æ€æ–‡ä»¶åœ¨æ²¡æœ‰ä¿®æ”¹çš„æƒ…å†µä¸‹è¿”å›çš„æ˜¯ http 304.</p><p>å¦‚æœä¿®æ”¹è¿”å› http 200</p><p>http 304ï¼šè‡ªä»ä¸Šæ¬¡è¯·æ±‚åï¼Œè¯·æ±‚çš„ç½‘é¡µæœªä¿®æ”¹è¿‡ã€‚æœåŠ¡å™¨è¿”å›æ­¤å“åº”æ—¶ï¼Œä¸ä¼šè¿”å›ç½‘é¡µå†…å®¹ã€‚</p><p>http 200ï¼šæœåŠ¡å™¨å·²æˆåŠŸå¤„ç†äº†è¯·æ±‚ï¼Œè¿™è¡¨ç¤ºæœåŠ¡å™¨æä¾›äº†è¯·æ±‚çš„å†…å®¹ã€‚</p><p>å¦‚æœä¸æƒ³è®©ä»£ç†æˆ–æµè§ˆå™¨ç¼“å­˜ï¼ŒåŠ  no-cache å‚æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location ~.*\.(js|css|html|png|jpg)$ &#123;</span><br><span class="line">    add_header Cache-Control no-cache;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·æµè§ˆå™¨ F5 åˆ·æ–°æ—¶ï¼Œnginx é™æ€èµ„æºç¼“å­˜ è®¾ç½®è¿”å›çš„çŠ¶æ€ç å°±æ˜¯ http 200ï¼Œè€Œä¸æ˜¯ http 304</p>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> expires </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginxçš„é…ç½®</title>
      <link href="/p/b0225828/"/>
      <url>/p/b0225828/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="å¸¸ç”¨çš„å‘½ä»¤"><a href="#å¸¸ç”¨çš„å‘½ä»¤" class="headerlink" title="å¸¸ç”¨çš„å‘½ä»¤"></a><strong>å¸¸ç”¨çš„å‘½ä»¤</strong></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">nginx -h   # å¸®åŠ©</span><br><span class="line">nginx -t   # éªŒè¯é…ç½®æ–‡ä»¶çš„æ­£ç¡®æ€§</span><br><span class="line">nginx -v   # æŸ¥çœ‹nginxçš„ç‰ˆæœ¬</span><br><span class="line">nginx -c filename  # æŒ‰æŒ‡å®šçš„é…ç½®æ–‡ä»¶å¯åŠ¨ï¼Œé»˜è®¤çš„è·¯å¾„conf&#x2F;nginx.conf</span><br><span class="line"></span><br><span class="line">nginx -s reload  # é‡æ–°è½½å…¥é…ç½®æ–‡ä»¶</span><br><span class="line">nginx -s reopen  # é‡å¯nginx</span><br><span class="line">nginx -s stop    # å…³é—­nginx</span><br><span class="line">nginx -s quit    # é€€å‡º</span><br></pre></td></tr></table></figure><h1 id="nginxçš„é…ç½®æ–‡ä»¶çš„è¯¦è§£"><a href="#nginxçš„é…ç½®æ–‡ä»¶çš„è¯¦è§£" class="headerlink" title="nginxçš„é…ç½®æ–‡ä»¶çš„è¯¦è§£"></a>nginxçš„é…ç½®æ–‡ä»¶çš„è¯¦è§£</h1><pre><code>nginxçš„é…ç½®åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ï¼šmain(å…¨åŒºè®¾ç½®)ï¼Œserver(ä¸»æœºé…ç½®)ï¼Œupstream(è´Ÿè½½å‡è¡¡æœåŠ¡å™¨è®¾ç½®)ï¼Œå’Œlocation(URLåŒ¹é…ç‰¹å®šä½ç½®è®¾ç½®)ã€‚</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><span class="line">#å®šä¹‰Nginxè¿è¡Œçš„ç”¨æˆ·å’Œç”¨æˆ·ç»„</span><br><span class="line">user www www;</span><br><span class="line">#pidæ–‡ä»¶</span><br><span class="line">#è¿›ç¨‹æ–‡ä»¶</span><br><span class="line">pid &#x2F;var&#x2F;run&#x2F;nginx.pid;</span><br><span class="line">#nginxè¿›ç¨‹æ•°ï¼Œå»ºè®®è®¾ç½®ä¸ºç­‰äºCPUæ€»æ ¸å¿ƒæ•°ã€‚</span><br><span class="line">#&#x3D;&#x3D;workerè¿›ç¨‹æ•°ï¼Œé€šå¸¸è®¾ç½®ç­‰åŒäºCPUæ•°é‡ï¼Œautoä¸ºè‡ªåŠ¨æ£€æµ‹</span><br><span class="line">worker_processes 8;</span><br><span class="line">worker_processes auto;</span><br><span class="line">#ä¸€ä¸ªnginxè¿›ç¨‹æ‰“å¼€çš„æœ€å¤šæ–‡ä»¶æè¿°ç¬¦æ•°ç›®ï¼Œç†è®ºå€¼åº”è¯¥æ˜¯æœ€å¤šæ‰“å¼€æ–‡ä»¶æ•°ï¼ˆç³»ç»Ÿçš„å€¼ulimit -nï¼‰ä¸nginxè¿›ç¨‹æ•°ç›¸é™¤ï¼Œä½†æ˜¯nginxåˆ†é…è¯·æ±‚å¹¶ä¸å‡åŒ€ï¼Œæ‰€ä»¥å»ºè®®ä¸ulimit -nçš„å€¼ä¿æŒä¸€è‡´ã€‚</span><br><span class="line">#&#x3D;&#x3D;workerè¿›ç¨‹æ‰“å¼€æœ€å¤§æ–‡ä»¶æ•°ï¼Œå¯CPU*10000è®¾ç½®</span><br><span class="line">worker_rlimit_nofile 65535;</span><br><span class="line">#worker_rlimit_nofile 100000;</span><br><span class="line">#å…¨å±€é”™è¯¯æ—¥å¿—</span><br><span class="line">error_log  logs&#x2F;error.log;</span><br><span class="line"># error_log  logs&#x2F;error.log  info; # å¯ä»¥è®¾ç½®çº§åˆ«</span><br><span class="line"></span><br><span class="line"># è®¾ç½®å‰å°è¿è¡Œï¼Œé»˜è®¤åå°è¿è¡Œ</span><br><span class="line">daemon off;</span><br><span class="line"></span><br><span class="line">#å·¥ä½œæ¨¡å¼ä¸è¿æ¥æ•°ä¸Šé™</span><br><span class="line">#eventsæ¨¡å—ä¸­åŒ…å«nginxä¸­æ‰€æœ‰å¤„ç†è¿æ¥çš„è®¾ç½®</span><br><span class="line">events &#123;</span><br><span class="line">    #&#x3D;&#x3D;workerè¿›ç¨‹åŒæ—¶æ‰“å¼€çš„æœ€å¤§è¿æ¥æ•°ï¼Œå¯CPU*2048è®¾ç½®</span><br><span class="line">    worker_connections 2048;</span><br><span class="line">    #&#x3D;&#x3D;å‘Šè¯‰nginxæ”¶åˆ°ä¸€ä¸ªæ–°é“¾æ¥é€šçŸ¥åæ¥å—å°½å¯èƒ½å¤šçš„é“¾æ¥</span><br><span class="line">    multi_accept on;</span><br><span class="line">    #&#x3D;&#x3D;è®¾ç½®ç”¨äºå¤ç”¨å®¢æˆ·ç«¯çº¿ç¨‹çš„è½®è®­æ–¹æ³•</span><br><span class="line">    #å‚è€ƒäº‹ä»¶æ¨¡å‹ï¼Œuse [ kqueue | rtsig | epoll | &#x2F;dev&#x2F;poll | select | poll ]; epollæ¨¡å‹æ˜¯Linux 2.6ä»¥ä¸Šç‰ˆæœ¬å†…æ ¸ä¸­çš„é«˜æ€§èƒ½ç½‘ç»œI&#x2F;Oæ¨¡å‹ï¼Œå¦‚æœè·‘åœ¨FreeBSDä¸Šé¢ï¼Œå°±ç”¨kqueueæ¨¡å‹ã€‚</span><br><span class="line">    use epoll;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#httpæ¨¡å—æ§åˆ¶ç€nginx httpå¤„ç†çš„æ‰€æœ‰æ ¸å¿ƒç‰¹æ€§</span><br><span class="line">http &#123;</span><br><span class="line">    include mime.types; #æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨</span><br><span class="line">    default_type application&#x2F;octet-stream; #é»˜è®¤æ–‡ä»¶ç±»å‹</span><br><span class="line">    #charset utf-8; #é»˜è®¤ç¼–ç </span><br><span class="line">    server_names_hash_bucket_size 128;     #æœåŠ¡å™¨åå­—çš„hashè¡¨å¤§å°</span><br><span class="line">    #ä¸Šä¼ æ–‡ä»¶å¤§å°é™åˆ¶</span><br><span class="line">    large_client_header_buffers 4 64k;</span><br><span class="line">    #&#x3D;&#x3D;å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°</span><br><span class="line">    client_max_body_size 8m;</span><br><span class="line">    #&#x3D;&#x3D;å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°</span><br><span class="line">    client_header_buffer_size 32k;</span><br><span class="line">    sendfile on; #å¼€å¯é«˜æ•ˆæ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼ŒsendfileæŒ‡ä»¤æŒ‡å®šnginxæ˜¯å¦è°ƒç”¨sendfileå‡½æ•°æ¥è¾“å‡ºæ–‡ä»¶ï¼Œå¯¹äºæ™®é€šåº”ç”¨è®¾ä¸º onï¼Œå¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸ºoffï¼Œä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œI&#x2F;Oå¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿçš„è´Ÿè½½ã€‚æ³¨æ„ï¼šå¦‚æœå›¾ç‰‡æ˜¾ç¤ºä¸æ­£å¸¸æŠŠè¿™ä¸ªæ”¹æˆoffã€‚</span><br><span class="line">    autoindex on; #å¼€å¯ç›®å½•åˆ—è¡¨è®¿é—®ï¼Œåˆé€‚ä¸‹è½½æœåŠ¡å™¨ï¼Œé»˜è®¤å…³é—­ã€‚</span><br><span class="line">    tcp_nopush on; #é˜²æ­¢ç½‘ç»œé˜»å¡</span><br><span class="line">    tcp_nodelay on; #é˜²æ­¢ç½‘ç»œé˜»å¡</span><br><span class="line">    keepalive_timeout 120; #é•¿è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’</span><br><span class="line">    </span><br><span class="line">    #æ—¥å¿—æ ¼å¼è®¾å®š</span><br><span class="line">    log_format access &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span><br><span class="line">                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span><br><span class="line">                      &#39;&quot;$http_user_agent&quot; $http_x_forwarded_for&#39;;</span><br><span class="line">    #å®šä¹‰æœ¬è™šæ‹Ÿä¸»æœºçš„è®¿é—®æ—¥å¿—</span><br><span class="line">    access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log  main;</span><br><span class="line">    #FastCGIç›¸å…³å‚æ•°æ˜¯ä¸ºäº†æ”¹å–„ç½‘ç«™çš„æ€§èƒ½ï¼šå‡å°‘èµ„æºå ç”¨ï¼Œæé«˜è®¿é—®é€Ÿåº¦ã€‚ä¸‹é¢å‚æ•°çœ‹å­—é¢æ„æ€éƒ½èƒ½ç†è§£ã€‚</span><br><span class="line">    fastcgi_connect_timeout 300;</span><br><span class="line">    fastcgi_send_timeout 300;</span><br><span class="line">    fastcgi_read_timeout 300;</span><br><span class="line">    fastcgi_buffer_size 64k;</span><br><span class="line">    fastcgi_buffers 4 64k;</span><br><span class="line">    fastcgi_busy_buffers_size 128k;</span><br><span class="line">    fastcgi_temp_file_write_size 128k;</span><br><span class="line"></span><br><span class="line">    #gzipæ¨¡å—è®¾ç½®</span><br><span class="line">    #&#x3D;&#x3D;è®¾ç½®nginxé‡‡ç”¨gzipå‹ç¼©çš„å½¢å¼å‘é€æ•°æ®ï¼Œå‡å°‘å‘é€æ•°æ®é‡ï¼Œä½†ä¼šå¢åŠ è¯·æ±‚å¤„ç†æ—¶é—´åŠCPUå¤„ç†æ—¶é—´ï¼Œéœ€è¦æƒè¡¡</span><br><span class="line">    gzip on; #å¼€å¯gzipå‹ç¼©è¾“å‡º</span><br><span class="line">    gzip_min_length 1k; #æœ€å°å‹ç¼©æ–‡ä»¶å¤§å°</span><br><span class="line">    gzip_buffers 4 16k; #å‹ç¼©ç¼“å†²åŒº</span><br><span class="line">    gzip_http_version 1.0; #å‹ç¼©ç‰ˆæœ¬ï¼ˆé»˜è®¤1.1ï¼Œå‰ç«¯å¦‚æœæ˜¯squid2.5è¯·ä½¿ç”¨1.0ï¼‰</span><br><span class="line">    #&#x3D;&#x3D;è®¾ç½®æ•°æ®å‹ç¼©ç­‰çº§ï¼Œ1-9ä¹‹é—´ï¼Œ9æœ€æ…¢å‹ç¼©æ¯”æœ€å¤§</span><br><span class="line">    gzip_comp_level 2; #å‹ç¼©ç­‰çº§</span><br><span class="line">    #å‹ç¼©ç±»å‹ï¼Œé»˜è®¤å°±å·²ç»åŒ…å«text&#x2F;htmlï¼Œæ‰€ä»¥ä¸‹é¢å°±ä¸ç”¨å†å†™äº†ï¼Œå†™ä¸Šå»ä¹Ÿä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€ä¸ªwarnã€‚</span><br><span class="line">    gzip_types text&#x2F;plain text&#x2F;css text&#x2F;xml text&#x2F;javascript  application&#x2F;json application&#x2F;x-javascript application&#x2F;xml application&#x2F;xml+rss</span><br><span class="line">    #&#x3D;&#x3D;åŠ varyç»™ä»£ç†æœåŠ¡å™¨ä½¿ç”¨ï¼Œé’ˆå¯¹æœ‰çš„æµè§ˆå™¨æ”¯æŒå‹ç¼©ï¼Œæœ‰ä¸ªä¸æ”¯æŒï¼Œæ ¹æ®å®¢æˆ·ç«¯çš„HTTPå¤´æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦å‹ç¼©</span><br><span class="line">    gzip_vary on;</span><br><span class="line">    #å¼€å¯é™åˆ¶IPè¿æ¥æ•°çš„æ—¶å€™éœ€è¦ä½¿ç”¨</span><br><span class="line">    #limit_zone crawler $binary_remote_addr 10m; </span><br><span class="line">    #nginxåœ¨å‹ç¼©èµ„æºä¹‹å‰ï¼Œå…ˆæŸ¥æ‰¾æ˜¯å¦æœ‰é¢„å…ˆgzipå¤„ç†è¿‡çš„èµ„æº</span><br><span class="line">    #!gzip_static on;</span><br><span class="line">    #ä¸ºæŒ‡å®šçš„å®¢æˆ·ç«¯ç¦ç”¨gzipåŠŸèƒ½</span><br><span class="line">    gzip_disable &quot;MSIE[1-6]\.&quot;;</span><br><span class="line">    #å…è®¸æˆ–ç¦æ­¢å‹ç¼©åŸºäºè¯·æ±‚å’Œç›¸åº”çš„å“åº”æµï¼Œanyä»£è¡¨å‹ç¼©æ‰€æœ‰è¯·æ±‚</span><br><span class="line">    gzip_proxied any;</span><br><span class="line">    #&#x3D;&#x3D;è®¾ç½®å¯¹æ•°æ®å¯ç”¨å‹ç¼©çš„æœ€å°‘å­—èŠ‚æ•°ï¼Œå¦‚æœè¯·æ±‚å°äº10240å­—èŠ‚åˆ™ä¸å‹ç¼©ï¼Œä¼šå½±å“è¯·æ±‚é€Ÿåº¦</span><br><span class="line">    gzip_min_length 10240;</span><br><span class="line"></span><br><span class="line">    #&#x3D;&#x3D;å¼€å‘ç¼“å­˜çš„åŒæ—¶ä¹ŸæŒ‡å®šäº†ç¼“å­˜æ–‡ä»¶çš„æœ€å¤§æ•°é‡ï¼Œ20så¦‚æœæ–‡ä»¶æ²¡æœ‰è¯·æ±‚åˆ™åˆ é™¤ç¼“å­˜</span><br><span class="line">    open_file_cache max&#x3D;100000 inactive&#x3D;20s;</span><br><span class="line">    #&#x3D;&#x3D;æŒ‡å¤šé•¿æ—¶é—´æ£€æŸ¥ä¸€æ¬¡ç¼“å­˜çš„æœ‰æ•ˆä¿¡æ¯</span><br><span class="line">    open_file_cache_valid 60s;</span><br><span class="line">    #&#x3D;&#x3D;æ–‡ä»¶ç¼“å­˜æœ€å°çš„è®¿é—®æ¬¡æ•°ï¼Œåªæœ‰è®¿é—®è¶…è¿‡5æ¬¡çš„æ‰ä¼šè¢«ç¼“å­˜</span><br><span class="line">    open_file_cache_min_uses 5;</span><br><span class="line">    #å½“æœç´¢ä¸€ä¸ªæ–‡ä»¶æ—¶æ˜¯å¦ç¼“å­˜é”™è¯¯ä¿¡æ¯</span><br><span class="line">    open_file_cache_errors on;</span><br><span class="line"></span><br><span class="line">    #&#x3D;&#x3D;å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°</span><br><span class="line">    client_max_body_size 8m;</span><br><span class="line">    #&#x3D;&#x3D;å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°</span><br><span class="line">    client_header_buffer_size 32k;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    upstream blog.ha97.com &#123;</span><br><span class="line">    #ip_hash;</span><br><span class="line">    #weightå‚æ•°è¡¨ç¤ºæƒé‡å€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§</span><br><span class="line">    server 192.168.80.121:80 weight&#x3D;3;</span><br><span class="line">    server 192.168.80.122:80 weight&#x3D;2;</span><br><span class="line">    server 192.168.80.123:80 weight&#x3D;3;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #å¯¹ &quot;&#x2F;&quot; å¯ç”¨åå‘ä»£ç†</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;127.0.0.1:88;</span><br><span class="line">    proxy_redirect off;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    #åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP</span><br><span class="line">    proxy_set_header Host $host;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    #ä»¥ä¸‹æ˜¯ä¸€äº›åå‘ä»£ç†çš„é…ç½®ï¼Œå¯é€‰ã€‚</span><br><span class="line">    #å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°</span><br><span class="line">    client_max_body_size 10m;</span><br><span class="line">    #ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œ</span><br><span class="line">    client_body_buffer_size 128k;</span><br><span class="line">    #&#x3D;&#x3D;nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶)</span><br><span class="line">    proxy_connect_timeout 60;</span><br><span class="line">    #&#x3D;&#x3D;è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)</span><br><span class="line">    proxy_read_timeout 120;</span><br><span class="line">    #&#x3D;&#x3D;åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶)</span><br><span class="line">    proxy_send_timeout 20;</span><br><span class="line">    #&#x3D;&#x3D;è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°</span><br><span class="line">    proxy_buffer_size 32k;</span><br><span class="line">    #&#x3D;&#x3D;proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è®¾ç½®</span><br><span class="line">    proxy_buffers 4 128k;</span><br><span class="line">    #&#x3D;&#x3D;é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰</span><br><span class="line">    proxy_busy_buffers_size 256k;</span><br><span class="line">    #&#x3D;&#x3D;è®¾å®šç¼“å­˜æ–‡ä»¶å¤¹å¤§å°ï¼Œå¤§äºè¿™ä¸ªå€¼ï¼Œå°†ä»upstreamæœåŠ¡å™¨ä¼ </span><br><span class="line">    proxy_temp_file_write_size 256k;</span><br><span class="line">    #&#x3D;&#x3D;1Gå†…å­˜ç¼“å†²ç©ºé—´ï¼Œ3å¤©ä¸ç”¨åˆ é™¤ï¼Œæœ€å¤§ç£ç›˜ç¼“å†²ç©ºé—´2G</span><br><span class="line">    proxy_cache_path &#x2F;home&#x2F;cache levels&#x3D;1:2 keys_zone&#x3D;cache_one:1024m inactive&#x3D;3d max_size&#x3D;2g;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    #è®¾å®šè´Ÿè½½å‡è¡¡æœåŠ¡å™¨åˆ—è¡¨</span><br><span class="line">    upstream nginx.test.com&#123;</span><br><span class="line">        #åç«¯æœåŠ¡å™¨è®¿é—®è§„åˆ™</span><br><span class="line">        #ip_hash;</span><br><span class="line">        #weightå‚æ•°è¡¨ç¤ºæƒé‡å€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§</span><br><span class="line">        #server 10.11.12.116:80 weight&#x3D;5;</span><br><span class="line">        #PC_Local</span><br><span class="line">        server 10.11.12.116:80;</span><br><span class="line">        #PC_Server</span><br><span class="line">        server 10.11.12.112:80;</span><br><span class="line">        #Notebook</span><br><span class="line">        #server 10.11.12.106:80;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #è™šæ‹Ÿä¸»æœºè®¾å®šæ¨¡å—ï¼ˆæŒ‚è½½å¤šä¸ªç«™ç‚¹ï¼Œåªéœ€è¦é…ç½®å¤šä¸ªserveråŠupstreamèŠ‚ç‚¹å³å¯ï¼‰</span><br><span class="line">    server &#123;</span><br><span class="line">        #ç›‘å¬80ç«¯å£</span><br><span class="line">        listen 80;</span><br><span class="line">        #å®šä¹‰ä½¿ç”¨nginx.test.comè®¿é—®</span><br><span class="line">        server_name nginx.test.com;</span><br><span class="line">        #è®¾å®šæœ¬è™šæ‹Ÿä¸»æœºçš„è®¿é—®æ—¥å¿—</span><br><span class="line">        access_log logs&#x2F;nginx.test.com.access.log;</span><br><span class="line">        </span><br><span class="line">        #é»˜è®¤è¯·æ±‚</span><br><span class="line">        # è¯­æ³•è§„åˆ™ï¼šlocation [&#x3D;|~|~*|^~] &#x2F;uri&#x2F; &#123;...&#125; å…ˆåŒ¹é…æ™®é€šlocationï¼Œåœ¨åŒ¹é…æ­£åˆ™location</span><br><span class="line">        # &#x3D; å¼€å¤´è¡¨ç¤ºç²¾ç¡®åŒ¹é…</span><br><span class="line">        # ^~ å¼€å¤´è¡¨ç¤ºuriä»¥æŸä¸ªå¸¸è§„å­—ç¬¦ä¸²å¼€å¤´ï¼Œç†è§£ä¸ºåŒ¹é…urlè·¯å¾„å³å¯ï¼Œæ— éœ€è€ƒè™‘ç¼–è§£ç </span><br><span class="line">        # ~ å¼€å¤´è¡¨ç¤ºåŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é…</span><br><span class="line">        # ~* å¼€å¤´è¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é…</span><br><span class="line">        # !~ å¼€å¤´è¡¨ç¤ºåŒºåˆ†å¤§å°å†™çš„ä¸åŒ¹é…çš„æ­£åˆ™</span><br><span class="line">        # !~* å¼€å¤´è¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™çš„ä¸åŒ¹é…çš„æ­£åˆ™</span><br><span class="line">        # &#x2F; é€šç”¨åŒ¹é…ï¼Œä»»ä½•è¯·æ±‚éƒ½ä¼šè¢«åŒ¹é…åˆ°</span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            #é™åˆ¶IPè®¿é—®</span><br><span class="line">            deny 192.168.0.2ï¼›</span><br><span class="line">            allow 192.168.0.0&#x2F;24;</span><br><span class="line">            allow 192.168.1.1;</span><br><span class="line">            deny all;</span><br><span class="line">            #å®šä¹‰æœåŠ¡å™¨çš„é»˜è®¤ç½‘ç«™æ ¹ç›®å½•ä½ç½®</span><br><span class="line">            root html;</span><br><span class="line">            #å®šä¹‰é¦–é¡µç´¢å¼•æ–‡ä»¶çš„åç§°</span><br><span class="line">            index index.html index.htm;</span><br><span class="line">            #å®šä¹‰åç«¯è´Ÿè½½æœåŠ¡å™¨ç»„</span><br><span class="line">            proxy_pass http:&#x2F;&#x2F;nginx.test.com;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #å®šä¹‰é”™è¯¯æç¤ºé¡µé¢</span><br><span class="line">        error_page 500 502 503 504 &#x2F;50x.html;</span><br><span class="line">        location &#x3D; &#x2F;50x.html &#123;</span><br><span class="line">            root html;</span><br><span class="line">        &#125;</span><br><span class="line">        #é™æ€æ–‡ä»¶ï¼Œnginxè‡ªå·±å¤„ç†</span><br><span class="line">        location ~ ^&#x2F;(images|javascript|js|css|flash|media|static)&#x2F;&#123;</span><br><span class="line">            root &#x2F;var&#x2F;www&#x2F;virtual&#x2F;htdocs;</span><br><span class="line">            #è¿‡æœŸæ—¶é—´1å¤©</span><br><span class="line">            expires 1d;</span><br><span class="line">            #å…³é—­åª’ä½“æ–‡ä»¶æ—¥å¿—</span><br><span class="line">            access_log off;</span><br><span class="line">            log_not_found off;</span><br><span class="line">        &#125;</span><br><span class="line">        #è®¾å®šæŸ¥çœ‹NginxçŠ¶æ€çš„åœ°å€</span><br><span class="line">        location &#x2F;NginxStatus &#123;</span><br><span class="line">            #!stub_status on; #æ— æ­¤å…³é”®å­—</span><br><span class="line">            access_log off;</span><br><span class="line">            auth_basic &quot;NginxStatus&quot;;</span><br><span class="line">            auth_basic_user_file conf&#x2F;htpasswd;</span><br><span class="line">        &#125;</span><br><span class="line">        #ç¦æ­¢è®¿é—®çš„æ–‡ä»¶.htxxx</span><br><span class="line">        location ~ &#x2F;\.ht &#123;</span><br><span class="line">            deny all;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    #ç½‘ç«™è¾ƒå¤šçš„æƒ…å†µä¸‹ngxinåˆä¸ä¼šè¯·æ±‚ç“¶é¢ˆå¯ä»¥è€ƒè™‘æŒ‚å¤šä¸ªç«™ç‚¹ï¼Œå¹¶æŠŠè™šæ‹Ÿä¸»æœºé…ç½®å•ç‹¬æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å†…ï¼Œå¼•å…¥è¿›æ¥</span><br><span class="line">    #include website.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å¯¹åŸŸåçš„åŒ¹é…è§„åˆ™"><a href="#å¯¹åŸŸåçš„åŒ¹é…è§„åˆ™" class="headerlink" title="å¯¹åŸŸåçš„åŒ¹é…è§„åˆ™"></a>å¯¹åŸŸåçš„åŒ¹é…è§„åˆ™</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server_name location;      # åŒ¹é…æœ¬åœ°ä¸»æœºipï¼›</span><br><span class="line">server_name www.baidu.com; # ç²¾ç¡®é…ç½®  </span><br><span class="line">server_name *.baidu.com;   # ä»¥é€šé…ç¬¦å¼€å¤´çš„é…ç½®  </span><br><span class="line">server_name baidu.*;       # ä»¥é€šé…ç¬¦ç»“å°¾çš„é…ç½®  </span><br><span class="line">server_name  ~^(?&lt;user&gt;.+)\.example\.net$;  #æ­£åˆ™çš„é…ç½®ï¼Œå¿…é¡»ä»¥æ³¢æµªçº¿ä¸ºå¼€å¤´</span><br></pre></td></tr></table></figure><h1 id="è·¯ç”±å¯¹locationçš„åŒ¹é…è§„åˆ™"><a href="#è·¯ç”±å¯¹locationçš„åŒ¹é…è§„åˆ™" class="headerlink" title="è·¯ç”±å¯¹locationçš„åŒ¹é…è§„åˆ™"></a>è·¯ç”±å¯¹locationçš„åŒ¹é…è§„åˆ™</h1><h4 id="è´ªå©ªåŸåˆ™ï¼šåŒ¹é…å°½å¯èƒ½é•¿çš„è·¯å¾„ï¼›"><a href="#è´ªå©ªåŸåˆ™ï¼šåŒ¹é…å°½å¯èƒ½é•¿çš„è·¯å¾„ï¼›" class="headerlink" title="è´ªå©ªåŸåˆ™ï¼šåŒ¹é…å°½å¯èƒ½é•¿çš„è·¯å¾„ï¼›"></a>è´ªå©ªåŸåˆ™ï¼šåŒ¹é…å°½å¯èƒ½é•¿çš„è·¯å¾„ï¼›</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        root &#x2F;data&#x2F;www;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;images&#x2F; &#123;</span><br><span class="line">        root &#x2F;data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># &#x2F;images&#x2F;åŒ¹é…åˆ°ç¬¬äºŒä¸ªï¼›</span><br></pre></td></tr></table></figure><h4 id="é€šé…è§„åˆ™"><a href="#é€šé…è§„åˆ™" class="headerlink" title="é€šé…è§„åˆ™"></a>é€šé…è§„åˆ™</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ä»¥&#x3D;å¼€å¤´ï¼Œè¡¨ç¤ºç²¾ç¡®åŒ¹é…ï¼›</span><br><span class="line">ä»¥^~å¼€å¤´ï¼Œè¡¨ç¤ºuriä»¥æŸä¸ªå¸¸è§„å­—ç¬¦ä¸²å¼€å¤´ï¼Œä¸æ˜¯æ­£åˆ™åŒ¹é…ï¼›</span><br><span class="line">ä»¥~å¼€å¤´ï¼Œè¡¨ç¤ºåŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é…ï¼›</span><br><span class="line">ä»¥~*å¼€å¤´ï¼Œè¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é…ï¼›</span><br><span class="line">&#x2F;ï¼Œè¡¨ç¤ºé€šç”¨åŒ¹é…, å¦‚æœæ²¡æœ‰å…¶å®ƒåŒ¹é…,ä»»ä½•è¯·æ±‚éƒ½ä¼šåŒ¹é…åˆ°ï¼›</span><br></pre></td></tr></table></figure><h4 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># å¦‚æœæœ‰ä¸¤ä¸ªå¼€å¤´ä¸€æ ·çš„è·¯ç”±ï¼Œæœ‰å¯èƒ½åŒ¹é…ä¸åˆ°</span><br><span class="line"></span><br><span class="line">å¦‚ï¼š</span><br><span class="line"></span><br><span class="line">location &#x2F;eeg</span><br><span class="line"></span><br><span class="line">location &#x2F;eegabc</span><br><span class="line"></span><br><span class="line"># ä¸Šé¢ä¼šé€ æˆ&#x2F;eegabcåŒ¹é…å¤±è´¥</span><br></pre></td></tr></table></figure><h1 id="nginxçš„æ—¥å¿—è®¾ç½®è§„åˆ™"><a href="#nginxçš„æ—¥å¿—è®¾ç½®è§„åˆ™" class="headerlink" title="nginxçš„æ—¥å¿—è®¾ç½®è§„åˆ™"></a>nginxçš„æ—¥å¿—è®¾ç½®è§„åˆ™</h1><h4 id="ä¸»è¦åˆ†ä¸ºaccess-logå’Œerror-log"><a href="#ä¸»è¦åˆ†ä¸ºaccess-logå’Œerror-log" class="headerlink" title="ä¸»è¦åˆ†ä¸ºaccess_logå’Œerror_log;"></a>ä¸»è¦åˆ†ä¸ºaccess_logå’Œerror_log;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">access log : è®°å½•äº†å“ªäº›ç”¨æˆ·ï¼Œå“ªäº›é¡µé¢ä»¥åŠç”¨æˆ·æµè§ˆå™¨ã€ipå’Œå…¶ä»–çš„è®¿é—®ä¿¡æ¯</span><br><span class="line">é»˜è®¤å€¼: access_log logs&#x2F;access.log combined;  # è¡¨ç¤ºé…ç½®çš„è·¯å¾„å’Œæ ¼å¼</span><br><span class="line">é…ç½®æ®µ: http, server, location, if in location, limit_except</span><br><span class="line"></span><br><span class="line">error log : è®°å½•æœåŠ¡å™¨é”™è¯¯æ—¥å¿—</span><br><span class="line">é»˜è®¤å€¼: error_log logs&#x2F;error.log error;  # è¡¨ç¤ºé…ç½®çš„è·¯å¾„å’Œçº§åˆ«ï¼Œæœ‰[debug | info | notice | warn | error | crit | alert | emerg]å…«ä¸ªçº§åˆ«;</span><br><span class="line">é…ç½®æ®µ: main, http, server, location</span><br></pre></td></tr></table></figure><h1 id="è´Ÿè½½å‡è¡¡çš„è§„åˆ™"><a href="#è´Ÿè½½å‡è¡¡çš„è§„åˆ™" class="headerlink" title="è´Ÿè½½å‡è¡¡çš„è§„åˆ™"></a>è´Ÿè½½å‡è¡¡çš„è§„åˆ™</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#è®¾å®šè´Ÿè½½å‡è¡¡æœåŠ¡å™¨åˆ—è¡¨</span><br><span class="line">upstream test&#123;</span><br><span class="line">    #åç«¯æœåŠ¡å™¨è®¿é—®è§„åˆ™</span><br><span class="line">    #ip_hash;   # æ ¹æ®ipçš„hashè§„åˆ™åˆ†é…ï¼Œä¸»è¦æ˜¯å½“éœ€è¦ä¼šè¯ä¿æŒçš„æ—¶å€™ï¼Œsessionæ˜¯ä¸èƒ½å…±äº«çš„ï¼›</span><br><span class="line">    #weightå‚æ•°è¡¨ç¤ºæƒé‡å€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§ï¼ŒæœåŠ¡å™¨çš„è¿ç®—èƒ½åŠ›æœ‰æ—¶ä¸æ˜¯ä¸€æ ·çš„ï¼›</span><br><span class="line">    #server 10.11.12.116:80 weight&#x3D;5;</span><br><span class="line">    #PC_Local</span><br><span class="line">    server 10.11.12.116:80 max_fails&#x3D;3 fail_timeout&#x3D;30; </span><br><span class="line">    # max_fails:æœ€å¤šçš„è½¬å‘å¤±è´¥çš„æ¬¡æ•°ï¼Œå¦‚æœè½¬å‘å¤±è´¥è¶…è¿‡æ¬¡æ•°ï¼Œå°±è®¤ä¸ºè¯¥æœåŠ¡å™¨æŒ‚æ‰ï¼›</span><br><span class="line">    # fail_timeoutï¼šè¯·æ±‚å¤±è´¥æš‚åœçš„æœåŠ¡æ—¶é—´ï¼Œåœ¨è¿™ä¸ªæ—¶é—´å†…ä¼šæš‚æ—¶æ”¾å¼ƒè½¬å‘ç»™è¯¥æœåŠ¡å™¨ï¼›</span><br><span class="line">    #PC_Server</span><br><span class="line">    server 10.11.12.112:80 down;  # down:æš‚æ—¶ä¸å‚ä¸è´Ÿè½½å‡è¡¡ï¼›</span><br><span class="line">    server 10.11.12.112:80 backup;  # backup:å¤‡ç”¨æœåŠ¡å™¨ï¼Œå½“å…¶ä»–æ‰€æœ‰çš„æœºå™¨å¿™çš„æ—¶å€™ï¼Œä¼šå¯ç”¨å¤‡ç”¨æœåŠ¡å™¨ï¼›</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginxä¹‹proxy_passæŒ‡ä»¤å®Œå…¨æ‹†è§£</title>
      <link href="/p/d881e309/"/>
      <url>/p/d881e309/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h2 id="ä¸€ã€-åŠŸèƒ½"><a href="#ä¸€ã€-åŠŸèƒ½" class="headerlink" title="ä¸€ã€ åŠŸèƒ½"></a>ä¸€ã€ åŠŸèƒ½</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Nginx çš„ngx_stream_proxy_moduleå’Œngx_http_proxy_moduleä¸¤ä¸ªæ¨¡å—ä¸­ï¼Œéƒ½æœ‰ proxy_pass æŒ‡ä»¤ã€‚</span><br><span class="line">å…¶ä¸»è¦åŠŸèƒ½æ˜¯ä¸ºåç«¯åšä»£ç†ï¼Œåè®®è½¬å‘ï¼Œè¯·æ±‚è½¬å‘ç­‰ã€‚</span><br></pre></td></tr></table></figure><h2 id="äºŒã€-ç”¨æ³•å’ŒåŒºåˆ«"><a href="#äºŒã€-ç”¨æ³•å’ŒåŒºåˆ«" class="headerlink" title="äºŒã€ ç”¨æ³•å’ŒåŒºåˆ«"></a>äºŒã€ ç”¨æ³•å’ŒåŒºåˆ«</h2><ol><li>å®˜ç½‘ä»‹ç»</li></ol><h3 id="ngx-stream-proxy-module-çš„-proxy-pass"><a href="#ngx-stream-proxy-module-çš„-proxy-pass" class="headerlink" title="ngx_stream_proxy_module çš„ proxy_pass"></a>ngx_stream_proxy_module çš„ proxy_pass</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¯­æ³•ï¼šproxy_pass address;</span><br><span class="line">é»˜è®¤å€¼ï¼šâ€”</span><br><span class="line">åœºæ™¯ï¼šserver æ®µ</span><br><span class="line">è¯´æ˜ï¼šè®¾ç½®ä»£ç†æœåŠ¡å™¨çš„åœ°å€ã€‚ä»£ç†åœ°å€å¯ä»¥æ˜¯åŸŸåæˆ–è€…IPåŠ ç«¯å£ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªUNIXçš„socketè·¯å¾„</span><br></pre></td></tr></table></figure><h3 id="ngx-http-proxy-module-çš„-proxy-pass"><a href="#ngx-http-proxy-module-çš„-proxy-pass" class="headerlink" title="ngx_http_proxy_module çš„ proxy_pass"></a>ngx_http_proxy_module çš„ proxy_pass</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¯­æ³•ï¼šproxy_pass URL;</span><br><span class="line">é»˜è®¤å€¼ï¼šâ€”</span><br><span class="line">åœºæ™¯ï¼šlocation æ®µï¼Œlocationä¸­çš„ifæ®µï¼Œlimit_exceptæ®µ</span><br><span class="line">è¯´æ˜ï¼šè®¾ç½®åç«¯ä»£ç†æœåŠ¡å™¨çš„åœ°å€å’Œåè®®ï¼Œè¿˜å¯ä»¥é™„åŠ å¯é€‰çš„URIæ˜ å°„ã€‚åè®®å¯ä»¥æ˜¯ http æˆ–è€… httpsã€‚åœ°å€å¯ä»¥æ˜¯åŸŸåæˆ–è€…IPï¼Œå¯ä»¥é™„åŠ æŒ‡å®šç«¯å£ï¼Œä¹Ÿå¯ä»¥æ˜¯UNIXçš„socketè·¯å¾„ï¼Œè·¯å¾„è¦æ”¾åœ¨unix: å’Œ : ä¹‹é—´</span><br></pre></td></tr></table></figure><h2 id="2-åŒºåˆ«"><a href="#2-åŒºåˆ«" class="headerlink" title="2. åŒºåˆ«"></a>2. åŒºåˆ«</h2><p>ä»ä¸Šé¢çš„å„è‡ªè¯´æ˜å¯ä»¥çœ‹å‡ºä¸¤ä¸ª proxy_pass æŒ‡ä»¤éƒ½æ˜¯åšåç«¯çš„ä»£ç†é…ç½®ã€‚</p><p>é™¤äº†åº”ç”¨åœºæ™¯çš„æ®µä¸åŒä¹‹å¤–ï¼Œngx_stream_proxy_module çš„ proxy_pass åªèƒ½è½¬å‘åŸŸåæˆ–IPåŠ ç«¯å£çš„è¯·æ±‚ï¼Œå³ç«¯å£è½¬å‘ã€‚</p><p>ngx_http_proxy_module çš„ proxy_pass é™¤äº†åŒ…å«å‰è€…çš„åŠŸèƒ½å¤–ï¼Œè¿˜å¯ä»¥å®ç°åè®®è½¬å‘ï¼Œå¦‚ http å’Œ https ä¸ UNIX socket ä¸‰è€…çš„ç›¸äº’è½¬å‘ï¼Œå¦å¤–è¿˜æœ‰å¾ˆå®ç”¨çš„URIè½¬å‘</p><h2 id="3-ç”¨æ³•ç¤ºä¾‹"><a href="#3-ç”¨æ³•ç¤ºä¾‹" class="headerlink" title="3. ç”¨æ³•ç¤ºä¾‹"></a>3. ç”¨æ³•ç¤ºä¾‹</h2><p>3.1 ngx_stream_proxy_module çš„ proxy_pass</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 8000;</span><br><span class="line">    proxy_pass 127.0.0.1:8080; # IP+ç«¯å£è½¬å‘</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 8000;</span><br><span class="line">    proxy_pass test.com:8080; # åŸŸå+ç«¯å£è½¬å‘</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen [::1]:8000;</span><br><span class="line">    proxy_pass unix:&#x2F;tmp&#x2F;stream.socket; # UNIX socketè½¬å‘</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.2 ngx_http_proxy_module çš„ proxy_pass</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen      80;</span><br><span class="line">    server_name www.test.com;</span><br><span class="line"></span><br><span class="line">    # æ­£å¸¸ä»£ç†ï¼Œä¸ä¿®æ”¹åç«¯urlçš„</span><br><span class="line">    location &#x2F;some&#x2F;path&#x2F; &#123;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;127.0.0.1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # ä¿®æ”¹åç«¯urlåœ°å€çš„ä»£ç†ï¼ˆæœ¬ä¾‹åç«¯åœ°å€ä¸­ï¼Œæœ€åå¸¦äº†ä¸€ä¸ªæ–œçº¿)</span><br><span class="line">    location &#x2F;testb &#123;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;www.other.com:8801&#x2F;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # ä½¿ç”¨ if in location</span><br><span class="line">    location &#x2F;google &#123;</span><br><span class="line">        if ( $geoip_country_code ~ (RU|CN) ) &#123;</span><br><span class="line">            proxy_pass http:&#x2F;&#x2F;www.google.hk;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;limit&#x2F; &#123;</span><br><span class="line">        # æ²¡æœ‰åŒ¹é… limit_except çš„ï¼Œä»£ç†åˆ° unix:&#x2F;tmp&#x2F;backend.socket:&#x2F;uri&#x2F;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;unix:&#x2F;tmp&#x2F;backend.socket:&#x2F;uri&#x2F;;;</span><br><span class="line"></span><br><span class="line">        # åŒ¹é…åˆ°è¯·æ±‚æ–¹æ³•ä¸º: PUT or DELETE, ä»£ç†åˆ°9080</span><br><span class="line">        limit_except PUT DELETE &#123;</span><br><span class="line">            proxy_pass http:&#x2F;&#x2F;127.0.0.1:9080;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>ngx_http_proxy_module.proxy_pass çš„ URI è½¬å‘æ˜ å°„åˆ†æ1<br>å‡†å¤‡æ–‡ä»¶ /data/www/test/test.php å¦‚ä¸‹ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo &#39;$_SERVER[REQUEST_URI]:&#39; . $_SERVER[&#39;REQUEST_URI&#39;];</span><br></pre></td></tr></table></figure><p>é€šè¿‡æŸ¥çœ‹ $_SERVER[â€˜REQUEST_URIâ€™] çš„å€¼ï¼Œå¯ä»¥çœ‹åˆ°æ¯æ¬¡è¯·æ±‚çš„åç«¯çš„ request_uri çš„å€¼ï¼Œè¿›è¡ŒéªŒè¯ã€‚</p><p>Nginx é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen      80;</span><br><span class="line">    server_name www.test.com;</span><br><span class="line"></span><br><span class="line">    # æƒ…å½¢A</span><br><span class="line">    # è®¿é—® http:&#x2F;&#x2F;www.test.com&#x2F;testa&#x2F;aaaa</span><br><span class="line">    # åç«¯çš„request_uriä¸º: &#x2F;testa&#x2F;aaaa</span><br><span class="line">    location ^~ &#x2F;testa&#x2F; &#123;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;127.0.0.1:8801;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    # æƒ…å½¢B</span><br><span class="line">    # è®¿é—® http:&#x2F;&#x2F;www.test.com&#x2F;testb&#x2F;bbbb</span><br><span class="line">    # åç«¯çš„request_uriä¸º: &#x2F;bbbb</span><br><span class="line">    location ^~ &#x2F;testb&#x2F; &#123;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;127.0.0.1:8801&#x2F;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # æƒ…å½¢C</span><br><span class="line">    # ä¸‹é¢è¿™æ®µlocationæ˜¯æ­£ç¡®çš„</span><br><span class="line">    location ~ &#x2F;testc &#123;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;127.0.0.1:8801;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # æƒ…å½¢D</span><br><span class="line">    # ä¸‹é¢è¿™æ®µlocationæ˜¯é”™è¯¯çš„</span><br><span class="line">    #</span><br><span class="line">    # nginx -t æ—¶ï¼Œä¼šæŠ¥å¦‚ä¸‹é”™è¯¯: </span><br><span class="line">    #</span><br><span class="line">    # nginx: [emerg] &quot;proxy_pass&quot; cannot have URI part in location given by regular </span><br><span class="line">    # expression, or inside named location, or inside &quot;if&quot; statement, or inside </span><br><span class="line">    # &quot;limit_except&quot; block in &#x2F;opt&#x2F;app&#x2F;nginx&#x2F;conf&#x2F;vhost&#x2F;test.conf:17</span><br><span class="line">    # </span><br><span class="line">    # å½“locationä¸ºæ­£åˆ™è¡¨è¾¾å¼æ—¶ï¼Œproxy_pass ä¸èƒ½åŒ…å«URIéƒ¨åˆ†ã€‚æœ¬ä¾‹ä¸­åŒ…å«äº†&quot;&#x2F;&quot;</span><br><span class="line">    location ~ &#x2F;testd &#123;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;127.0.0.1:8801&#x2F;;   # è®°ä½ï¼Œlocationä¸ºæ­£åˆ™è¡¨è¾¾å¼æ—¶ï¼Œä¸èƒ½è¿™æ ·å†™ï¼ï¼ï¼</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # æƒ…å½¢E</span><br><span class="line">    # è®¿é—® http:&#x2F;&#x2F;www.test.com&#x2F;ccc&#x2F;bbbb</span><br><span class="line">    # åç«¯çš„request_uriä¸º: &#x2F;aaa&#x2F;ccc&#x2F;bbbb</span><br><span class="line">    location &#x2F;ccc&#x2F; &#123;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;127.0.0.1:8801&#x2F;aaa$request_uri;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # æƒ…å½¢F</span><br><span class="line">    # è®¿é—® http:&#x2F;&#x2F;www.test.com&#x2F;namea&#x2F;ddd</span><br><span class="line">    # åç«¯çš„request_uriä¸º: &#x2F;test?namea&#x3D;ddd</span><br><span class="line">    location &#x2F;namea&#x2F; &#123;</span><br><span class="line">        rewrite    &#x2F;namea&#x2F;([^&#x2F;]+) &#x2F;test?namea&#x3D;$1 break;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;127.0.0.1:8801;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # æƒ…å½¢G</span><br><span class="line">    # è®¿é—® http:&#x2F;&#x2F;www.test.com&#x2F;nameb&#x2F;eee</span><br><span class="line">    # åç«¯çš„request_uriä¸º: &#x2F;test?nameb&#x3D;eee</span><br><span class="line">    location &#x2F;nameb&#x2F; &#123;</span><br><span class="line">        rewrite    &#x2F;nameb&#x2F;([^&#x2F;]+) &#x2F;test?nameb&#x3D;$1 break;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;127.0.0.1:8801&#x2F;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    access_log &#x2F;data&#x2F;logs&#x2F;www&#x2F;www.test.com.log;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen      8801;</span><br><span class="line">    server_name www.test.com;</span><br><span class="line">    </span><br><span class="line">    root        &#x2F;data&#x2F;www&#x2F;test;</span><br><span class="line">    index       index.php index.html;</span><br><span class="line"></span><br><span class="line">    rewrite ^(.*)$ &#x2F;test.php?u&#x3D;$1 last;</span><br><span class="line"></span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">        try_files $uri &#x3D;404;</span><br><span class="line">        fastcgi_pass unix:&#x2F;tmp&#x2F;php-cgi.sock;</span><br><span class="line">        fastcgi_index index.php;</span><br><span class="line">        include fastcgi.conf;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    access_log &#x2F;data&#x2F;logs&#x2F;www&#x2F;www.test.com.8801.log;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€»ç»“</p><p>æƒ…å†µAå’Œæƒ…å†µBå¯¹æ¯”ï¼Œå¯ä»¥çœ‹å‡ºURIæœ€åçš„ / å¯¹ URI æ˜ å°„çš„å½±å“<br>æƒ…å†µDè¯´æ˜ï¼Œlocation ä¸ºæ­£åˆ™è¡¨è¾¾å¼æ—¶ï¼Œproxy_pass ä¸èƒ½åŒ…å« URI<br>æƒ…å†µEï¼Œå¯ä»¥é€šè¿‡ $request_uri æ·»åŠ æˆ–æ”¹å˜è¯·æ±‚çš„ URI<br>æƒ…å†µFå’ŒGé€šè¿‡ rewrite é…åˆ break å¯¹ URL å’Œ URI è¿›è¡Œæ”¹å†™</p>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> proxy_pass </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GitLabè½»æ¾åˆ›å»ºä¸€ä¸ªMerge Request</title>
      <link href="/p/37369/"/>
      <url>/p/37369/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h3 id="ç®€å†™è¯´æ˜"><a href="#ç®€å†™è¯´æ˜" class="headerlink" title="## ç®€å†™è¯´æ˜"></a>## ç®€å†™è¯´æ˜</h3><pre><code>- MR = Merge Request- ä¸»ä»“ = ç»„ç»‡åˆ›å»ºçš„ä»“åº“ï¼ˆä¸‹æ–‡ä¸­æ˜¯ awesome-php ç»„ç»‡åˆ›å»ºçš„ awesome-one ä»“åº“ï¼‰</code></pre><h3 id="ä»€ä¹ˆæ˜¯Merge-Request"><a href="#ä»€ä¹ˆæ˜¯Merge-Request" class="headerlink" title="ä»€ä¹ˆæ˜¯Merge Request"></a>ä»€ä¹ˆæ˜¯Merge Request</h3><pre><code>- ç›¸ä¿¡å¾ˆå¤šäººéƒ½ä¸å¤ªæ‡‚è¿™ä¸ª MR åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œé€šä¿—åœ°è¯´ï¼ŒMR å°±æ˜¯ä¸€ä¸ª merge è¯·æ±‚ã€‚- åˆ›å»ºä¸€ä¸ª MR å½“ç„¶å°±å¯ä»¥ç†è§£ä¸ºåˆ›å»ºä¸€ä¸ªåˆå¹¶è¯·æ±‚ã€‚MR çš„å­˜åœ¨ä¸»è¦æ˜¯ä¸ºäº†æƒé™æ§åˆ¶ã€‚</code></pre><h3 id="Forking-Workflow"><a href="#Forking-Workflow" class="headerlink" title="Forking Workflow"></a>Forking Workflow</h3><pre><code>- ç”¨ Git çš„åŒå­¦æœ€å¼€å§‹æ¥è§¦çš„æƒ³å¿…æ˜¯ Git Workflow å§ã€‚- ä»€ä¹ˆæ˜¯ Git Workflowï¼Ÿå…¶å®å°±æ˜¯å¤šäººåœ¨åŒä¸€ä¸ªä»“åº“ä¸Šè¿›è¡Œä»£ç æ‰˜ç®¡ï¼Œç„¶åä»“åº“å­˜åœ¨å¤šä¸ªåˆ†æ”¯ï¼Œä¸€èˆ¬æ¥è¯´æ¯ä¸ªæ–°åŠŸèƒ½ä¼šåˆ›å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œç„¶åæ ¹æ®ä¸åŒçš„é˜¶æ®µåˆå¹¶åˆ°ä¸åŒç¯å¢ƒå¯¹åº”çš„åˆ†æ”¯ä¸Šï¼Œå¯¹åŠŸèƒ½éœ€æ±‚è¿›è¡Œæµ‹è¯•ã€éªŒæ”¶ä»¥åŠä¸Šçº¿ã€‚- å½“å¼€å‘å›¢é˜Ÿè§„æ¨¡è¾ƒå°çš„æ—¶å€™ï¼Œä½¿ç”¨ Git Workflow æ— ç–‘æ˜¯ç›¸å¯¹é€‚åˆçš„ï¼Œä¼˜ç‚¹æ˜¯ç›¸å¯¹çµæ´»ã€‚ä½†æ˜¯å½“å›¢é˜Ÿäººæ•°è¾¾åˆ°ä¸€å®šç¨‹åº¦ï¼Œé¡¹ç›®è¾ƒå¤šä¹‹åï¼Œè¿™ç§å·¥ä½œæµå°±ä¼šæš´éœ²æœ¬èº«çš„å±€é™æ€§ï¼Œæƒé™ç®¡ç†æ¯”è¾ƒæ··ä¹±ã€‚- è¿™ä¸ªæ—¶å€™ï¼ŒForking Workflow å°±åº”è¿è€Œç”Ÿäº†ã€‚- ä»€ä¹ˆæ˜¯ Forking Workflow ï¼ŸForking Workflow å°±æ˜¯å­˜åœ¨ä¸€ä¸ªä¸»ä»“ï¼Œå…¶ä»–å¼€å‘äººå‘˜æŠŠä¸»ä»“ Fork ä¸€ä»½åˆ°è‡ªå·±çš„ä»“åº“ä¸­ï¼Œç„¶ååœ¨è‡ªå·±çš„ä»“åº“ä¸­è¿›è¡ŒåŠŸèƒ½å¼€å‘ï¼Œå¼€å‘å®Œæˆåæäº¤ Merge Request ï¼Œç„¶åå›¢é˜Ÿ Review ï¼Œç¡®è®¤æ²¡é—®é¢˜ä¹‹åè¿›è¡Œåˆå¹¶æ›´æ–°æ“ä½œã€‚- ç›¸æ¯” Git Workflow ï¼ŒForking Workflow å¯ä»¥æ›´å¥½åœ°ç®¡ç†ä¸»ä»“ä»£ç ï¼Œä¿è¯ä¸»ä»“ä»£ç çš„å®‰å…¨ã€ä¸€è‡´æ€§ç­‰ï¼Œä¸”å¯ä»¥æœç»åˆ†æ”¯è¿‡å¤šå¼•å‘çš„å…¶ä»–é—®é¢˜ã€‚</code></pre><h3 id="æ€ä¹ˆåˆ›å»ºMerge-Request"><a href="#æ€ä¹ˆåˆ›å»ºMerge-Request" class="headerlink" title="æ€ä¹ˆåˆ›å»ºMerge Request"></a>æ€ä¹ˆåˆ›å»ºMerge Request</h3><p>è¨€å½’æ­£ä¼ ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æ€ä¹ˆåˆ›å»º MRã€‚åœ¨æˆ‘æœ‹å‹åœˆä¸­æœ‰å¤§Lå’Œå°Lä¸¤ä½å°ä¼™ä¼´ï¼Œåˆ†åˆ«ä½¿ç”¨ Git Workflow å’Œ Forking Workflow ä¸¤ç§ä¸åŒçš„ Git å·¥ä½œæµã€‚ä¸­å›½ä¼ ç»Ÿæ•¬è€çˆ±å¹¼ï¼Œé‚£ä¹ˆå°±ç”±ä½¿ç”¨ Forking Workflow çš„å°Lä¸ºæˆ‘ä»¬æ¼”ç¤ºä¸€ä¸‹æ€ä¹ˆåˆ›å»ºä¸€ä¸ª MRã€‚</p><h4 id="Forking-Workflow-1"><a href="#Forking-Workflow-1" class="headerlink" title="Forking Workflow"></a>Forking Workflow</h4><p>æ­¤æ—¶ä½¿ç”¨ Forking Workflow çš„å°LåŒå­¦æ¥åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œå°Læ€è·¯æ¸…æ™°ï¼Œä»–é¦–å…ˆæŸ¥çœ‹ä¸»ä»“ï¼ˆ awesome-php åä¸‹çš„ awesome-one ä»“åº“ï¼Œä¸‹æ–‡ä¸€å¾‹ä½¿ç”¨ä¸»ä»“ç§°å‘¼ï¼‰ï¼Œç„¶ååŸºäºä¸»ä»“ Fork ä¸€ä¸ªå±äºè‡ªå·±çš„ä»“åº“ï¼š</p><img src= "/img/loading.gif" data-src="http://qiniu.webpages.show/images/3xuci.gif"><p>æ­¤æ—¶å°Lä¸ªäººï¼ˆä¹Ÿå°±æ˜¯zmcdbpï¼‰åä¸‹ä¹Ÿæœ‰äº†ä¸€ä¸ª awesome-one ä»“åº“ï¼Œå°Læ¥ç€è¦åšçš„äº‹è‡ªç„¶å°±æ˜¯ Clone è‡ªå·±çš„ä»“åº“åˆ°æœ¬åœ°ï¼š</p><img src= "/img/loading.gif" data-src="http://qiniu.webpages.show/images/opt6u.gif"><p>çªç„¶æ¥åˆ°çš„éœ€æ±‚éœ€è¦å¼€å‘ä¸€ä¸ª phpinfo é¡µé¢ï¼Œéµå¾ª Forking Workflow è§„èŒƒçš„å°Lçš„åšæ³•æ˜¯å…ˆåŸºäºæœ¬åœ°çš„ master åˆ†æ”¯è¡ç”Ÿä¸€ä¸ª feature-phpinfo çš„åŠŸèƒ½åˆ†æ”¯ï¼Œç„¶ååœ¨è¯¥åˆ†æ”¯ä¸Šè¿›è¡Œå¼€å‘ï¼Œå¼€å‘å®Œæˆåæ·»åŠ æ›´æ”¹çš„ä»£ç åˆ°ç¼“å­˜åŒºï¼Œæäº¤ commit ï¼š<br> <img src= "/img/loading.gif" data-src="http://qiniu.webpages.show/images/1ahdl.gif"><br>å®Œæˆæœ¬åœ°æäº¤ä¹‹åï¼Œæ¥ä¸‹æ¥è¦è¿›è¡Œè¿œç¨‹åˆ†æ”¯çš„æäº¤ï¼Œå°Læäº¤åˆ°äº†è‡ªå·±åä¸‹çš„ä»“åº“ä¸­ï¼ˆä¹Ÿå°±æ˜¯zmcdbp/aweosme-oneï¼‰ï¼Œåˆ†æ”¯åç§°ä¸æœ¬åœ°åˆ†æ”¯ä¿æŒåŒæ­¥ï¼Œæ–¹ä¾¿æ—¥åç¿»é˜…æŸ¥æ‰¾ï¼ˆæ­¤å¤„å› ä¸ºå°Låä¸‹çš„ awesome-one ä»“åº“ä¸­å°šæœªå­˜åœ¨ feature-phpinfo åˆ†æ”¯ï¼Œæ‰€ä»¥åœ¨ push æ“ä½œçš„æ—¶å€™éœ€è¦å¸¦ä¸Š -u å‚æ•°å‘Šè¯‰ GitLab éœ€è¦åˆ›å»ºä¸€ä¸ªåå« feature-phpinfo çš„è¿œç¨‹åˆ†æ”¯ï¼‰ï¼š</p><img src= "/img/loading.gif" data-src="http://qiniu.webpages.show/images/8nlll.gif"><p>push æˆåŠŸä¹‹åå°Lé€‰æ‹©äº†å›åˆ° GitLab Web ä¸­æŸ¥çœ‹åˆšåˆšæäº¤äº†æ›´æ–°çš„ä»“åº“ï¼š</p><img src= "/img/loading.gif" data-src="http://qiniu.webpages.show/images/cn083.jpg"><p>å°Lå¾ˆå¼€å¿ƒï¼Œå› ä¸ºå‘ç°ä»–åä¸‹çš„ awesome-one ä»“åº“ ä¸­å·²ç»å¤šäº†ä¸€ä¸ªè¿œç¨‹åˆ†æ”¯ feature-phpinfoã€‚æ¥ä¸‹æ¥å°Lè¦æŠŠè¿™ä¸ªå·²ç»å¼€å‘å¥½çš„åŠŸèƒ½åˆ†æ”¯åˆå¹¶åˆ°ä¸»ä»“ä¸­ä»¥ä¾¿åç»­è¿›è¡ŒåŠŸèƒ½æµ‹è¯•ä»¥åŠäº§å“éªŒæ”¶ç­‰æ­¥éª¤ã€‚é¦–å…ˆå°Låˆ›å»ºäº†ä¸€ä¸ª MR ï¼ˆå› ä¸ºæœ¬åœ°åˆ†æ”¯æ˜¯æ¨é€åˆ°äº†å°Lä»ä¸»ä»“ä¸­ Fork å‡ºæ¥çš„ä¸ªäººä»“åº“ä¸­ï¼Œæ‰€ä»¥åˆ›å»º MR çš„åŠ¨ä½œä¹Ÿåº”è¯¥åœ¨è‡ªå·±ä»“åº“çš„ GitLab Web é¡µé¢ä¸­è¿›è¡Œï¼‰ï¼š</p><img src= "/img/loading.gif" data-src="http://qiniu.webpages.show/images/3u644.gif"><p>åˆ›å»º MR çš„é¡µé¢ä¿¡æ¯é‡ç›¸å½“å¤§ï¼Œæ‡’ç™Œæ™šæœŸçš„å°Lé€‰æ‹©äº†åªå…³æ³¨ Titleã€Descriptionã€Source branchã€Target branch ä»¥åŠ Remove source branch when merge request is accept è¿™å‡ é¡¹ï¼Œå¦‚æœä½ æ¯”è¾ƒå‹¤å¿«å½“ç„¶ä¹Ÿå¯ä»¥å¯¹å…¶ä»–é…ç½®é¡¹è¿›è¡Œè¯¦ç»†é…ç½®ã€‚æ‡’ç™Œæ™šæœŸçš„å°Lå…³æ³¨çš„è¿™å‡ é¡¹é…ç½®éƒ½æ˜¯ä»€ä¹ˆå‘¢ï¼ŸTitle å½“ç„¶å°±æ˜¯æœ¬æ¬¡ MR çš„ç®€è¦è¯´æ˜ï¼ŒDescription è‡ªç„¶å°±æ˜¯è¯¦ç»†è¯´æ˜ï¼Œé‡Œé¢å¯ä»¥å¡«å†™æœ¬æ¬¡åˆå¹¶ä¸»è¦åŠŸèƒ½ä»¥åŠç›¸å…³è´Ÿè´£äººå‘˜ç­‰ï¼ˆæ”¯æŒ Markdown å™¢ï¼ï¼‰ï¼ŒSource branch è‹±è¯­è¶…èµçš„ä½ è‚¯å®šå·²ç»çŒœåˆ°è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬è¦å‘èµ·åˆå¹¶çš„åˆ†æ”¯ï¼ŒTarget branch è‡ªç„¶å°±æ˜¯æ¥å—åˆå¹¶çš„åˆ†æ”¯å•¦ï¼ŒRemoveâ€¦ è¯´çš„å°±æ˜¯å½“æœ¬æ¬¡ MR è¢«æ¥å—ä¹‹åï¼Œè‡ªåŠ¨åˆ é™¤å‘èµ·åˆå¹¶çš„åˆ†æ”¯ï¼Œæ˜¯ä¸æ˜¯è¶…è´´å¿ƒï¼å°Lå¯¹è‡ªå·±æ¯”è¾ƒå…³æ³¨çš„å‡ é¡¹é…ç½®è¿›è¡Œç®€å•å¡«å†™åï¼Œç‚¹å‡»ä¸‹æ–¹çš„æäº¤æŒ‰é’®ï¼Œåˆ›å»º MR çš„æ“ä½œå°±å®Œæˆå•¦ï¼è¿æ‡’ç™Œæ™šæœŸçš„å°Léƒ½èƒ½è½»æ¾åˆ›å»ºï¼Œæ˜¯ä¸æ˜¯è¶…ç®€å•ï¼</p><img src= "/img/loading.gif" data-src="http://qiniu.webpages.show/images/wt2xg.gif"><p>ä½†æ˜¯èªæ˜çš„ä½ è‚¯å®šå‘ç°äº†äº‹æƒ…ä¼¼ä¹å¹¶æ²¡æœ‰è¿™ä¹ˆç®€å•ï¼Target branch é»˜è®¤æ˜¯ master åˆ†æ”¯å¹¶ä¸”ä¼¼ä¹æ— æ³•æ›´æ”¹ï¼Œé‚£ä¹ˆå¦‚æœéœ€è¦åˆå¹¶åˆ°å…¶ä»–å¦‚ dev åˆ†æ”¯çš„è¯è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæ²¡å…³ç³»ï¼Œç‚¹å‡» Target branch æ—è¾¹çš„ Change branches å°±å¯ä»¥å¯¹ Source branch å’Œ Target branch è¿›è¡Œæ›´æ”¹å•¦ï¼ï¼ˆåˆå¹¶è¯·æ±‚ä¸å•å•å¯ä»¥å‘ä¸»ä»“å‘èµ·ï¼Œè¿˜å¯ä»¥å¯¹è‡ªå·±ä»“åº“å†…å­˜åœ¨çš„ä¸¤ä¸ªåˆ†æ”¯è¿›è¡Œå‘èµ·ï¼Œæˆ–è€…å¯¹ä¸»ä»“æ´¾ç”Ÿçš„å…¶ä»–ä»“åº“ä¸­çš„åˆ†æ”¯å‘èµ·ï¼‰</p><img src= "/img/loading.gif" data-src="http://qiniu.webpages.show/images/vgibb.gif"><p>åœ¨ Forking Workflow ä¸­ä¸€ä¸ª MR çš„è¯ç”Ÿå·®ä¸å¤šéœ€è¦ç»å†çš„å°±è¿™ä¹ˆå¤šï¼Œå½“ç„¶è¿˜æœ‰æ›´å¤šç»†èŠ‚ç”±äºç¯‡å¹…é—®é¢˜æ²¡æœ‰ä¸€ä¸€ç»†è¯´ï¼Œè¿˜è¯·è§è°…ã€‚</p><h3 id="Git-Workflow"><a href="#Git-Workflow" class="headerlink" title="Git Workflow"></a>Git Workflow</h3><p>ç»„ç»‡æŠŠæ¯”è¾ƒé‡è¦çš„ hello world éœ€æ±‚ç•™ç»™äº†æˆ‘ä»¬æˆç†Ÿç¨³é‡ä½¿ç”¨ Git Workflow çš„å¤§LåŒå­¦ï¼Œå¤§Lä¸å‡æ€ç´¢åœ°è®¿é—®äº†ä¸»ä»“çš„é¡µé¢å¹¶è¿›è¡Œäº† Clone æ“ä½œï¼Œç„¶ååœ¨æœ¬åœ°åˆ›å»ºäº†ä¸€ä¸ªéœ€è¦è¿›è¡ŒåŠŸèƒ½å¼€å‘çš„ feature-hello-world åˆ†æ”¯ã€‚æ³¨æ„ï¼Œå¤§Læ˜¯ä»ä¸»ä»“ Cloneï¼Œè€Œå°Læ˜¯ä»è‡ªå·± Fork å‡ºæ¥çš„ä»“åº“ Cloneã€‚</p><img src= "/img/loading.gif" data-src="http://qiniu.webpages.show/images/3ujuq.gif"><p>æ¥ç€å¤§Lè¿…é€Ÿå®Œæˆäº†å¼€å‘å·¥ä½œï¼Œä¸å°Lçš„æœ¬åœ°æäº¤æ“ä½œç±»ä¼¼ï¼ŒæŠŠæ›´æ”¹çš„æ–‡ä»¶æ·»åŠ åˆ°ç¼“å­˜åŒºï¼Œç„¶åæ·»åŠ  commitã€‚</p><img src= "/img/loading.gif" data-src="http://qiniu.webpages.show/images/64rxz.gif"><p>å®Œæˆäº†æœ¬åœ°æäº¤åï¼Œå¤§Lé€‰æ‹©äº†æŠŠæ–°å¼€å‘çš„åŠŸèƒ½åˆ†æ”¯æ¨é€åˆ°è¿œç¨‹ä»“åº“ä¸­ã€‚ï¼ˆä¸å°Lç±»ä¼¼ï¼Œå› ä¸ºè¿œç¨‹ä»“åº“ä¸­å°šæœªå­˜åœ¨ä¸æœ¬åœ°åŒåçš„åˆ†æ”¯ï¼Œæ‰€ä»¥éœ€è¦æ·»åŠ  -u å‚æ•°åˆ›å»ºè¿œç¨‹åˆ†æ”¯ï¼‰</p><img src= "/img/loading.gif" data-src="http://qiniu.webpages.show/images/6pnyx.gif"><p>å®Œæˆæ¨é€åˆ°è¿œç¨‹ä»“åº“çš„æ“ä½œåï¼Œå¤§Læ‰“å¼€äº†ä¸»ä»“çš„é¡µé¢ç„¶åç‚¹å‡»æ—è¾¹å‡ºç°çš„ Create Merge Request æŒ‰é’®æ¥åˆ›å»ºä¸€ä¸ª MRã€‚è¿›å…¥åˆ°åˆ›å»ºé¡µé¢ä¹‹åï¼Œå¤§Lçš„æ“ä½œå°±è·Ÿå°Lç‚¹å‡»åˆ›å»º MR æŒ‰é’®åçš„æ“ä½œä¸€è‡´äº†ï¼Œåœ¨è¿™å°±ä¸å†é‡å¤äº†ã€‚ï¼ˆéƒ½æ˜¯å§“Lçš„ï¼Œä¸€æ ·çš„å§“ï¼Œä¸€æ ·çš„ç—…ã€æ‡’ç™Œæ™šæœŸã€‘ï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> Gitlab </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gitlab </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
